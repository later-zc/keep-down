# ä¸€. this çš„ç»‘å®šè§„åˆ™



## 1. this åˆ°åº•æŒ‡å‘ä»€ä¹ˆå‘¢ï¼Ÿ
:::info
`this` è¡¨ç¤º**å‡½æ•°è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡**ï¼Œæ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œåœ¨å‡½æ•°è¿è¡Œæ—¶è‡ªåŠ¨å‡ºç°ã€‚ä½†å®ƒçš„å€¼å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯æ ¹æ®å‡½æ•°çš„**è°ƒç”¨æ–¹å¼**å†³å®šã€‚
:::
**â“å…ˆæ¥çœ‹ä¸€ä¸ªè®©äººå›°æƒ‘çš„é—®é¢˜ï¼š**
> ä¸‹é¢æˆ‘ä»¬ç”¨åŒä¸€ä¸ªå‡½æ•° fooï¼Œåˆ†åˆ«ç”¨ä¸‰ç§æ–¹å¼è°ƒç”¨ï¼Œè§‚å¯Ÿ this çš„æŒ‡å‘ã€‚
```js
function foo() { 
  console.log(this)
}

// æ–¹å¼ä¸€ï¼šç›´æ¥è°ƒç”¨ï¼ˆé»˜è®¤ç»‘å®šï¼‰
foo()

// æ–¹å¼äºŒï¼šé€šè¿‡å¯¹è±¡è°ƒç”¨ï¼ˆéšå¼ç»‘å®šï¼‰
var obj = {
  name: 'later',
  foo: foo
}
obj.foo()

// æ–¹å¼ä¸‰ï¼šä½¿ç”¨ call æ˜¾å¼ç»‘å®š
foo.call('abc')
```
**ğŸ” åˆ†æè¿è¡Œç»“æœï¼ˆğŸ“åˆ†åˆ«è¯´æ˜æµè§ˆå™¨å’Œ Node.jsï¼‰**
| è°ƒç”¨æ–¹å¼ | ä»£ç  | æµè§ˆå™¨ä¸­çš„ this | Node.js ä¸­çš„ this |
| - | - | - | - |
| ç›´æ¥è°ƒç”¨ | `foo()`	| window(éä¸¥ï¼‰undefined(ä¸¥ï¼‰| globalï¼ˆéä¸¥ï¼‰undefinedï¼ˆä¸¥ï¼‰|
| éšå¼ç»‘å®š |	`obj.foo()` | obj | obj |
| æ˜¾å¼ç»‘å®š |	`foo.call('abc')` |	`String {'abc'}`(éä¸¥ï¼‰`'abc'`(ä¸¥) |	`[String: 'abc']`(éä¸¥ï¼‰`'abc'`(ä¸¥) |

**ğŸ¤¯ è¿™è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ**
> 1. å‡½æ•°è°ƒç”¨æ—¶ï¼ŒJavaScript **ä¸º this è‡ªåŠ¨ç»‘å®šä¸€ä¸ªå€¼**ï¼› 
> 2. `this` çš„æŒ‡å‘**ä¸å‡½æ•°å®šä¹‰çš„ä½ç½®æ— å…³**ï¼› 
> 3. å®ƒå®Œå…¨ä¾èµ–äºå‡½æ•°çš„**è°ƒç”¨æ–¹å¼**å’Œæ‰€å¤„çš„**è¿è¡Œç¯å¢ƒ**ï¼› 
> 4. `this` æ˜¯åœ¨**è¿è¡Œæ—¶**ç»‘å®šçš„ï¼Œè€Œéç¼–è¯‘æœŸå†³å®šã€‚

  
**é‚£ä¹ˆ this åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„ç»‘å®šè§„åˆ™å‘¢ï¼Ÿ**
> æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸º 4æ¡åŸºç¡€ç»‘å®šè§„åˆ™+1ä¸ªç‰¹æ®Šæƒ…å†µï¼ŒæŒ‰ç…§åŒ¹é…é¡ºåºå¦‚ä¸‹ï¼š

| ä¼˜å…ˆçº§ | ç»‘å®šæ–¹å¼ | ç¤ºä¾‹ | this æŒ‡å‘ |
|----|------|----|---------|
| 1ï¸âƒ£ | new ç»‘å®š | `new Foo()` | æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ˆæ„é€ å™¨çš„å®ä¾‹ï¼‰ |
| 2ï¸âƒ£ | æ˜¾å¼ç»‘å®š | `foo.call(obj)` | `call/apply/bind` æ˜¾å¼ä¼ å…¥çš„å¯¹è±¡ |
| 3ï¸âƒ£ | éšå¼ç»‘å®š | `obj.foo()` | è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡ `obj` |
| 4ï¸âƒ£ | é»˜è®¤ç»‘å®š | `foo()` | éä¸¥ï¼šå…¨å±€å¯¹è±¡ï¼ˆwindow å’Œ global)ï¼Œä¸¥ï¼š`undefined` | 
| +  | ç‰¹æ®Šç»‘å®š | å†…ç½®å‡½æ•° / ç®­å¤´å‡½æ•° / `setTimeout(fn)` | å„æœ‰ä¾‹å¤–ï¼ˆè¯¦è§åæ–‡ï¼‰ |

**ğŸ“Œ å°è´´å£«ï¼šå¦‚ä½•åˆ¤æ–­ this åˆ°åº•ç»‘å®šäº†ä»€ä¹ˆï¼Ÿ**
> æˆ‘ä»¬å¯ä»¥é€šè¿‡â€œ**è°ƒç”¨æ ˆåˆ†ææ³•**â€+â€œä¼˜å…ˆçº§åŒ¹é…â€æ¥åˆ¤æ–­ï¼š
> 1. å‡½æ•°æ˜¯å¦é€šè¿‡ `new` è°ƒç”¨ï¼Ÿ â†’ ä¼˜å…ˆçº§æœ€é«˜
> 2. æ˜¯å¦ä½¿ç”¨äº† `call / apply / bind`ï¼Ÿ â†’ æ˜¾å¼ç»‘å®š 
> 3. æ˜¯å¦ä½œä¸ºå¯¹è±¡å±æ€§è°ƒç”¨ï¼Ÿ â†’ éšå¼ç»‘å®š
> 4. å¦åˆ™ â†’ é»˜è®¤ç»‘å®š
> 5. ç‰¹æ®Šè¯­æ³•ï¼ˆç®­å¤´å‡½æ•°ã€å®šæ—¶å™¨ç­‰ï¼‰å¦è¡Œåˆ†æ

**ğŸ”” å…³äº this çš„è¯¯è§£å¾ˆå¤šï¼Œå¸¸è§é™·é˜±åŒ…æ‹¬ï¼š**
> - å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡æˆ–å‚æ•°åè°ƒç”¨ï¼Œå¯¼è‡´ç»‘å®šä¸¢å¤±ï¼›
> - `setTimeout(fn, 0)` ä¸­ `this` è¢«é‡ç½®ï¼› 
> - `this` å’Œä½œç”¨åŸŸã€é—­åŒ…æ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µï¼› 
> - ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œå®ƒç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸã€‚



## 2. è§„åˆ™ä¸€ï¼šé»˜è®¤ç»‘å®š
:::info **ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤ç»‘å®šï¼Ÿ**
> é»˜è®¤ç»‘å®šçš„è§„åˆ™é€‚ç”¨äº**ç‹¬ç«‹å‡½æ•°è°ƒç”¨**ï¼Œå³ï¼š**å‡½æ•°æ²¡æœ‰è¢«ç»‘å®šåœ¨æŸä¸ªå¯¹è±¡ä¸Šè°ƒç”¨æ—¶ï¼Œthis é»˜è®¤æŒ‡å‘å…¨å±€å¯¹è±¡**ï¼ˆæˆ–ä¸º undefinedï¼Œå–å†³äºæ˜¯å¦å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼‰ã€‚
> 
> æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æ˜¯ä»¥æœ€æ™®é€šçš„æ–¹å¼ç›´æ¥è°ƒç”¨çš„ï¼Œä¾‹å¦‚ foo()ï¼Œè€Œä¸æ˜¯é€šè¿‡å¯¹è±¡å¼•ç”¨è°ƒç”¨ï¼ˆå¦‚ obj.foo()ï¼‰ï¼Œé‚£ä¹ˆé»˜è®¤ç»‘å®šå°±ç”Ÿæ•ˆã€‚
:::
**ğŸ”¹ æ¡ˆä¾‹ä¸€ï¼šæœ€åŸºç¡€çš„ç‹¬ç«‹å‡½æ•°è°ƒç”¨**
```js
function foo() {
  console.log(this)
}

foo()
```
| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ğŸ”¹ æ¡ˆä¾‹äºŒï¼šå‡½æ•°åµŒå¥—è°ƒç”¨ä¸­çš„é»˜è®¤ç»‘å®š**
```js
function fn1() {
  console.log(this)
}

function fn2() {
  fn1() // ç›´æ¥è°ƒç”¨
}

fn2()
```
> fn1() ä½œä¸ºæ™®é€šå‡½æ•°ç›´æ¥è°ƒç”¨ï¼Œå› æ­¤ this åº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚ä¸æ˜¯å¦ç”±å¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨å®ƒæ— å…³ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ğŸ”¹ æ¡ˆä¾‹ä¸‰ï¼šå‡½æ•°å®šä¹‰åœ¨å¯¹è±¡ä¸­ï¼Œä½†é€šè¿‡å˜é‡æˆ–å‚æ•°è°ƒç”¨**
```js
var obj = {
  bar: function () { // obj ä¸­çš„ bar ä¿å­˜çš„å®é™…æ˜¯è¯¥å‡½æ•°çš„å¼•ç”¨(å†…å­˜åœ°å€)
    console.log(this)
  }
}

var baz = obj.bar // baz åœ¨å†…å­˜ä¸­æŒ‡å‘çš„æ˜¯ obj çš„ bar å±æ€§æ‰€æŒ‡å‘çš„å‡½æ•°çš„å†…å­˜åœ°å€
baz() // ç›´æ¥è°ƒç”¨ï¼ˆè¿™é‡Œè°ƒç”¨å®é™…å°±æ˜¯é€šè¿‡å†…å­˜åœ°å€æ‰¾åˆ°å †å†…å­˜ä¸­çš„å‡½æ•°ï¼Œç‹¬ç«‹è°ƒç”¨è¯¥å‡½æ•°ï¼‰
```
> å°½ç®¡å‡½æ•°æœ€åˆæ˜¯å®šä¹‰åœ¨ obj ä¸­çš„ï¼Œä½†é€šè¿‡å˜é‡ baz è°ƒç”¨æ—¶ï¼Œå®ƒå·²ç»â€œè„±ç¦»â€äº†å¯¹è±¡ä¸Šä¸‹æ–‡ã€‚  
> ç›¸å½“äº baz() æ˜¯ç›´æ¥å‡½æ•°è°ƒç”¨ â†’ ä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ğŸ”¹ æ¡ˆä¾‹å››ï¼šé€šè¿‡å‚æ•°ä¼ é€’å‡½æ•°å¼•ç”¨ï¼Œè§¦å‘é»˜è®¤ç»‘å®š**
```js
var obj = {
  bar: function () {
    console.log(this)
  }
}

function fn1(fn) {
  fn() // ç›´æ¥è°ƒç”¨
}
fn1(obj.bar) // è¿™é‡Œä¼ å…¥çš„æ˜¯ obj çš„ bar å±æ€§æ‰€æŒ‡å‘çš„å‡½æ•°çš„å†…å­˜åœ°å€(å¼•ç”¨)
```
> obj.bar æ˜¯ä¸€ä¸ªå‡½æ•°å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œä¼ ç»™ fn1 åæ²¡æœ‰ç»‘å®šåˆ°ä»»ä½•å¯¹è±¡ä¸Šã€‚   
> fn() æ˜¯ç›´æ¥è°ƒç”¨ï¼Œä»ç„¶è§¦å‘é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ğŸ“ é»˜è®¤ç»‘å®šè§„åˆ™**
| åˆ¤æ–­è¦ç‚¹ | this çš„ç»‘å®šå€¼ |
|-|-|
| å‡½æ•°ç›´æ¥è°ƒç”¨ï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰ |	æµè§ˆå™¨ï¼š`window`ï¼›Node.jsï¼š`global` |
| å‡½æ•°ç›´æ¥è°ƒç”¨ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ | `undefined` |
| å‡½æ•°é€šè¿‡å˜é‡å¼•ç”¨æˆ–å‚æ•°ä¼ é€’åç›´æ¥è°ƒç”¨ | é»˜è®¤ç»‘å®šè§„åˆ™ç”Ÿæ•ˆ |

**ğŸ’¡è®°å¿†å°è´´å£«ï¼šå‡½æ•°â€œè„±ç¦»äº†å¯¹è±¡â€ï¼Œå°±ä¼šè½å…¥â€œé»˜è®¤ç»‘å®šâ€çš„æŒæ§ä¹‹ä¸­ã€‚**



## 3. è§„åˆ™äºŒï¼šéšå¼ç»‘å®š
:::info
åœ¨ JavaScript ä¸­ï¼Œ`this` çš„æŒ‡å‘**å¹¶ä¸æ˜¯ç”±å‡½æ•°åœ¨å“ªé‡Œå®šä¹‰å†³å®šçš„ï¼Œè€Œæ˜¯ç”±å®ƒè¢«è°ƒç”¨çš„æ–¹å¼å†³å®šçš„ã€‚
å½“ä¸€ä¸ªå‡½æ•°é€šè¿‡å¯¹è±¡å±æ€§è°ƒç”¨æ—¶ï¼Œthis ä¼šè¢«â€œéšå¼â€ç»‘å®šåˆ°è¯¥å¯¹è±¡ä¸Šã€‚**
:::

**ğŸ” ä»€ä¹ˆæ˜¯éšå¼ç»‘å®šï¼Ÿ**  
```js
// è°ƒç”¨å½¢å¼
object.method()
```
åªè¦å‡½æ•°æ˜¯é€šè¿‡**å¯¹è±¡å±æ€§**æ¥è®¿é—®å¹¶è°ƒç”¨çš„ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼ŒJavaScript å¼•æ“å°±ä¼šå°†è¯¥å¯¹è±¡ç»‘å®šä¸ºå‡½æ•°å†…éƒ¨çš„ `this`ã€‚

**âœ… ç¤ºä¾‹ 1ï¼šåŸºç¡€éšå¼ç»‘å®š**
```js
function sayName() {
  console.log(this.name)
}

const person = {
  name: 'Alice',
  sayName: sayName
}

person.sayName()
```
> å‡½æ•° sayName è¢«ä½œä¸º person å¯¹è±¡çš„å±æ€§æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ this è¢«ç»‘å®šä¸º person å¯¹è±¡ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | 'Alice' | 'Alice' |
| Node.js | 'Alice' | 'Alice' |

**âœ… ç¤ºä¾‹ 2ï¼šå¤šå±‚å¯¹è±¡è®¿é—®**
```js
function greet() {
  console.log(this.name)
}

const user1 = { name: 'Tom', greet: greet }
const user2 = { name: 'Jerry', user1: user1 }

user2.user1.greet()
```
> è°ƒç”¨è¯­å¥æ˜¯ user2.user1.greet()ï¼Œä½†çœŸæ­£è°ƒç”¨å‡½æ•°çš„æ˜¯ user1ï¼› æ‰€ä»¥ this ç»‘å®šä¸º user1ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | 'Tom' | 'Tom' |
| Node.js | 'Tom' | 'Tom' |

**âš ï¸ç¤ºä¾‹ 3ï¼šå‡½æ•°èµ‹å€¼å¯¼è‡´éšå¼ç»‘å®šä¸¢å¤±ï¸**
```js
function show() {
  console.log(this)
}

const obj = {
  show: show
}

const fn = obj.show
fn() // è¾“å‡ºï¼šï¼Ÿ
```
ğŸ§  ä½ å¯èƒ½ä»¥ä¸º this è¿˜æ˜¯ objï¼Œä½†å…¶å®ä¸æ˜¯ï¼
> fn() æ˜¯ç›´æ¥è°ƒç”¨ï¼Œä¸å†é€šè¿‡ objï¼Œæ‰€ä»¥é»˜è®¤ç»‘å®šè§„åˆ™ä¼šç”Ÿæ•ˆã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|--------|--------|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**âš ï¸ç¤ºä¾‹ 4ï¼šå‚æ•°ä¼ é€’æ—¶ä¹Ÿä¼šå‘ç”Ÿéšå¼ä¸¢å¤±**
```js
function display() {
  console.log(this)
}

const context = {
  display: display
}

function callFn(fn) {
  fn() // ç‹¬ç«‹è°ƒç”¨
}

callFn(context.display) // è¾“å‡ºï¼šï¼Ÿ
```
> å°½ç®¡ä¼ å…¥çš„æ˜¯ context.displayï¼Œä½†ä¼ å…¥çš„ä»…ä»…æ˜¯å‡½æ•°å¼•ç”¨ï¼Œä¼ å…¥å‡½æ•°åæ˜¯â€œç›´æ¥è°ƒç”¨â€ï¼Œä¸å†æœ‰å¯¹è±¡ä¸Šä¸‹æ–‡äº†ï¼Œæ‰€ä»¥å‘ç”Ÿäº†éšå¼ç»‘å®šä¸¢å¤±ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|--------|--------|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ğŸ§  å°ç»“ï¼šéšå¼ç»‘å®šçš„è¦ç‚¹**
| è°ƒç”¨æ–¹å¼               | this ç»‘å®šå¯¹è±¡ |
| ------------------ | --------- |
| `obj.fn()`         | obj     |
| `obj1.obj2.fn()`   | obj2    |
| `var fn = obj.fn`  | é»˜è®¤ç»‘å®šï¼ˆéšå¼ç»‘å®šä¸¢å¤±ï¼‰  |
| `callback(obj.fn)` | é»˜è®¤ç»‘å®šï¼ˆéšå¼ç»‘å®šä¸¢å¤±ï¼‰  |


## 4. è§„åˆ™ä¸‰ï¼šæ˜¾å¼ç»‘å®š
:::info
åœ¨éšå¼ç»‘å®šä¸­ï¼Œ`this` çš„ç»‘å®šä¾èµ–äºè°ƒç”¨å¯¹è±¡ã€‚è€Œ**æ˜¾å¼ç»‘å®š**å…è®¸æˆ‘ä»¬é€šè¿‡ callã€apply å’Œ bind **â€œæ‰‹åŠ¨æŒ‡å®šâ€ this çš„æŒ‡å‘**ï¼Œä¸å†ä¾èµ–äºè°ƒç”¨ä½ç½®ã€‚
:::

**ğŸ“Œ ä»€ä¹ˆæ˜¯æ˜¾å¼ç»‘å®šï¼Ÿ**
> JavaScript ä¸­æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ‹¥æœ‰ `.call()` å’Œ `.apply()` æ–¹æ³•ï¼Œå®ƒä»¬çš„**ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç”¨äºç»‘å®š this çš„å€¼**ã€‚
```js
func.call(thisArg, arg1, arg2, ...)    // å‚æ•°åˆ—è¡¨
func.apply(thisArg, [arg1, arg2, ...]) // å‚æ•°æ•°ç»„
```
> thisArgï¼šå‡½æ•°è¿è¡Œæ—¶è¦ç»‘å®šä¸º this çš„å¯¹è±¡ï¼Œåç»­å‚æ•°åˆ†åˆ«ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ã€‚

å¯¹äºè¿™ç±»ï¼Œæ˜ç¡®äº† this è¦ç»‘å®šçš„å¯¹è±¡çš„è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º**æ˜¾å¼ç»‘å®š**ã€‚

**âœ… ç¤ºä¾‹ 1ï¼šä½¿ç”¨ call æ˜¾å¼ç»‘å®š**
```js
function sayHello() {
  console.log(this.name)
}

const person = { name: 'Later' }

sayHello.call(person)
```
> sayHello åŸæœ¬æ˜¯ç‹¬ç«‹å‡½æ•°ï¼Œé€šè¿‡ .call(person) æ˜¾å¼ç»‘å®š thisï¼Œä½¿å…¶æŒ‡å‘ personã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-------|------|
| æµè§ˆå™¨ | 'Later' | 'Later' |
| Node.js | 'Later' | 'Later' |

**âœ… ç¤ºä¾‹ 2ï¼šä½¿ç”¨ apply æ˜¾å¼ç»‘å®š + ä¼ å‚**
```js
function introduce(language, hobby) {
  console.log(`${this.name} speaks ${language} and likes ${hobby}`)
}

const user = { name: 'Alice' }

introduce.apply(user, ['JavaScript', 'reading']) 
```
> .apply() ä¸ .call() åŒºåˆ«ä»…åœ¨å‚æ•°å½¢å¼ï¼Œthis æ˜¾å¼ç»‘å®šä¸º userã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|---|--|
| æµè§ˆå™¨ | 'Alice speaks JavaScript and likes reading' | 'Alice speaks JavaScript and likes reading' |
| Node.js | 'Alice speaks JavaScript and likes reading' | 'Alice speaks JavaScript and likes reading' |

**ğŸ§© ç¤ºä¾‹ 3ï¼šå‡½æ•°å®šä¹‰ä¸åœ¨å¯¹è±¡ä¸­ï¼Œä½†å¯å¯¹ä»»æ„å¯¹è±¡è°ƒç”¨**
```js
function showAge() {
  console.log(this.age)
}

const user = { age: 20 }

showAge.call(user)
```
> ä¸éœ€è¦å‡½æ•°å†™åœ¨å¯¹è±¡ä¸­ï¼Œä¹Ÿèƒ½è®©å®ƒâ€œåƒæ˜¯â€å±äºå¯¹è±¡ä¸€æ ·è¢«è°ƒç”¨ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|----|----|
| æµè§ˆå™¨ | 20 | 20 |
| Node.js | 20 | 20 |

**âœ… ç¤ºä¾‹ 4ï¼šbind è¿”å›æ–°å‡½æ•°å¹¶ç»‘å®š this**
```js
function greet() {
  console.log(this.name)
}

const user = { name: 'Later' }

const boundGreet = greet.bind(user)

boundGreet() // è¾“å‡ºï¼š'Later'
```
> .bind() ä¸ä¼šç«‹å³è°ƒç”¨å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæ°¸ä¹…ç»‘å®šäº† this çš„æ–°å‡½æ•°ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|----|----|
| æµè§ˆå™¨ | 'Later' | 'Later' |
| Node.js | 'Later' | 'Later' |

**âš ï¸ æ³¨æ„äº‹é¡¹**
1. **call å’Œ apply æ˜¯ç«‹å³è°ƒç”¨ï¼ˆå•æ¬¡ç»‘å®šï¼‰**ï¼› 
2. **bind æ˜¯è¿”å›å‡½æ•°ï¼ˆæ°¸ä¹…ç»‘å®šï¼‰**ï¼› 
3. **æ˜¾å¼ç»‘å®šä¼˜å…ˆçº§é«˜äºéšå¼ç»‘å®šï¼**
```js
function say() {
  console.log(this.name)
}

const obj = { name: 'Tom' }
const obj2 = { name: 'Jerry', say: say }

obj2.say.call(obj)
```
> è™½ç„¶åŸæœ¬ obj2.say() æ˜¯éšå¼ç»‘å®šï¼Œä½† call(obj) æ˜¾å¼ç»‘å®šåï¼Œä»¥ obj ä¸ºå‡†ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|----|----|
| æµè§ˆå™¨ | 'Tom' | 'Tom' |
| Node.js | 'Tom' | 'Tom' |

**ğŸ§  å°ç»“**
| æ–¹æ³•      | æ˜¯å¦ç«‹å³è°ƒç”¨    | æ˜¯å¦æ”¹å˜ this | å‚æ•°å½¢å¼     |
| ------- | --------- | --------- | -------- |
| call  | âœ… æ˜¯       | âœ… æ˜¯       | é€—å·åˆ†éš”å‚æ•°åˆ—è¡¨ |
| apply | âœ… æ˜¯       | âœ… æ˜¯       | å‚æ•°æ•°ç»„     |
| bind  | âŒ å¦ï¼ˆè¿”å›å‡½æ•°ï¼‰ | âœ… æ˜¯ï¼ˆæ°¸ä¹…ç»‘å®šï¼‰ | å‚æ•°åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ |



## 5. è§„åˆ™å››ï¼šnew ç»‘å®š
:::info
åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°ä¸ä»…ä»…æ˜¯å¯è°ƒç”¨çš„å•ä½ï¼Œä¹Ÿå¯ä»¥è¢«**å½“ä½œæ„é€ å‡½æ•°ä½¿ç”¨**ã€‚é€šè¿‡ `new` å…³é”®å­—è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šè§¦å‘ä¸€å¥—ç‹¬ç‰¹çš„ç»‘å®šè§„åˆ™ â€”â€” **`this` ä¼šç»‘å®šåˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ä¸Š**ã€‚
:::

**ğŸ“Œ ä»€ä¹ˆæ˜¯ new ç»‘å®šï¼Ÿ** 

å½“æˆ‘ä»¬ä½¿ç”¨ new è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šæ‰§è¡Œå¦‚ä¸‹ 4 ä¸ªæ­¥éª¤ï¼š
> 1. åœ¨å †å†…å­˜ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç©ºå¯¹è±¡ï¼›
> 2. è¿™ä¸ªæ–°å¯¹è±¡çš„éšå¼åŸå‹ `__proto__` è¢«è¿æ¥åˆ°å‡½æ•°çš„æ˜¾å¼åŸå‹ `prototype` å±æ€§ä¸Šï¼› 
> 3. å‡½æ•°å†…éƒ¨çš„ `this` è¢«ç»‘å®šåˆ°è¿™ä¸ªæ–°å¯¹è±¡ä¸Šï¼›
> 4. æ‰§è¡Œå‡½æ•°ä½“ä»£ç ï¼Œå¦‚æœè¯¥å‡½æ•°æ²¡æœ‰æ˜¾å¼è¿”å›ä¸€ä¸ª**å¯¹è±¡ç±»å‹**ï¼ˆ**å…¶ä»–ç±»å‹æ— æ•ˆï¼Œä¼šè¿”å›éšå¼åˆ›å»ºçš„æ–°å¯¹è±¡**ï¼‰ï¼Œåˆ™éšå¼è¿”å›è¿™ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ã€‚

ä½¿ç”¨ new å…³é”®å­—æ¥è°ƒç”¨å‡½æ•°æ˜¯ä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š
```js
function Person(name) {
  console.log(this) // this æŒ‡å‘å †å†…å­˜ä¸­æ–°åˆ›å»ºçš„ç©ºå¯¹è±¡
  console.log(this == p1) // false å› ä¸ºè¿™æ—¶p1è¿˜åªæ˜¯ä¸ªundefinedï¼Œåœ¨å †å†…å­˜ä¸­æ–°åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡è¿™æ—¶è¿˜å¹¶æ²¡æœ‰èµ‹å€¼ç»™p1
  this.name = name
}

var p1  = new Person('later')
console.log(p1) // Person {name: 'later'} è¿™ä¸ªæ—¶å€™p1å·²ç»æ‹¿åˆ°åˆ›å»ºå‡ºæ¥çš„æ–°å¯¹è±¡çš„å¼•ç”¨äº†
```

**âœ… ç¤ºä¾‹ 1ï¼šåŸºç¡€æ„é€ å‡½æ•°ä½¿ç”¨**  
```js
function Person(name) {
  console.log(this) // è¾“å‡ºï¼šæ–°åˆ›å»ºçš„å¯¹è±¡
  this.name = name
}

const p1 = new Person('Later')
console.log(p1) // è¾“å‡ºï¼šPerson { name: 'Later' }
```
> - new Person() è‡ªåŠ¨å°† this æŒ‡å‘ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›
> - this.name = name ç»™æ–°å¯¹è±¡èµ‹å€¼ï¼›
> - è¿”å›æ–°å¯¹è±¡èµ‹å€¼ç»™ p1ã€‚

**â“ ä¸ºä½• this == p1 æ˜¯ falseï¼Ÿ**
```js
function Person(name) {
  console.log(this == p1) // falseï¼Œå› ä¸ºæ­¤æ—¶è¿˜æœªèµ‹å€¼ç»™ p1ï¼Œç­‰å‡½æ•°ä½“ä¸­ä»£ç æ‰§è¡Œå®Œæˆæ‰ä¼šèµ‹å€¼ç»™ p1ã€‚
  this.name = name
}
const p1 = new Person('Later')
```
> - this æŒ‡å‘æ–°åˆ›å»ºå¯¹è±¡ï¼› 
> - ä½† p1 å˜é‡ç›´åˆ°æ„é€ å‡½æ•°è¿”å›åï¼Œæ‰ä¼šæ‹¿åˆ°è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚

**âœ… ç¤ºä¾‹ 2ï¼šæ„é€ å‡½æ•°æ˜¾å¼è¿”å›å¯¹è±¡æ—¶**
```js
function Foo() {
  this.name = 'Later'
  return { name: 'Override' }
}

const obj = new Foo()
console.log(obj) // è¾“å‡ºï¼š{ name: 'Override' }
```
> - å¦‚æœæ„é€ å‡½æ•°æ˜¾å¼è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¦†ç›–é»˜è®¤è¿”å›çš„ thisï¼›
> - ä½†å¦‚æœ**è¿”å›çš„æ˜¯éå¯¹è±¡ç±»å‹**ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰ï¼Œåˆ™**å¿½ç•¥è¿”å›å€¼**ï¼š
```js
function Foo() {
  this.name = 'Later'
  return 'hello'
}

console.log(new Foo()) // è¾“å‡ºï¼šFoo { name: 'Later' }
```

**ğŸ“Š new vs æ™®é€šè°ƒç”¨å¯¹æ¯”**
| åœºæ™¯        | æ™®é€šè°ƒç”¨          | new è°ƒç”¨             |
| --------- | ------------- | -------------------- |
| this æŒ‡å‘ | å—é»˜è®¤/éšå¼/æ˜¾å¼ç»‘å®šæ§åˆ¶ | å§‹ç»ˆæŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡           |
| æ˜¯å¦åˆ›å»ºå¯¹è±¡    | âŒ å¦           | âœ… æ˜¯ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°å¯¹è±¡å¹¶ç»‘å®šåŸå‹     |
| è¿”å›å€¼å¤„ç†     | æ­£å¸¸è¿”å›          | æ˜¾å¼è¿”å›å¯¹è±¡ç±»å‹ä¼šæ›¿æ¢é»˜è®¤è¿”å›ï¼›å…¶ä»–ç±»å‹æ— æ•ˆ |



## 6. ç‰¹æ®Šè§„åˆ™ï¼šå†…ç½®å›è°ƒä¸­çš„ this æ˜¯æ€ä¹ˆç»‘å®šçš„ï¼Ÿ
:::info
åœ¨å®é™…å¼€å‘ä¸­ï¼Œé™¤äº†æˆ‘ä»¬èƒ½ç›´æ¥æ§åˆ¶è°ƒç”¨æ–¹å¼çš„å‡½æ•°å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šâ€œä½ ä¸ä¼šç›´æ¥è°ƒç”¨ï¼Œä½†ä¼šä¼ ç»™ç³»ç»Ÿæˆ–æ¡†æ¶è°ƒç”¨â€çš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼š 
> setTimeout çš„å›è°ƒå‡½æ•°ã€DOM å…ƒç´ ä¸Šçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€forEach ç­‰æ•°ç»„æ–¹æ³•çš„å›è°ƒå‡½æ•°ã€‚

è¿™äº›å‡½æ•°çš„ this æ˜¯ç”± **JavaScript å¼•æ“æˆ–å®¿ä¸»ç¯å¢ƒå†³å®šçš„**ï¼Œä¸éµå¾ªæˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„å››å¤§è§„åˆ™ï¼Œå±äºç‰¹æ®Šç»‘å®šåœºæ™¯ã€‚
:::

**1ï¸âƒ£ é—®é¢˜ä¸€ï¼šsetTimeout å›è°ƒå‡½æ•°ä¸­çš„ this åˆ°åº•æ˜¯è°ï¼Ÿ**

â“å®é™…å¼€å‘ä¸­æˆ‘ä»¬å¸¸ä¼šå†™å‡ºè¿™æ ·çš„ä»£ç ï¼š
```js
setTimeout(function () {
  console.log(this)
}, 1000)
```
> - è¿™ä¸ªå‡½æ•°ä¸æ˜¯æˆ‘ä»¬è°ƒç”¨çš„ï¼Œè€Œæ˜¯ JS å¼•æ“åœ¨ 1000ms åè‡ªåŠ¨è°ƒç”¨çš„ï¼›   
> - æˆ‘ä»¬æ²¡æœ‰ä»»ä½•â€œè°ƒç”¨æ–¹â€ï¼Œä¹Ÿæ— æ³•æŒ‡å®šï¼›
>- é‚£ä¹ˆ this åˆ°åº•æŒ‡å‘è°ï¼Ÿ

ğŸ“‹ è¾“å‡ºç»“æœå¯¹æ¯”ï¼š
| è¿è¡Œç¯å¢ƒ    | ä¸¥æ ¼æ¨¡å¼ this    | éä¸¥æ ¼æ¨¡å¼ this   |
| ------- | ------------ | ------------ |
| æµè§ˆå™¨ | window | window |
| Node.js | Timeout å¯¹è±¡ | Timeout å¯¹è±¡ |

âœ… åŸå› è§£æï¼š
> - åœ¨æµè§ˆå™¨ä¸­ï¼Œæ— è®ºæ˜¯å¦ä¸¥æ ¼æ¨¡å¼ï¼ŒsetTimeout å›è°ƒå‡½æ•°ä¸­çš„ this ä¼šè¢«éšå¼ç»‘å®šåˆ° windowï¼›
> - åœ¨ Node.js ä¸­ï¼Œæ— è®ºæ˜¯å¦ä¸¥æ ¼æ¨¡å¼ï¼ŒsetTimeout å›è°ƒå‡½æ•°ç”± lib/timers.js ä¸­è°ƒåº¦ï¼Œthis æ˜¯ä¸€ä¸ª Timeout åŒ…è£…å¯¹è±¡ï¼›

**âœ… å®æˆ˜å»ºè®®ï¼šä½¿ç”¨ç®­å¤´å‡½æ•°è§£å†³ this ä¸¢å¤±**
```js
const obj = {
  name: 'Later',
  run() {
    setTimeout(() => {
      console.log(this.name) // 'Later'
    }, 1000)
  }
}

obj.run()
```
> - ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ thisï¼Œä¼šä»å®šä¹‰ä½ç½®å‘ä¸Šå¯»æ‰¾ï¼›
> - æ‰€ä»¥æ­¤å¤„çš„ this æ­£ç¡®ç»‘å®šåˆ° objã€‚

ğŸ“‹ è¾“å‡ºç»“æœå¯¹æ¯”ï¼š
| è¿è¡Œç¯å¢ƒ | ä¸¥æ ¼æ¨¡å¼ | éä¸¥æ ¼æ¨¡å¼ |
| ------- | ------------ | ------------ |
| æµè§ˆå™¨ | Later | Later |
| Node.js | Later | Later |

**2ï¸âƒ£ é—®é¢˜äºŒï¼šDOM äº‹ä»¶å›è°ƒä¸­çš„ this æ˜¯è°ï¼Ÿ**

â“åœ¨æµè§ˆå™¨ç½‘é¡µå¼€å‘ä¸­ï¼Œä½ æ˜¯å¦å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Ÿ
```js
btn.onclick = function () {
  console.log(this === btn) // ğŸ‘‰ true
}
```

âœ… åŸå› ï¼š
> - åœ¨æµè§ˆå™¨ä¸­ï¼Œäº‹ä»¶ç›‘å¬å™¨é‡Œçš„ this ä¼šè¢«éšå¼ç»‘å®šä¸ºè§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼›
> - å®¿ä¸»ç¯å¢ƒå¸®ä½ åšäº† this çš„ç»‘å®šã€‚

âŒ å¦‚æœä½ ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š
```js
btn.onclick = () => {
  console.log(this) // ğŸ‘‰ windowï¼ˆæˆ– undefinedï¼‰ï¼Œä¸æ˜¯ btnï¼
}
```
**ğŸ“‹ äº‹ä»¶å›è°ƒä¸­çš„ this å¯¹æ¯”ï¼š**
| å†™æ³•       | this æŒ‡å‘      | å¯æ§åˆ¶æ€§   |
| -------- | ------------ | ------ |
| function | äº‹ä»¶è§¦å‘çš„ DOM å…ƒç´  | âŒ è‡ªåŠ¨ç»‘å®š |
| ç®­å¤´å‡½æ•°     | å¤–å±‚ä½œç”¨åŸŸçš„ this  | âŒ æ— æ³•ç»‘å®š |

âœ… å®æˆ˜å»ºè®®ï¼š
> - éœ€è¦è®¿é—®å½“å‰å…ƒç´ æ—¶ï¼Œä¸€å®šä½¿ç”¨æ™®é€šå‡½æ•°ï¼› 
> - å¦‚æœä½ ä¸å…³å¿ƒ this æˆ–æƒ³ç”¨ç®­å¤´å‡½æ•°ä¿æŒä¸Šä¸‹æ–‡ï¼Œç¡®ä¿ä¸ä¼šç”¨åˆ°äº‹ä»¶æºã€‚

**3ï¸âƒ£ é—®é¢˜ä¸‰ï¼šæ•°ç»„ forEach/map ç­‰æ–¹æ³•ä¸­çš„å›è°ƒ this æ˜¯è°ï¼Ÿ**

â“ä½ å†™è¿‡ç±»ä¼¼ä»£ç å—ï¼Ÿ
```js
const list = ['a', 'b', 'c']
list.forEach(function (item) {
  console.log(this) // æ˜¯ä»€ä¹ˆï¼Ÿ
})
```
ğŸ“‹ è¾“å‡ºç»“æœå¯¹æ¯”ï¼š
| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼ | ä¸¥æ ¼æ¨¡å¼ |
| ------- | ------------ | ------------ |
| æµè§ˆå™¨ | window | undefined |
| Node.js | globalThis | undefined |

ä½†ä½ å¯ä»¥è¿™æ ·æ˜ç¡®æŒ‡å®šï¼š
```js
const context = { name: 'Later' }

list.forEach(function (item) {
  console.log(this.name) // ğŸ‘‰ 'Later'
}, context)
```

âš ï¸ æ³¨æ„ç®­å¤´å‡½æ•°ä¸ä¼šç»‘å®š thisï¼š
```js
list.forEach(item => {
  console.log(this) // å¤–å±‚ä½œç”¨åŸŸçš„ thisï¼Œä¸ä¼šæ˜¯ context
}, { name: 'no effect' })
```

**ğŸ“‹ forEach å›è°ƒä¸­çš„ this å¯¹æ¯”ï¼š**
| å½¢å¼                  | ä¸¥æ ¼æ¨¡å¼ this   | éä¸¥æ ¼æ¨¡å¼ this                    |
| ------------------- | ----------- | ----------------------------- |
| functionï¼Œæ—  thisArg  | `undefined` | `window`ï¼ˆæµè§ˆå™¨ï¼‰æˆ– `global`ï¼ˆNodeï¼‰ |
| functionï¼Œæœ‰ thisArg  | thisArg     | thisArg                       |
| ç®­å¤´å‡½æ•°ï¼ˆä¸ç®¡æ˜¯å¦ä¼  thisArgï¼‰ | å¤–å±‚ä½œç”¨åŸŸ this  | å¤–å±‚ä½œç”¨åŸŸ this                    |

**ğŸ§  æ€»ç»“å»ºè®®ï¼š**
| åœºæ™¯                 | this ç»‘å®šè¡Œä¸º                    | æ¨èä½¿ç”¨æ–¹å¼                   |
| ------------------ | ---------------------------- | ------------------------ |
| setTimeout(fn)   | æµè§ˆå™¨ï¼šwindow<br>Nodeï¼šTimeoutå¯¹è±¡ | ä½¿ç”¨ç®­å¤´å‡½æ•°ç»§æ‰¿å¤–éƒ¨ this          |
| DOM äº‹ä»¶ï¼ˆfunctionï¼‰   | this === äº‹ä»¶æºå…ƒç´                | ä¿ç•™æ™®é€šå‡½æ•°è¯­æ³•                 |
| DOM äº‹ä»¶ï¼ˆç®­å¤´ï¼‰         | this === å¤–å±‚ä½œç”¨åŸŸ               | ä¸å»ºè®®ç”¨äºæ“ä½œå½“å‰å…ƒç´               |
| forEach(fn, ctx) | ctx æˆ–é»˜è®¤è§„åˆ™                    | ç”¨ function + thisArg æœ€ç¨³å¦¥ |
| forEach(arrow)   | this ä¸ºå¤–å±‚ä½œç”¨åŸŸ                  | æ¨èç”¨äºæ—  this æ“ä½œçš„ç®€æ´åœºæ™¯       |



# äºŒ. apply / call / bindï¼ˆåˆ›å»ºç»‘å®š this çš„å‡½æ•°ï¼‰

::: info ğŸš©å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜
åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›æŸä¸ªå‡½æ•°â€œå±äºå¯¹è±¡â€ï¼Œä½†åˆæƒ³ä¸´æ—¶æŠŠå®ƒçš„ this æŒ‡å‘æŸä¸ªå¯¹è±¡ã€‚  
ç­”æ¡ˆæ˜¯ï¼šä½¿ç”¨ JavaScript ä¸ºå‡½æ•°æä¾›çš„ 3 ä¸ªå·¥å…·æ–¹æ³•ï¼š call()ã€apply()ã€bind()ã€‚
:::
ä¾‹å¦‚ï¼š
```js
function printInfo() {
  console.log(this.name)
}

const user = { name: 'Later' }

printInfo()         // âŒ this æ˜¯ window æˆ– undefined
user.printInfo = printInfo
user.printInfo()    // âœ… this æ˜¯ user
```
> ä½†æˆ‘å…¶å®å¹¶ä¸æƒ³å†™ user.printInfo = printInfo è¿™æ ·å¤šä½™çš„èµ‹å€¼ï¼Œæˆ‘åªæƒ³ä¸´æ—¶æŒ‡å®š thisï¼Œå°±åƒä¸‹é¢è¿™æ ·ç›´æ¥è°ƒç”¨ï¼š
```js
printInfo.call(user)
```
> äºæ˜¯æˆ‘ä»¬å°±éœ€è¦ JavaScript æä¾›çš„ä¸‰ä¸ªå·¥å…·å‡½æ•°ï¼šcall / apply / bind â€”â€” å®ƒä»¬éƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š 
> ğŸ§­ â€œå¦‚ä½•åœ¨ä¸æ”¹å˜å‡½æ•°å®šä¹‰ä½ç½®çš„å‰æä¸‹ï¼Œæ§åˆ¶ this çš„ç»‘å®šï¼Ÿâ€

**1ï¸âƒ£ æ˜¾å¼ç»‘å®šï¼šä½¿ç”¨ call() / apply()**

è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½èƒ½åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ˜¾å¼æŒ‡å®š thisã€‚

è¯­æ³•åŒºåˆ«ï¼š
```js
func.call(thisArg, arg1, arg2, ...)
func.apply(thisArg, [arg1, arg2, ...])
```
> - ç¬¬ä¸€ä¸ªå‚æ•° thisArgï¼šè¦ç»‘å®šçš„ this å¯¹è±¡ï¼›
> - å…¶ä»–å‚æ•°ï¼šå‡½æ•°çš„å®å‚ï¼ˆcall ç”¨å‚æ•°åˆ—è¡¨ä¼ å…¥ã€apply ç”¨æ•°ç»„ä¼ å…¥ï¼‰ï¼›
> - éƒ½æ˜¯ç«‹å³æ‰§è¡Œã€‚

**ğŸ§ª æ¡ˆä¾‹ä¸€ï¼šcall/apply ç»‘å®š this**
```js
function bar() {
  console.log(this)
}

bar.call({ name: 'later' }) // output: { name: 'later' }
bar.call(123)               // output: Numberå¯¹è±¡ï¼ŒåŒ…è£…123
```
> - bar() æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œé»˜è®¤ç»‘å®šè§„åˆ™ä¸‹ä¼šæŒ‡å‘ windowï¼ˆéä¸¥æ ¼ï¼‰ï¼›
> - ä½†é€šè¿‡ call()ï¼Œæˆ‘ä»¬å¼ºåˆ¶å°† this æŒ‡å‘ä¼ å…¥çš„å¯¹è±¡ï¼›
> - å³ä½¿ä¼ å…¥çš„æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œä¹Ÿä¼šè‡ªåŠ¨è¢«åŒ…è£…æˆå¯¹è±¡ï¼ˆå¦‚ 123 â†’ new Number(123)ï¼‰ã€‚

**ğŸ§ª æ¡ˆä¾‹äºŒï¼šä¼ é€’å‚æ•°**
```js
function foo(name, age, height) {
  console.log("fooå‡½æ•°è¢«è°ƒç”¨:", this)
  console.log("æ‰“å°å‚æ•°:", name, age, height)
}

// apply: å‚æ•°ä½œä¸ºæ•°ç»„ä¼ å…¥
foo.apply("apply", ["kobe", 30, 1.98])

// call: å‚æ•°ä»¥é€—å·åˆ†éš”
foo.call("call", "james", 25, 2.05)
```

**ğŸ§ª ç¤ºä¾‹ä¸‰ï¼šç»‘å®šåŸå§‹ç±»å‹æˆ– null/undefined**
```js
function show() {
  console.log(this)
}

show.call(123)        // Number åŒ…è£…å¯¹è±¡
show.call('abc')      // String åŒ…è£…å¯¹è±¡
show.call(null)       // é»˜è®¤ç»‘å®šè§„åˆ™ç”Ÿæ•ˆ
show.call(undefined)  // åŒä¸Š
```

ğŸ“‹ è¿è¡Œç¯å¢ƒå·®å¼‚è¡¨ï¼š
| thisArg | æµè§ˆå™¨ éä¸¥æ ¼ | æµè§ˆå™¨ ä¸¥æ ¼ | Node éä¸¥æ ¼   | Node ä¸¥æ ¼ |
| ------- | ---------- | ----------- | ---------- | ---------- |
| 123       | `Number {123}` | 123  | `[String: 'abc']` | 123  |
| 'abc'     | `String {'abc'}` | 'abc'  | `[Number: 123]` | 'abc' |
| null      | window   | null      | global   | null      |
| undefined | window   | undefined | global   | undefined |

::: info å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªå‡½æ•°æ€»æ˜¯æ˜¾å¼çš„ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œå¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ
ä½¿ç”¨ bind
:::
**2ï¸âƒ£ bindï¼šä¸æ‰§è¡Œå‡½æ•°ï¼Œåªè¿”å›ä¸€ä¸ªâ€œæ°¸ä¹…ç»‘å®šäº† this çš„æ–°å‡½æ•°â€**

ğŸ“˜ åŸºæœ¬è¯­æ³•ï¼š
```js
const newFn = fn.bind(thisArg, preset1, preset2, ...)
```
> - ä¸ä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œæ˜¯**è¿”å›ä¸€ä¸ªæ–°çš„ç»‘å®šäº† this çš„å‡½æ•°ï¼ˆBound Functionï¼ŒBFï¼‰**;
> - ç»‘å®šå‡½æ•°æ˜¯ä¸€ä¸ª` exotic function object`ï¼ˆ**æ€ªå¼‚å‡½æ•°å¯¹è±¡**ï¼Œ`es6 `ä¸­çš„æœ¯è¯­ï¼‰
> - å¯â€œé¢„è®¾â€éƒ¨åˆ†å‚æ•°ï¼ˆç±»ä¼¼æŸ¯é‡ŒåŒ–ï¼‰ï¼Œè°ƒç”¨æ—¶è‡ªåŠ¨å¡«å……ã€‚bind çš„å¦ä¸€ä¸ªæœ€ç®€å•çš„ç”¨æ³•æ˜¯ä½¿ä¸€ä¸ªå‡½æ•°æ‹¥æœ‰é¢„è®¾çš„åˆå§‹å‚æ•°ï¼š**bind æ–¹æ³•ä¸­ä¼ å…¥çš„é™¤ thisArg ä¹‹å¤–çš„å…¶ä½™å‚æ•°ï¼Œä¼šä½œä¸ºè¿”å›çš„æ–°å‡½æ•°çš„åˆå§‹å‚æ•°ï¼Œè€Œæ–°å‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ä¼šæ’åœ¨è¿™äº›åˆå§‹ï¼ˆé¢„è®¾ï¼‰å‚æ•°ä¹‹å**ã€‚

**ğŸ§ª ç¤ºä¾‹ï¼šå»¶è¿Ÿè°ƒç”¨ + é¢„è®¾å‚æ•°**
```js
function add(a, b, c) {
  console.log(this.name, a, b, c)
}

const obj = { name: 'Later' }

const boundFn = add.bind(obj, 1) // é¢„è®¾å‚æ•°
boundFn(2, 3)  // Later 1 2 3
```
> bind(obj, 1)ï¼šè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè°ƒç”¨å®ƒæ—¶ this æ°¸è¿œæ˜¯ objï¼Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°å§‹ç»ˆæ˜¯ 1ã€‚

**âš ï¸ bind å‡½æ•°çš„ this æ˜¯ä¸å¯å†æ›´æ”¹çš„**
```js
const boundFn = foo.bind({ name: 'A' })
boundFn.call({ name: 'B' }) // ä»ç„¶è¾“å‡º Aï¼Œä¸æ˜¯ B
```
> ä¸€æ—¦ bind ç»‘å®šäº† thisï¼Œå°±æ— æ³•é€šè¿‡ call/apply å†æ¬¡ä¿®æ”¹ã€‚

**3ï¸âƒ£ âš ï¸ ç®­å¤´å‡½æ•°ä¸æ”¯æŒ call / apply / bind ç»‘å®š this**
> ç”±äºç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ this æŒ‡é’ˆï¼Œé€šè¿‡ call() æˆ– apply() æ–¹æ³•è°ƒç”¨ä¸€ä¸ªç®­å¤´å‡½æ•°æ—¶ï¼Œåªèƒ½ä¼ é€’å‚æ•°ï¼ˆä¸èƒ½ç»‘å®š thisï¼‰ï¼Œä»–ä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å¿½ç•¥ã€‚ï¼ˆè¿™ç§ç°è±¡å¯¹äº bind æ–¹æ³•åŒæ ·æˆç«‹ï¼‰

ä¾‹å¦‚ï¼š
```js
var adder = {
  base: 1,
  add: function(a) {
    var f = v => v + this.base
    return f(a)
  },
  addThruCall: function(a) {
    var f = v => v + this.base
    var b = { base: 2 }
    return f.call(b, a) // call æ— æ•ˆ
  }
}

console.log(adder.add(1))         // è¾“å‡º 2
console.log(adder.addThruCall(1)) // ä»ç„¶è¾“å‡º 2
```
> f æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œthis åªèƒ½ä»å®šä¹‰æ—¶å¤–å±‚ä½œç”¨åŸŸæ•è·ï¼Œcall(b) æ— æ•ˆï¼

**âœ… æ€»ç»“ & å¯¹æ¯”è¡¨**
| æ–¹æ³• | æ˜¯å¦ç«‹å³è°ƒç”¨ | è¿”å›æ–°å‡½æ•°ï¼Ÿ | å‚æ•°å½¢å¼      | æ˜¯å¦èƒ½ç»‘å®š this | ç®­å¤´å‡½æ•°ç”Ÿæ•ˆï¼Ÿ |
| ----- | ------ | ------ | --------- | ---------- | ------- |
| call  | âœ…      | âŒ      | å‚æ•°åˆ—è¡¨      | âœ…          | âŒï¼ˆæ— æ•ˆï¼‰   |
| apply | âœ…      | âŒ      | å‚æ•°æ•°ç»„      | âœ…          | âŒï¼ˆæ— æ•ˆï¼‰   |
| bind  | âŒ      | âœ…      | å‚æ•°é¢„è®¾+è°ƒç”¨è¿½åŠ  | âœ…ï¼ˆä¸”ä¸å¯è¢«æ”¹ï¼‰   | âŒï¼ˆæ— æ•ˆï¼‰   |

**ğŸ¯ å®æˆ˜ä½¿ç”¨å»ºè®®**
| éœ€æ±‚åœºæ™¯ | æ¨èæ–¹æ³• |
| ---------------- | ------------ |
| ç«‹å³æ‰§è¡Œ + æŒ‡å®š this          | call æˆ– apply |
| å»¶è¿Ÿæ‰§è¡Œ + this æ°¸ä¹…ç»‘å®š       | bind  |
| æƒ³ä¿®æ”¹ç®­å¤´å‡½æ•°çš„ thisï¼ˆåˆ«æƒ³äº†ï¼‰  | ä¸å¯èƒ½ |
| è¦å…¼å®¹æ•°ç»„å‚æ•°ï¼ˆå¦‚ from applyï¼‰ | apply |



# ä¸‰. this çš„ç»‘å®šä¼˜å…ˆçº§å¯¹æ¯”
:::info
å­¦ä¹ äº†å››æ¡è§„åˆ™ï¼Œæ¥ä¸‹æ¥å¼€å‘ä¸­æˆ‘ä»¬åªéœ€è¦å»æŸ¥æ‰¾å‡½æ•°çš„è°ƒç”¨åº”ç”¨äº†å“ªæ¡è§„åˆ™å³å¯ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå‡½æ•°è°ƒç”¨ä½ç½®åº”ç”¨äº†å¤šæ¡è§„åˆ™ï¼Œä¼˜å…ˆçº§è°æ›´é«˜å‘¢ï¼Ÿ
:::

**1ï¸âƒ£ é»˜è®¤ç»‘å®šä¼˜å…ˆçº§æœ€ä½**
> æ¯«æ— ç–‘é—®ï¼Œé»˜è®¤è§„åˆ™çš„ä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œä¸€æ—¦å­˜åœ¨å…¶ä»–è§„åˆ™ï¼Œé»˜è®¤ç»‘å®šä¼šè¢«å®Œå…¨è¦†ç›–ã€‚
```js
function foo() {
  console.log(this)
}

foo() // é»˜è®¤ç»‘å®šï¼šæµè§ˆå™¨ä¸­ this -> window
foo.call({ name: 'later' }) // æ˜¾å¼ç»‘å®šï¼Œthis -> { name: 'later' }
```

**2ï¸âƒ£ æ˜¾å¼ç»‘å®š > éšå¼ç»‘å®š**
> å½“éšå¼ç»‘å®šä¸ call/apply æ˜¾å¼ç»‘å®šå†²çªæ—¶ï¼Œæ˜¾å¼ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ã€‚
```js
var obj = {
  foo: function() {
    console.log(this)
  }
}

obj.foo.call('haha') // outputï¼šString {'haha'}
```
:::details åˆ†æ
> - æœ¬æ¥è°ƒç”¨çš„æ˜¯ obj.fooï¼ŒæŒ‰éšå¼ç»‘å®šåº”ä¸º objï¼›
> - ä½† call('haha') æ˜ç¡®æŒ‡å®šäº† thisï¼›
> - æ‰€ä»¥ this æŒ‡å‘ 'haha' è¢«åŒ…è£…çš„å¯¹è±¡ã€‚
:::

**3ï¸âƒ£ bind > call/apply**
> bind æ˜¯â€œæ°¸ä¹…ç»‘å®šâ€ï¼Œä¼˜å…ˆçº§æ¯” call/apply æ›´é«˜ã€‚
```js
function func() { console.log(this) }

var func2 = func.bind('haha')

func2.call('hehe')   // outputï¼šString {'haha'}
func2.apply('hehe')  // outputï¼šString {'haha'}
```
:::details
> - bind('haha') è¿”å›äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼›
> - åç»­è°ƒç”¨ call('hehe') æ˜¯ä½œç”¨åœ¨è¿™ä¸ªç»‘å®šè¿‡çš„å‡½æ•°ä¸Šï¼Œæ— æ³•ä¿®æ”¹ thisï¼›
> - æ‰€ä»¥æœ€ç»ˆè¾“å‡ºä»ç„¶æ˜¯ 'haha'ã€‚
:::

**4ï¸âƒ£ new ç»‘å®šä¼˜å…ˆçº§æœ€é«˜**
> - new æ˜¯å”¯ä¸€å¯ä»¥â€œå®Œå…¨å¿½ç•¥ bind çš„ç»‘å®šâ€çš„è§„åˆ™ï¼›
> - ä¸€æ—¦ç”¨äº† newï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°æ˜¯ bind è¿‡çš„ï¼Œä¹Ÿä¼šä»¥æ„é€ æ–¹å¼ä¼˜å…ˆæ‰§è¡Œã€‚
```js
function func() {
  console.log(this)
}

var func2 = func.bind('haha')

new func2() // this -> æ–°åˆ›å»ºçš„å¯¹è±¡
```
::: details
> - func2 æ˜¯ç»‘å®šäº† 'haha' çš„å‡½æ•°ï¼›
> - ä½† new çš„ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶å°† this ç»‘å®šåˆ°æ–°å¯¹è±¡ï¼›
> - æ‰€ä»¥ this æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ã€‚
:::

:::warning âš ï¸ æ³¨æ„
new å’Œ call / apply æ˜¯ä¸èƒ½ä¸€èµ·ä½¿ç”¨çš„ï¼Œä½ ä¸èƒ½è¿™æ ·å†™ï¼š`new func.call(obj)`ï¼Œè¿™æ˜¯æ— æ„ä¹‰çš„è¡¨è¾¾å¼ï¼Œ ä½†å¯ä»¥ `new (func.bind(obj))()`ï¼Œè¿™æ—¶ new ä¼˜å…ˆçº§ä»ç„¶æœ€é«˜ã€‚
:::

**âœ… æ€»ç»“ï¼šç»‘å®šä¼˜å…ˆçº§ä»ä½åˆ°é«˜å¦‚ä¸‹**
| ä¼˜å…ˆçº§(ä¾æ¬¡é€’å¢) | ç»‘å®šæ–¹å¼     | è¯´æ˜                         |
| --- | -------- | -------------------------- |
| 1   | é»˜è®¤ç»‘å®š     | æ— è°ƒç”¨å¯¹è±¡ã€æ—  call/apply/new æ—¶ç”Ÿæ•ˆ |
| 2   | éšå¼ç»‘å®š     | é€šè¿‡å¯¹è±¡è°ƒç”¨å‡½æ•°ï¼šobj.fn()          |
| 3   | æ˜¾å¼ç»‘å®š     | call/apply å¼ºåˆ¶æŒ‡å®š this       |
| 4   | bind ç»‘å®š  | bind è¿”å›æ°¸ä¹…ç»‘å®š this çš„æ–°å‡½æ•°      |
| 5   | new æ„é€ ç»‘å®š | åˆ›å»ºæ–°å¯¹è±¡å¹¶ç»‘å®š thisï¼Œ**ä¼˜å…ˆçº§æœ€é«˜**    |



# å››. ç»‘å®šä¹‹å¤–çš„æƒ…å†µ

---

## 1. thisè§„åˆ™ä¹‹å¤– â€“ å¿½ç•¥æ˜¾ç¤ºç»‘å®š

- æˆ‘ä»¬è®²åˆ°çš„è§„åˆ™å·²ç»è¶³ä»¥åº”ä»˜å¹³æ—¶çš„å¼€å‘ï¼Œä½†æ˜¯æ€»æœ‰ä¸€äº›è¯­æ³•ï¼Œè¶…å‡ºäº†æˆ‘ä»¬çš„è§„åˆ™ä¹‹å¤–ï¼ˆç¥è¯æ•…äº‹å’ŒåŠ¨æ¼«ä¸­æ€»æ˜¯æœ‰ç±»ä¼¼è¿™æ ·çš„äººç‰©ï¼‰

- æƒ…å†µä¸€ï¼šå¦‚æœåœ¨**æ˜¾ç¤ºç»‘å®šä¸­**ï¼Œæˆ‘ä»¬**ä¼ å…¥ä¸€ä¸ª`null`æˆ–è€…`undefined`**ï¼Œé‚£ä¹ˆè¿™ä¸ª**æ˜¾ç¤ºç»‘å®šä¼šè¢«å¿½ç•¥**ï¼Œ**ä½¿ç”¨é»˜è®¤è§„åˆ™**ï¼š

  - ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºç»‘å®š`null`æˆ–`undefined`ï¼Œ`this`æŒ‡å‘çš„æ˜¯åŸç”ŸåŸºæœ¬æ•°æ®ç±»å‹
  - éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºç»‘å®š`null`æˆ–`undfined`ï¼Œ`this`æŒ‡å‘`window`
    - **å› ä¸º`null`å’Œ`undefined`æ²¡æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹**

  ```js
  function foo() { console.log(this) }
  var obj  = {
    name: 'why'
  }
  
  foo.call(obj) // outputï¼šobjå¯¹è±¡ => objå¯¹è±¡(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  foo.call('abc') // outputï¼šString {'abc'} => 'abc'(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  foo.call(null) // outputï¼šwindow => null(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  foo.apply(undefined) // outputï¼šwindow =>  undefined(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  
  var bar = foo.bind(null)
  bar() // outputï¼šwindow => null(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  ```

## 2. thisè§„åˆ™ä¹‹å¤– - é—´æ¥å‡½æ•°å¼•ç”¨

- æƒ…å†µäºŒï¼šåˆ›å»ºä¸€å‡½æ•°çš„é—´æ¥å¼•ç”¨ï¼Œè¿™ç§æƒ…å†µä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™

  - èµ‹å€¼`(obj2.foo = obj1.foo)`çš„ç»“æœæ˜¯`foo`å‡½æ•°
  - `foo`å‡½æ•°è¢«ç›´æ¥è°ƒç”¨ï¼Œé‚£ä¹ˆæ˜¯é»˜è®¤ç»‘å®š

  ```js
  function foo() { console.log(this) }
  var obj1  = {
    name: 'obj1',
    foo: foo
  }
  
  var obj2 = {
    name: 'obj2'
  }
  
  obj1.foo(); // obj1å¯¹è±¡
  (obj2.foo = obj1.foo)() // window 
  // åœ†æ‹¬å·ä¼šå½“æˆä¸€ä¸ªè¡¨è¾¾å¼å»è§£æï¼Œè€Œè¯¥è¡¨è¾¾å¼å†…éƒ¨åœ¨èµ‹å€¼çš„åŒæ—¶ï¼Œä¹Ÿä¼šè¿”å›è¡¨è¾¾å¼å³ä¾§çš„å€¼(å³obj1ä¸­çš„fooå±æ€§æ‰€æŒ‡å‘çš„å‡½æ•°)ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¼šå½“æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨
  ```

## 3. thisè§„åˆ™ä¹‹å¤– â€“ ES6ç®­å¤´å‡½æ•°çš„thisä½¿ç”¨

- ç®­å¤´å‡½æ•°ä¸ä½¿ç”¨`this`çš„å››ç§æ ‡å‡†è§„åˆ™ï¼ˆä¹Ÿå°±æ˜¯**ä¸ç»‘å®š`this`**ï¼‰ï¼Œè€Œæ˜¯**æ ¹æ®å¤–å±‚ä½œç”¨åŸŸæ¥å†³å®š`this`**

- æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„æ¡ˆä¾‹ï¼š

  - è¿™é‡Œä½¿ç”¨`setTimeout`æ¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚åˆ°æ•°æ®åå¦‚ä½•å¯ä»¥å­˜æ”¾åˆ°`data`ä¸­å‘¢ï¼Ÿ
  - æˆ‘ä»¬éœ€è¦æ‹¿åˆ°`obj`å¯¹è±¡ï¼Œè®¾ç½®`data`
  - ä½†æ˜¯ç›´æ¥æ‹¿åˆ°çš„`this`æ˜¯`window`ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤–å±‚å®šä¹‰ï¼š`var _this = this`
  - åœ¨`setTimeout`çš„å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨`_this`å°±ä»£è¡¨äº†`obj`å¯¹è±¡

  ```js
  var obj = {
    data: [],
    getData: function() {
      var _this = this; // å½“é€šè¿‡obj.getDataè°ƒç”¨å‡½æ•°æ—¶ï¼Œå‡½æ•°å†…éƒ¨çš„thisç»‘å®šåˆ°äº†objå¯¹è±¡ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å˜é‡_thisæŒ‡å‘å‡½æ•°å†…éƒ¨çš„thisï¼Œå½“æ‰§è¡ŒsetTimeoutä¸­çš„å›è°ƒå‡½æ•°æ—¶ï¼Œå…¶ä¸­çš„thisæ˜¯æ‰§è¡Œwindowçš„ï¼Œå› ä¸ºsetTimeoutä¸­çš„å‡½æ•°æ˜¯æ˜¾ç¤ºç»‘å®šåˆ°windowèº«ä¸Šçš„ï¼Œæ‰€ä»¥å…¶å†…éƒ¨çš„å›è°ƒå‡½æ•°ä¸­thisæ‰§è¡Œçš„å°±æ˜¯windowäº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨_thiså˜é‡ï¼Œä¼šå¾€ä¸Šå±‚ä½œç”¨åŸŸä¸€å±‚ä¸€å±‚å¾€æŸ¥æ‰¾è¯¥å˜é‡ï¼Œæœ€ååœ¨ä¸Šå±‚å‡½æ•°ä½œç”¨åŸŸä¸­æ‰¾åˆ°_thiså˜é‡
      setTimeout(function() {
        // æ¨¡æ‹Ÿè·å–åˆ°çš„æ•°æ®
        var res = ['abc', 'cba']
        _this.data.push(...res)
      }, 1000)
    }
  }
  
  obj.getData()
  ```





# äº”. ç®­å¤´å‡½æ•°çš„ä½¿ç”¨

---

## 1. ç®­å¤´å‡½æ•° arrow function

- ç®­å¤´å‡½æ•°æ˜¯`ES6`ä¹‹åå¢åŠ çš„ä¸€ç§ç¼–å†™å‡½æ•°çš„æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒæ¯”å‡½æ•°è¡¨è¾¾å¼è¦æ›´åŠ ç®€æ´ï¼š

  - **ç®­å¤´å‡½æ•°ä¸ä¼šç»‘å®š`this`ã€`arguments`å±æ€§ï¼Œå³ä½¿ä½¿ç”¨ `call` ç­‰æ˜¾ç¤ºç»‘å®šä¹Ÿæ— ç”¨ï¼Œåªèƒ½ä»ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾**
  - ç®­å¤´å‡½æ•°**ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°æ¥ä½¿ç”¨**ï¼ˆä¸èƒ½å’Œ`new`ä¸€èµ·æ¥ä½¿ç”¨ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼‰
    - æ‰€ä»¥**ç®­å¤´å‡½æ•°æ˜¯æ²¡æœ‰æ˜¾å¼åŸå‹çš„ï¼Œä½†æ˜¯ä½œä¸ºå¯¹è±¡æ˜¯æœ‰éšå¼åŸå‹**

- ç®­å¤´å‡½æ•°å¦‚ä½•ç¼–å†™å‘¢ï¼Ÿ

  - ()ï¼šå‡½æ•°çš„å‚æ•°
  - {}ï¼šå‡½æ•°çš„æ‰§è¡Œä½“

  ```js
  // 1.ä¹‹å‰çš„æ–¹å¼
  function foo1() {}
  var foo2 = function(name, age) {
    console.log("å‡½æ•°ä½“ä»£ç ", this, arguments)
    console.log(name, age)
  }
  
  // 2.ç®­å¤´å‡½æ•°å®Œæ•´å†™æ³•
  var foo3 = (name, age) => {
    console.log("ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“")
    console.log(name, age)
  }
  
  // 3.ç®­å¤´å‡½æ•°çš„ç»ƒä¹ 
  // 3.1. forEach
  var names = ["abc", "cba", "nba"]
  names.forEach((item, index, arr) => {
    console.log(item, index, arr)
  })
  // 3.2. setTimeout
  setTimeout(() => {
    console.log("----")
  }, 3000)
  ```

## 2. ç®­å¤´å‡½æ•°çš„ç¼–å†™ä¼˜åŒ–

- ä¼˜åŒ–ä¸€ï¼šå¦‚æœ**åªæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥çœç•¥()**

  ```js
  nums.forEach(item => {})
  ```

- ä¼˜åŒ–äºŒï¼šå¦‚æœ**å‡½æ•°æ‰§è¡Œä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç (é™¤`return`)ï¼Œå¯ä»¥çœç•¥å¤§æ‹¬å·**ï¼Œä¸”**ä¼šè‡ªåŠ¨è¿”å›è¯¥è¡Œä»£ç çš„è¿”å›å€¼**

  - å¦‚æœå‡½æ•°ä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç ï¼Œæœ‰`return`çš„æ—¶å€™ï¼Œä¸èƒ½çœç•¥å¤§æ‹¬å·ï¼Œå¯ä»¥ç›´æ¥å»æ‰`return`ï¼Œå› ä¸ºè¿™è¡Œä»£ç çš„è¿”å›å€¼ä¼šä½œä¸ºæ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼

  ```js
  nums.forEach(item => console.log(item))
  nums.filter(item => item % 2 == 0)
  ```

- ä¼˜åŒ–ä¸‰ï¼šå¦‚æœå‡½æ•°æ‰§è¡Œä½“**è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡**ï¼Œé‚£ä¹ˆ**éœ€è¦ç»™è¿™ä¸ªå¯¹è±¡åŠ ä¸Š`()`**

  - å› ä¸ºå¦‚æœä¸åŠ çš„è¯ï¼Œ`js`å¼•æ“ä¼šè§£ææˆå‡½æ•°`{}`çš„æ‰§è¡Œä½“

  ```js
  var foo = () => {
    return {name: 'abc'}
  }
  var bar = () => ({name: 'abc'})
  ```





# å…­. ç®­å¤´å‡½æ•°thisçš„æŸ¥æ‰¾è§„åˆ™

---

- ä¹‹å‰çš„ä»£ç åœ¨`ES6`ä¹‹å‰æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œä»`ES6`å¼€å§‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š

  - ä¸ºä»€ä¹ˆåœ¨`setTimeout`çš„å›è°ƒå‡½æ•°ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨`this`å‘¢ï¼Ÿ
  - å› ä¸º**ç®­å¤´å‡½æ•°ä¸ç»‘å®š`this`å¯¹è±¡**ï¼Œé‚£ä¹ˆ`this`å¼•ç”¨å°±ä¼š**ä»ä¸Šå±‚ä½œç”¨åŸŸä¸­æ‰¾åˆ°å¯¹åº”çš„`this`**
    - æ‰€ä»¥`this`ç»‘å®šå¯¹ç®­å¤´å‡½æ•°æ˜¯æ— æ•ˆçš„
  - **ç®­å¤´å‡½æ•°ä¸­æ˜¯æ²¡æœ‰`this`çš„ï¼Œå…¶ä¸­`this`æ˜¯å¾€ä¸Šå±‚ä½œç”¨åŸŸä¸€å±‚ä¸€å±‚æŸ¥æ‰¾ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œå°±æ˜¯`window`**
  
  ```js
  var obj = {
    data: [],
    getData: function() {
      setTimeout(() => {
        var res = ['abc', 'cba']
        console.log(this) 
        this.data.push(...res)
      }, 1000)
    }
  }
  obj.getData() // outputï¼šobjå¯¹è±¡
  
  var obj2 = {
    getData: () => {
      setTimeout(() => {
        console.log(this)
      }, 1000)
    }
  }
  obj2.getData() // outputï¼šwindow å› ä¸ºç®­å¤´å‡½æ•°ä¸­æ˜¯æ²¡æœ‰thisçš„ï¼Œæ˜¯å¾€ä¸Šå±‚ä½œç”¨åŸŸä¸€å±‚ä¸€å±‚æŸ¥æ‰¾çš„ï¼Œæœ€å¤–å±‚thisæŒ‡å‘windowå¯¹è±¡
  ```
  

> æ³¨æ„ï¼š
>
> - å‡½æ•°çš„ä½œç”¨åŸŸé“¾æ˜¯åœ¨å‡½æ•°å£°æ˜ï¼ˆç¼–å†™/å®šä¹‰ï¼‰çš„æ—¶å€™å°±ç¡®å®šä¸‹æ¥äº†





# ä¸ƒ. thisé¢è¯•é¢˜åˆ†æ

---

```js
var name = '222'
var person = {
  name: 'person',
  sayName: function() {
    console.log(this.name)
  }
}

function sayName() {
  var sss = person.sayName;
  sss()
  person.sayName()
  (person.sayName)()
  (b = person.sayName)()
}

sayName()
// outputï¼š
// '222' é»˜è®¤ç»‘å®šï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
// 'person' éšå¼ç»‘å®š
// person' éšå¼ç»‘å®šï¼Œç­‰åŒäºperson.sayName(), åŠ å°æ‹¬å·ä¸åŠ æ•ˆæœå®Œå…¨ä¸€æ ·ï¼ŒåŠ å°æ‹¬å·æ§åˆ¶ä»£ç ä¼˜å…ˆçº§ï¼Œä¸åŠ å°æ‹¬å·ï¼Œæœ¬èº«ç‚¹.è¯­æ³•ä¼˜å…ˆçº§å°±å¾ˆé«˜
// '222' é—´æ¥å‡½æ•°å¼•ç”¨ï¼Œèµ‹å€¼è¯­å¥è¿”å›ç»“æœå³ç‹¬ç«‹å‡½æ•°è°ƒç”¨
```

```js
var name = '222'
var person1 = {
  name: 'person1',
  foo1: function() {
    console.log(this.name)
  },
  foo2: () => console.log(this.name),
  foo3: function() {
    return function() {
      console.log(this.name)
    }
  },
  foo4: function() {
    return () => {
      console.log(this.name)
    }
  }
}

var person2 = {name: 'person2'}

person1.foo1() // 'person1' éšå¼ç»‘å®š
person1.foo1.call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo2() // '222' ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo2.call(person2) // '222' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this

person1.foo3()() // '222' é»˜è®¤ç»‘å®š æ‹¿åˆ°è¿”å›çš„æ™®é€šå‡½æ•°ç›´æ¥è¿›è¡Œé»˜è®¤è°ƒç”¨
person1.foo3.call(person2)() // '222' é»˜è®¤ç»‘å®š æ‹¿åˆ°è¿”å›çš„æ™®é€šå‡½æ•°ç›´æ¥è¿›è¡Œé»˜è®¤è°ƒç”¨
person1.foo3().call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo4()() // 'person1' ç®­å¤´å‡½æ•°è°ƒç”¨ä¼šä»ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo4.call(person2)() // 'person2' ç®­å¤´å‡½æ•°è°ƒç”¨ä¼šä»ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo4().call(person2) // 'person1' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä»ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
```

```js
var name = '222'
function Person(name) {
  this.name = name
  this.foo1 = function() {
    console.log(this.name)
  }
  this.foo2 = () => console.log(this.name)
  this.foo3 = function() {
    return function() {
      console.log(this.name)
    }
  }
  this.foo4 = function() {
    return () => {
      console.log(this.name)
    }
  }
}

var person1 = new Person('person1')
var person2 = new Person('person2')

person1.foo1() // 'person1' éšå¼ç»‘å®š
person1.foo1.call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo2() // 'person1' ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾ï¼šä¸Šå±‚ä½œç”¨åŸŸä¸­çš„thisç»‘å®šåˆ°äº†person1
person1.foo2.call(person2) // 'person1' ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾

person1.foo3()() // '222' é»˜è®¤ç»‘å®š ç‹¬ç«‹å‡½æ•°è°ƒç”¨
person1.foo3.call(person2)() // '222' é»˜è®¤ç»‘å®š ç‹¬ç«‹å‡½æ•°è°ƒç”¨
person1.foo3().call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo4()() // 'person1' ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾
person1.foo4.call(person2)() // 'person2' foo4å‡½æ•°ä¸­thisç»‘å®šperson2ï¼Œç®­å¤´å‡½æ•°æŸ¥æ‰¾ä¸Šå±‚ä½œç”¨åŸŸfoo4å‡½æ•°ä¸­çš„this
person1.foo4().call(person2) // 'person1' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾
```

```js
var name = '222'
function Person(name) {
  this.name = name
  this.obj = {
    name: 'obj',
    foo1: function() {
      return function() {
        console.log(this.name)
      }
    },
    foo2: function() {
      return () => {
        console.log(this.name)
      }
    }
  }
}

var person1 = new Person('person1')
var person2 = new Person('person2')

person1.obj.foo1()() // '222' æ™®é€šå‡½æ•°é»˜è®¤è°ƒç”¨ï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
person1.obj.foo1.call(person2)() // '222' æ™®é€šå‡½æ•°é»˜è®¤è°ƒç”¨ï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
person1.obj.foo1().call(person2) // 'person2' æ™®é€šå‡½æ•°æ˜¾å¼ç»‘å®šè°ƒç”¨

person1.obj.foo2()() // 'obj' ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thiséšå¼ç»‘å®šobj
person1.obj.foo2.call(person2)() // 'person2' ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thisæ˜¾å¼ç»‘å®šperson2
person1.obj.foo2().call(person2) // 'obj' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thiséšå¼ç»‘å®šobj
```

> æ€»ç»“ï¼š
>
> - **æ™®é€šå‡½æ•°ä¸­çš„`this`ï¼Œæ˜¯æ ¹æ®è°ƒç”¨çš„æ—¶å€™ç»‘å®šçš„**
> - **ç®­å¤´å‡½æ•°ä¸­æ˜¯æ²¡æœ‰`this`çš„ï¼Œæ‰€ä»¥æ˜¯ä¸è¢«ç»‘å®šçš„ï¼Œä¼šå»ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾`this`ï¼Œæ˜¯æ ¹æ®æ‰§è¡Œä¸Šä¸‹æ–‡å†³å®šçš„**





# å…«. æ‰‹å†™applyã€callã€bind

---

```js
Function.prototype.executionFn = function(thisArg, args) {
  thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg) // è¿™é‡Œæ˜¯é˜²æ­¢ä¼ å…¥ç»‘å®šçš„å‚æ•°ä¸ºç©ºæˆ–è€…æ˜¯åŸå§‹ç±»å‹çš„å€¼ï¼Œå¦‚stringæˆ–number
  Object.defineProperty(thisArg, '_this', {
    configurable: true,
    enumerable: falseï¼Œ
    value: this
  })
  args ? thisArg._this(...args) : thisArg._this()
  delete this._this
}

/**
* ç§æœ‰çš„applyæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°æ•°ç»„
*/
Function.prototype._apply = function(thisArg, args) {
  // thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  // thisArg._this = this
  // Object.defineProperty(thisArg, '_this', {
  //   configurable: true,
  //   enumerable: false
  // })
  // args ? thisArg._this(...args) : thisArg._this()
  this.executionFn(thisArg, args)
}

function foo(name, age) {
  console.log(this, name, age)
}

foo._apply({name: 'later'}, ['later', 18])
foo._apply('abc', ['later', 18])
foo._apply()

/**
* ç§æœ‰çš„callæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°åˆ—è¡¨
*/
Function.prototype._call = function(thisArg, ...args) {
  // thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  // thisArg._this = this
  // Object.defineProperty(thisArg, '_this', {
  //   configurable: true,
  //   enumerable: false
  // })
  // args ? thisArg._this(...args) : thisArg._this()
  this.executionFn(thisArg, args)
}

foo._call()
foo._call({name: 'later'}, 'later', 18)
foo._call('abc', 'later', 18)
```

```js
function foo(name, age) {
  console.log(this, name, age)
}
/**
* ç§æœ‰çš„bindæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°åˆ—è¡¨
*/
Function.prototype._bind = function(thisArg, ...args) {
  thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  Object.defineProperty(thisArg, '_this', {
    configurable: true,
    enumerable: false,
    value: this
  })

  return (...rest) => {
    args ? thisArg._this(...args, ...rest) : thisArg._this(...rest)
  }
}

var foo2 = foo._bind({name: 'later'}, 'later')
foo2(23)
foo2(18)
foo2()
var foo3 = foo._bind()
foo3()
```







