# ä¸€. this çš„ç»‘å®šè§„åˆ™



## 1. this åˆ°åº•æŒ‡å‘ä»€ä¹ˆå‘¢ï¼Ÿ
:::info
`this` è¡¨ç¤º**å‡½æ•°è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡**ï¼Œæ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œåœ¨å‡½æ•°è¿è¡Œæ—¶è‡ªåŠ¨å‡ºçŽ°ã€‚ä½†å®ƒçš„å€¼å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯æ ¹æ®å‡½æ•°çš„**è°ƒç”¨æ–¹å¼**å†³å®šã€‚
:::
**â“å…ˆæ¥çœ‹ä¸€ä¸ªè®©äººå›°æƒ‘çš„é—®é¢˜ï¼š**
> ä¸‹é¢æˆ‘ä»¬ç”¨åŒä¸€ä¸ªå‡½æ•° fooï¼Œåˆ†åˆ«ç”¨ä¸‰ç§æ–¹å¼è°ƒç”¨ï¼Œè§‚å¯Ÿ this çš„æŒ‡å‘ã€‚
```js
function foo() { 
  console.log(this)
}

// æ–¹å¼ä¸€ï¼šç›´æŽ¥è°ƒç”¨ï¼ˆé»˜è®¤ç»‘å®šï¼‰
foo()

// æ–¹å¼äºŒï¼šé€šè¿‡å¯¹è±¡è°ƒç”¨ï¼ˆéšå¼ç»‘å®šï¼‰
var obj = {
  name: 'later',
  foo: foo
}
obj.foo()

// æ–¹å¼ä¸‰ï¼šä½¿ç”¨ call æ˜¾å¼ç»‘å®š
foo.call('abc')
```
**ðŸ” åˆ†æžè¿è¡Œç»“æžœï¼ˆðŸ“åˆ†åˆ«è¯´æ˜Žæµè§ˆå™¨å’Œ Node.jsï¼‰**
| è°ƒç”¨æ–¹å¼ | ä»£ç  | æµè§ˆå™¨ä¸­çš„ this | Node.js ä¸­çš„ this |
| - | - | - | - |
| ç›´æŽ¥è°ƒç”¨ | `foo()`	| window(éžä¸¥ï¼‰undefined(ä¸¥ï¼‰| globalï¼ˆéžä¸¥ï¼‰undefinedï¼ˆä¸¥ï¼‰|
| éšå¼ç»‘å®š |	`obj.foo()` | obj | obj |
| æ˜¾å¼ç»‘å®š |	`foo.call('abc')` |	`String {'abc'}`(éžä¸¥ï¼‰`'abc'`(ä¸¥) |	`[String: 'abc']`(éžä¸¥ï¼‰`'abc'`(ä¸¥) |

**ðŸ¤¯ è¿™è¯´æ˜Žäº†ä»€ä¹ˆï¼Ÿ**
> 1. å‡½æ•°è°ƒç”¨æ—¶ï¼ŒJavaScript **ä¸º this è‡ªåŠ¨ç»‘å®šä¸€ä¸ªå€¼**ï¼› 
> 2. `this` çš„æŒ‡å‘**ä¸Žå‡½æ•°å®šä¹‰çš„ä½ç½®æ— å…³**ï¼› 
> 3. å®ƒå®Œå…¨ä¾èµ–äºŽå‡½æ•°çš„**è°ƒç”¨æ–¹å¼**å’Œæ‰€å¤„çš„**è¿è¡ŒçŽ¯å¢ƒ**ï¼› 
> 4. `this` æ˜¯åœ¨**è¿è¡Œæ—¶**ç»‘å®šçš„ï¼Œè€Œéžç¼–è¯‘æœŸå†³å®šã€‚

  
**é‚£ä¹ˆ this åˆ°åº•æ˜¯æ€Žä¹ˆæ ·çš„ç»‘å®šè§„åˆ™å‘¢ï¼Ÿ**
> æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸º 4æ¡åŸºç¡€ç»‘å®šè§„åˆ™+1ä¸ªç‰¹æ®Šæƒ…å†µï¼ŒæŒ‰ç…§åŒ¹é…é¡ºåºå¦‚ä¸‹ï¼š

| ä¼˜å…ˆçº§ | ç»‘å®šæ–¹å¼ | ç¤ºä¾‹ | this æŒ‡å‘ |
|----|------|----|---------|
| 1ï¸âƒ£ | new ç»‘å®š | `new Foo()` | æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ˆæž„é€ å™¨çš„å®žä¾‹ï¼‰ |
| 2ï¸âƒ£ | æ˜¾å¼ç»‘å®š | `foo.call(obj)` | `call/apply/bind` æ˜¾å¼ä¼ å…¥çš„å¯¹è±¡ |
| 3ï¸âƒ£ | éšå¼ç»‘å®š | `obj.foo()` | è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡ `obj` |
| 4ï¸âƒ£ | é»˜è®¤ç»‘å®š | `foo()` | éžä¸¥ï¼šå…¨å±€å¯¹è±¡ï¼ˆwindow å’Œ global)ï¼Œä¸¥ï¼š`undefined` | 
| +  | ç‰¹æ®Šç»‘å®š | å†…ç½®å‡½æ•° / ç®­å¤´å‡½æ•° / `setTimeout(fn)` | å„æœ‰ä¾‹å¤–ï¼ˆè¯¦è§åŽæ–‡ï¼‰ |

**ðŸ“Œ å°è´´å£«ï¼šå¦‚ä½•åˆ¤æ–­ this åˆ°åº•ç»‘å®šäº†ä»€ä¹ˆï¼Ÿ**
> æˆ‘ä»¬å¯ä»¥é€šè¿‡â€œ**è°ƒç”¨æ ˆåˆ†æžæ³•**â€+â€œä¼˜å…ˆçº§åŒ¹é…â€æ¥åˆ¤æ–­ï¼š
> 1. å‡½æ•°æ˜¯å¦é€šè¿‡ `new` è°ƒç”¨ï¼Ÿ â†’ ä¼˜å…ˆçº§æœ€é«˜
> 2. æ˜¯å¦ä½¿ç”¨äº† `call / apply / bind`ï¼Ÿ â†’ æ˜¾å¼ç»‘å®š 
> 3. æ˜¯å¦ä½œä¸ºå¯¹è±¡å±žæ€§è°ƒç”¨ï¼Ÿ â†’ éšå¼ç»‘å®š
> 4. å¦åˆ™ â†’ é»˜è®¤ç»‘å®š
> 5. ç‰¹æ®Šè¯­æ³•ï¼ˆç®­å¤´å‡½æ•°ã€å®šæ—¶å™¨ç­‰ï¼‰å¦è¡Œåˆ†æž

**ðŸ”” å…³äºŽ this çš„è¯¯è§£å¾ˆå¤šï¼Œå¸¸è§é™·é˜±åŒ…æ‹¬ï¼š**
> - å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡æˆ–å‚æ•°åŽè°ƒç”¨ï¼Œå¯¼è‡´ç»‘å®šä¸¢å¤±ï¼›
> - `setTimeout(fn, 0)` ä¸­ `this` è¢«é‡ç½®ï¼› 
> - `this` å’Œä½œç”¨åŸŸã€é—­åŒ…æ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µï¼› 
> - ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œå®ƒç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸã€‚



## 2. è§„åˆ™ä¸€ï¼šé»˜è®¤ç»‘å®š
:::info **ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤ç»‘å®šï¼Ÿ**
> é»˜è®¤ç»‘å®šçš„è§„åˆ™é€‚ç”¨äºŽ**ç‹¬ç«‹å‡½æ•°è°ƒç”¨**ï¼Œå³ï¼š**å‡½æ•°æ²¡æœ‰è¢«ç»‘å®šåœ¨æŸä¸ªå¯¹è±¡ä¸Šè°ƒç”¨æ—¶ï¼Œthis é»˜è®¤æŒ‡å‘å…¨å±€å¯¹è±¡**ï¼ˆæˆ–ä¸º undefinedï¼Œå–å†³äºŽæ˜¯å¦å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼‰ã€‚
> 
> æ¢å¥è¯è¯´ï¼Œå¦‚æžœä¸€ä¸ªå‡½æ•°æ˜¯ä»¥æœ€æ™®é€šçš„æ–¹å¼ç›´æŽ¥è°ƒç”¨çš„ï¼Œä¾‹å¦‚ foo()ï¼Œè€Œä¸æ˜¯é€šè¿‡å¯¹è±¡å¼•ç”¨è°ƒç”¨ï¼ˆå¦‚ obj.foo()ï¼‰ï¼Œé‚£ä¹ˆé»˜è®¤ç»‘å®šå°±ç”Ÿæ•ˆã€‚
:::
**ðŸ”¹ æ¡ˆä¾‹ä¸€ï¼šæœ€åŸºç¡€çš„ç‹¬ç«‹å‡½æ•°è°ƒç”¨**
```js
function foo() {
  console.log(this)
}

foo()
```
| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ðŸ”¹ æ¡ˆä¾‹äºŒï¼šå‡½æ•°åµŒå¥—è°ƒç”¨ä¸­çš„é»˜è®¤ç»‘å®š**
```js
function fn1() {
  console.log(this)
}

function fn2() {
  fn1() // ç›´æŽ¥è°ƒç”¨
}

fn2()
```
> fn1() ä½œä¸ºæ™®é€šå‡½æ•°ç›´æŽ¥è°ƒç”¨ï¼Œå› æ­¤ this åº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚ä¸Žæ˜¯å¦ç”±å¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨å®ƒæ— å…³ã€‚

| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ðŸ”¹ æ¡ˆä¾‹ä¸‰ï¼šå‡½æ•°å®šä¹‰åœ¨å¯¹è±¡ä¸­ï¼Œä½†é€šè¿‡å˜é‡æˆ–å‚æ•°è°ƒç”¨**
```js
var obj = {
  bar: function () { // obj ä¸­çš„ bar ä¿å­˜çš„å®žé™…æ˜¯è¯¥å‡½æ•°çš„å¼•ç”¨(å†…å­˜åœ°å€)
    console.log(this)
  }
}

var baz = obj.bar // baz åœ¨å†…å­˜ä¸­æŒ‡å‘çš„æ˜¯ obj çš„ bar å±žæ€§æ‰€æŒ‡å‘çš„å‡½æ•°çš„å†…å­˜åœ°å€
baz() // ç›´æŽ¥è°ƒç”¨ï¼ˆè¿™é‡Œè°ƒç”¨å®žé™…å°±æ˜¯é€šè¿‡å†…å­˜åœ°å€æ‰¾åˆ°å †å†…å­˜ä¸­çš„å‡½æ•°ï¼Œç‹¬ç«‹è°ƒç”¨è¯¥å‡½æ•°ï¼‰
```
> å°½ç®¡å‡½æ•°æœ€åˆæ˜¯å®šä¹‰åœ¨ obj ä¸­çš„ï¼Œä½†é€šè¿‡å˜é‡ baz è°ƒç”¨æ—¶ï¼Œå®ƒå·²ç»â€œè„±ç¦»â€äº†å¯¹è±¡ä¸Šä¸‹æ–‡ã€‚  
> ç›¸å½“äºŽ baz() æ˜¯ç›´æŽ¥å‡½æ•°è°ƒç”¨ â†’ ä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ðŸ”¹ æ¡ˆä¾‹å››ï¼šé€šè¿‡å‚æ•°ä¼ é€’å‡½æ•°å¼•ç”¨ï¼Œè§¦å‘é»˜è®¤ç»‘å®š**
```js
var obj = {
  bar: function () {
    console.log(this)
  }
}

function fn1(fn) {
  fn() // ç›´æŽ¥è°ƒç”¨
}
fn1(obj.bar) // è¿™é‡Œä¼ å…¥çš„æ˜¯ obj çš„ bar å±žæ€§æ‰€æŒ‡å‘çš„å‡½æ•°çš„å†…å­˜åœ°å€(å¼•ç”¨)
```
> obj.bar æ˜¯ä¸€ä¸ªå‡½æ•°å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œä¼ ç»™ fn1 åŽæ²¡æœ‰ç»‘å®šåˆ°ä»»ä½•å¯¹è±¡ä¸Šã€‚   
> fn() æ˜¯ç›´æŽ¥è°ƒç”¨ï¼Œä»ç„¶è§¦å‘é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ðŸ“ é»˜è®¤ç»‘å®šè§„åˆ™**
| åˆ¤æ–­è¦ç‚¹ | this çš„ç»‘å®šå€¼ |
|-|-|
| å‡½æ•°ç›´æŽ¥è°ƒç”¨ï¼ˆéžä¸¥æ ¼æ¨¡å¼ï¼‰ |	æµè§ˆå™¨ï¼š`window`ï¼›Node.jsï¼š`global` |
| å‡½æ•°ç›´æŽ¥è°ƒç”¨ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ | `undefined` |
| å‡½æ•°é€šè¿‡å˜é‡å¼•ç”¨æˆ–å‚æ•°ä¼ é€’åŽç›´æŽ¥è°ƒç”¨ | é»˜è®¤ç»‘å®šè§„åˆ™ç”Ÿæ•ˆ |

**ðŸ’¡è®°å¿†å°è´´å£«ï¼šå‡½æ•°â€œè„±ç¦»äº†å¯¹è±¡â€ï¼Œå°±ä¼šè½å…¥â€œé»˜è®¤ç»‘å®šâ€çš„æŽŒæŽ§ä¹‹ä¸­ã€‚**



## 3. è§„åˆ™äºŒï¼šéšå¼ç»‘å®š
:::info
åœ¨ JavaScript ä¸­ï¼Œ`this` çš„æŒ‡å‘**å¹¶ä¸æ˜¯ç”±å‡½æ•°åœ¨å“ªé‡Œå®šä¹‰å†³å®šçš„ï¼Œè€Œæ˜¯ç”±å®ƒè¢«è°ƒç”¨çš„æ–¹å¼å†³å®šçš„ã€‚
å½“ä¸€ä¸ªå‡½æ•°é€šè¿‡å¯¹è±¡å±žæ€§è°ƒç”¨æ—¶ï¼Œthis ä¼šè¢«â€œéšå¼â€ç»‘å®šåˆ°è¯¥å¯¹è±¡ä¸Šã€‚**
:::

**ðŸ” ä»€ä¹ˆæ˜¯éšå¼ç»‘å®šï¼Ÿ**  
```js
// è°ƒç”¨å½¢å¼
object.method()
```
åªè¦å‡½æ•°æ˜¯é€šè¿‡**å¯¹è±¡å±žæ€§**æ¥è®¿é—®å¹¶è°ƒç”¨çš„ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼ŒJavaScript å¼•æ“Žå°±ä¼šå°†è¯¥å¯¹è±¡ç»‘å®šä¸ºå‡½æ•°å†…éƒ¨çš„ `this`ã€‚

**âœ… ç¤ºä¾‹ 1ï¼šåŸºç¡€éšå¼ç»‘å®š**
```js
function sayName() {
  console.log(this.name)
}

const person = {
  name: 'Alice',
  sayName: sayName
}

person.sayName()
```
> å‡½æ•° sayName è¢«ä½œä¸º person å¯¹è±¡çš„å±žæ€§æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ this è¢«ç»‘å®šä¸º person å¯¹è±¡ã€‚

| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | 'Alice' | 'Alice' |
| Node.js | 'Alice' | 'Alice' |

**âœ… ç¤ºä¾‹ 2ï¼šå¤šå±‚å¯¹è±¡è®¿é—®**
```js
function greet() {
  console.log(this.name)
}

const user1 = { name: 'Tom', greet: greet }
const user2 = { name: 'Jerry', user1: user1 }

user2.user1.greet()
```
> è°ƒç”¨è¯­å¥æ˜¯ user2.user1.greet()ï¼Œä½†çœŸæ­£è°ƒç”¨å‡½æ•°çš„æ˜¯ user1ï¼› æ‰€ä»¥ this ç»‘å®šä¸º user1ã€‚

| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | 'Tom' | 'Tom' |
| Node.js | 'Tom' | 'Tom' |

**âš ï¸ç¤ºä¾‹ 3ï¼šå‡½æ•°èµ‹å€¼å¯¼è‡´éšå¼ç»‘å®šä¸¢å¤±ï¸**
```js
function show() {
  console.log(this)
}

const obj = {
  show: show
}

const fn = obj.show
fn() // è¾“å‡ºï¼šï¼Ÿ
```
ðŸ§  ä½ å¯èƒ½ä»¥ä¸º this è¿˜æ˜¯ objï¼Œä½†å…¶å®žä¸æ˜¯ï¼
> fn() æ˜¯ç›´æŽ¥è°ƒç”¨ï¼Œä¸å†é€šè¿‡ objï¼Œæ‰€ä»¥é»˜è®¤ç»‘å®šè§„åˆ™ä¼šç”Ÿæ•ˆã€‚

| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|--------|--------|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**âš ï¸ç¤ºä¾‹ 4ï¼šå‚æ•°ä¼ é€’æ—¶ä¹Ÿä¼šå‘ç”Ÿéšå¼ä¸¢å¤±**
```js
function display() {
  console.log(this)
}

const context = {
  display: display
}

function callFn(fn) {
  fn() // ç‹¬ç«‹è°ƒç”¨
}

callFn(context.display) // è¾“å‡ºï¼šï¼Ÿ
```
> å°½ç®¡ä¼ å…¥çš„æ˜¯ context.displayï¼Œä½†ä¼ å…¥çš„ä»…ä»…æ˜¯å‡½æ•°å¼•ç”¨ï¼Œä¼ å…¥å‡½æ•°åŽæ˜¯â€œç›´æŽ¥è°ƒç”¨â€ï¼Œä¸å†æœ‰å¯¹è±¡ä¸Šä¸‹æ–‡äº†ï¼Œæ‰€ä»¥å‘ç”Ÿäº†éšå¼ç»‘å®šä¸¢å¤±ã€‚

| è¿è¡ŒçŽ¯å¢ƒ | éžä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|--------|--------|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**ðŸ§  å°ç»“ï¼šéšå¼ç»‘å®šçš„è¦ç‚¹**
| è°ƒç”¨æ–¹å¼               | this ç»‘å®šå¯¹è±¡ |
| ------------------ | --------- |
| `obj.fn()`         | obj     |
| `obj1.obj2.fn()`   | obj2    |
| `var fn = obj.fn`  | é»˜è®¤ç»‘å®šï¼ˆéšå¼ç»‘å®šä¸¢å¤±ï¼‰  |
| `callback(obj.fn)` | é»˜è®¤ç»‘å®šï¼ˆéšå¼ç»‘å®šä¸¢å¤±ï¼‰  |


## 3. è§„åˆ™ä¸‰ï¼šæ˜¾å¼ç»‘å®š
:::info
åœ¨éšå¼ç»‘å®šä¸­ï¼Œ`this` çš„ç»‘å®šä¾èµ–äºŽè°ƒç”¨å¯¹è±¡ã€‚è€Œ**æ˜¾å¼ç»‘å®š**å…è®¸æˆ‘ä»¬é€šè¿‡ callã€apply å’Œ bind **â€œæ‰‹åŠ¨æŒ‡å®šâ€ this çš„æŒ‡å‘**ï¼Œä¸å†ä¾èµ–äºŽè°ƒç”¨ä½ç½®ã€‚
:::

**ðŸ“Œ ä»€ä¹ˆæ˜¯æ˜¾å¼ç»‘å®šï¼Ÿ**
> JavaScript ä¸­æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ‹¥æœ‰ `.call()` å’Œ `.apply()` æ–¹æ³•ï¼Œå®ƒä»¬çš„**ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç”¨äºŽç»‘å®š this çš„å€¼**ã€‚
```js
func.call(thisArg, arg1, arg2, ...)    // å‚æ•°åˆ—è¡¨
func.apply(thisArg, [arg1, arg2, ...]) // å‚æ•°æ•°ç»„
```
> - thisArgï¼šå‡½æ•°è¿è¡Œæ—¶è¦ç»‘å®šä¸º this çš„å¯¹è±¡ï¼›
> - åŽç»­å‚æ•°åˆ†åˆ«ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ã€‚

å¯¹äºŽè¿™ç±»ï¼Œæ˜Žç¡®äº† this è¦ç»‘å®šçš„å¯¹è±¡çš„è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º**æ˜¾å¼ç»‘å®š**ã€‚



## 4. è§„åˆ™å››ï¼šnewç»‘å®š

- `js`ä¸­çš„å‡½æ•°å¯ä»¥å½“åšä¸€ä¸ªç±»çš„æž„é€ å‡½æ•°æ¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨`new`å…³é”®å­—

- ä½¿ç”¨`new`å…³é”®å­—æ¥è°ƒç”¨å‡½æ•°æ˜¯ä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š

  1. åœ¨å †å†…å­˜ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç©ºå¯¹è±¡
  2. è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«æ‰§è¡Œ`prototype`è¿žæŽ¥
  3. è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«ç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„`this`ä¸Šï¼ˆ`this`ç»‘å®šåœ¨è¿™ä¸ªæ­¥éª¤å®Œæˆï¼‰
  4. æ‰§è¡Œå‡½æ•°ä½“ä»£ç ï¼Œå¦‚æžœå‡½æ•°æ²¡æœ‰æ˜Žç¡®æŒ‡å®šè¿”å›žä¸€ä¸ªéžç©ºå¯¹è±¡ï¼Œè¡¨è¾¾å¼ä¼šè¿”å›žæ–°åˆ›å»ºçš„è¿™ä¸ªå¯¹è±¡

  ```js
  function Person(name) {
    console.log(this) // thisæŒ‡å‘å †å†…å­˜ä¸­æ–°åˆ›å»ºçš„ç©ºå¯¹è±¡
    console.log(this == p1) // false å› ä¸ºè¿™æ—¶p1è¿˜åªæ˜¯ä¸ªundefinedï¼Œåœ¨å †å†…å­˜ä¸­æ–°åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡è¿™æ—¶è¿˜å¹¶æ²¡æœ‰èµ‹å€¼ç»™p1
    this.name = name
  }
  
  var p1  = new Person('later')
  console.log(p1) // PersonÂ {name: 'later'} è¿™ä¸ªæ—¶å€™p1å·²ç»æ‹¿åˆ°åˆ›å»ºå‡ºæ¥çš„æ–°å¯¹è±¡çš„å†…å­˜åœ°å€äº†
  ```
  

## 5. å†…ç½®å‡½æ•°çš„ç»‘å®šæ€è€ƒ

- æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä¸€äº›`js`çš„å†…ç½®å‡½æ•°ï¼Œæˆ–è€…ä¸€äº›ç¬¬ä¸‰æ–¹åº“ä¸­çš„å†…ç½®å‡½æ•°

  - è¿™äº›å†…ç½®å‡½æ•°ä¼šè¦æ±‚æˆ‘ä»¬ä¼ å…¥å¦å¤–ä¸€ä¸ªå‡½æ•°
  -  æˆ‘ä»¬è‡ªå·±å¹¶**ä¸ä¼šæ˜¾ç¤ºçš„è°ƒç”¨è¿™äº›å‡½æ•°**ï¼Œè€Œä¸”**`js`å†…éƒ¨æˆ–è€…ç¬¬ä¸‰æ–¹åº“å†…éƒ¨ä¼šå¸®åŠ©æˆ‘ä»¬æ‰§è¡Œ**
  - è¿™äº›å‡½æ•°ä¸­çš„`this`åˆæ˜¯å¦‚ä½•ç»‘å®šçš„å‘¢ï¼Ÿ

- `setTimeout`ã€æ•°ç»„çš„`forEach`ã€`div`çš„ç‚¹å‡»

  ```js
  'use strict' // æ­£å¸¸æƒ…å†µä¸‹, é»˜è®¤è°ƒç”¨å‡½æ•°æ˜¯æŒ‡å‘windowçš„, ä¸¥æ ¼æ¨¡å¼ä¸‹, æŒ‡å‘çš„æ˜¯undefined
  
  function foo() { console.log(this) } // window(é»˜è®¤æƒ…å†µ) => undefined(ä¸¥æ ¼æ¨¡å¼)
  
  setTimeout(function() {
    console.log(this) // ä¸¥æ ¼æ¨¡å¼ä¸‹, å®šæ—¶å™¨ä¸­çš„å›žè°ƒå‡½æ•°ä¸­çš„thisä»ç„¶æŒ‡å‘windowï¼Œç”±æ­¤å¯æŽ¨æ–­å‡ºå®šæ—¶å™¨ä¸­ä¼ å…¥çš„å›žè°ƒå‡½æ•°å¯èƒ½æ˜¯æ˜¾ç¤ºç»‘å®šåˆ°windowä¸Šé¢çš„ï¼Œæ‰€ä»¥ä¸è®ºé»˜è®¤æƒ…å†µè¿˜æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œå®šæ—¶å™¨ä¸­å›žè°ƒå‡½æ•°çš„thiséƒ½æ˜¯æŒ‡å‘windowçš„
  }, 1000);
  
  var box = document.querySeletcor('.box')
  box.onclick = function() {
    console.log(this === box) // true
  }
  
  var names = ['abc', 'cba', 'nba']
  var obj = {name: 'later'}
  names.forEach(function (item) {
    // é»˜è®¤window, å¦‚æžœä¼ å…¥thiså‚æ•°ï¼Œåˆ™å›žè°ƒå‡½æ•°ä¸­thisæŒ‡å‘ä¼ å…¥çš„å‚æ•°
    console.log(this) // ä¸‰æ¬¡objå¯¹è±¡
  }, obj)
  ```

> æ€»ç»“ï¼š
>
> - æ— è®ºé»˜è®¤è¿˜æ˜¯ä¸¥æ ¼æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œ`setTimeout`ä¸­ä¼ å…¥çš„å›žè°ƒå‡½æ•°ï¼ˆç®­å¤´å‡½æ•°é™¤å¤–ï¼‰çš„`this`éƒ½æ˜¯`window`å¯¹è±¡
> - ç”±æ­¤å¯çŸ¥ï¼Œ`setTimeout`ä¸­çš„`this`åº”è¯¥æ˜¯`js`å†…éƒ¨æ˜¾ç¤ºç»‘å®šçš„`window`å¯¹è±¡





# äºŒ. applyã€callã€bind(åˆ›å»ºç»‘å®šthisçš„å‡½æ•°)

---

- é€šè¿‡`call`æˆ–è€…`apply`ç»‘å®š`this`å¯¹è±¡

  - æ˜¾ç¤ºç»‘å®šåŽï¼Œ`this`å°±ä¼šæ˜Žç¡®çš„æŒ‡å‘ç»‘å®šçš„å¯¹è±¡

    ```js
    function bar() { console.log(this) }
    
    bar.call({name: 'later'}) // outputï¼š{name: 'later'}
    bar.call(123) // outputï¼šNumberå¯¹è±¡ï¼Œå­˜æ”¾123
    
    function foo(name, age, height) {
      console.log("fooå‡½æ•°è¢«è°ƒç”¨:", this)
      console.log("æ‰“å°å‚æ•°:", name, age, height)
    }
    
    // apply
    // ç¬¬ä¸€ä¸ªå‚æ•°: ç»‘å®šthis
    // ç¬¬äºŒä¸ªå‚æ•°: ä¼ å…¥é¢å¤–çš„å®žå‚, ä»¥æ•°ç»„çš„å½¢å¼
    // foo.apply("apply", ["kobe", 30, 1.98])
    
    // call
    // ç¬¬ä¸€ä¸ªå‚æ•°: ç»‘å®šthis
    // å‚æ•°åˆ—è¡¨: åŽç»­çš„å‚æ•°ä»¥å¤šå‚æ•°ï¼ˆå‚æ•°åˆ—è¡¨ï¼‰çš„å½¢å¼ä¼ é€’, ä¼šä½œä¸ºå®žå‚
    foo.call("call", "james", 25, 2.05)
    ```
    
  
- å¦‚æžœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªå‡½æ•°æ€»æ˜¯æ˜¾ç¤ºçš„ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œå¯ä»¥æ€Žä¹ˆåšå‘¢ï¼Ÿ

  - ä½¿ç”¨`bind()`æ–¹æ³•ï¼Œ`bind() `æ–¹æ³•**ä¸ä¼šè°ƒç”¨è¯¥å‡½æ•°**ï¼Œ**è€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç»‘å®šäº†`this`çš„å‡½æ•°**ï¼ˆ`bound functionï¼ŒBF`ï¼‰
  
  - ç»‘å®šå‡½æ•°æ˜¯ä¸€ä¸ª` exotic function object`ï¼ˆ**æ€ªå¼‚å‡½æ•°å¯¹è±¡**ï¼Œ`es6 `ä¸­çš„æœ¯è¯­ï¼‰
  
  - **åœ¨` bind() `è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„` this `è¢«æŒ‡å®šä¸º` bind() `çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨**
  
  - æ³¨æ„ï¼š`bind()` çš„å¦ä¸€ä¸ªæœ€ç®€å•çš„ç”¨æ³•æ˜¯ä½¿ä¸€ä¸ªå‡½æ•°æ‹¥æœ‰é¢„è®¾çš„åˆå§‹å‚æ•°ã€‚åªè¦å°†è¿™äº›å‚æ•°ï¼ˆå¦‚æžœæœ‰çš„è¯ï¼‰ä½œä¸º `bind()` çš„å‚æ•°å†™åœ¨ `this` åŽé¢ã€‚å½“ç»‘å®šå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè¿™äº›å‚æ•°ä¼šè¢«æ’å…¥åˆ°ç›®æ ‡å‡½æ•°çš„å‚æ•°åˆ—è¡¨çš„å¼€å§‹ä½ç½®ï¼Œä¼ é€’ç»™ç»‘å®šå‡½æ•°çš„å‚æ•°ä¼šè·Ÿåœ¨å®ƒä»¬åŽé¢
    - æ„æ€å°±æ˜¯ï¼š**`bind`ä¼ å…¥çš„å…¶ä½™å‚æ•°ï¼Œä¼šä½œä¸ºæ–°å‡½æ•°çš„åˆå§‹å‚æ•°ï¼Œè€Œæ–°å‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ä¼šåœ¨è¿™äº›åˆå§‹å‚æ•°ä¹‹åŽ**
    
      ```js
      function bind(thisArg[, arg1[, arg2[, ...]]])
      ```
      
      ```js
      function foo(name, age, height, address, ...args) {
        console.log("foo:", this)
        console.log("å‚æ•°:", name, age, height, address, ...args)
      }
      
      var obj = { name: "why" }
      
      // éœ€æ±‚: è°ƒç”¨fooæ—¶, æ€»æ˜¯ç»‘å®šåˆ°objå¯¹è±¡èº«ä¸Š(ä¸å¸Œæœ›objå¯¹è±¡èº«ä¸Šæœ‰å‡½æ•°)
      // 1. bindå‡½æ•°çš„åŸºæœ¬ä½¿ç”¨
      // var bar = foo.bind(obj)
      // bar() // this -> obj
      
      // 2. bindå‡½æ•°çš„å…¶ä»–å‚æ•°
      var bar = foo.bind(obj, "kobe", 18, 1.88)
      bar("james", 'aaa')
      // outputï¼š
      // foo: {name: 'why'}
      // å‚æ•°: kobe 18 1.88 james aaa
      ```

> **è¡¥å……ï¼š**
>
> - **ç”±äºŽ ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this` æŒ‡é’ˆï¼Œé€šè¿‡ `call()` *æˆ–* `apply()` æ–¹æ³•è°ƒç”¨ä¸€ä¸ªç®­å¤´å‡½æ•°æ—¶ï¼Œåªèƒ½ä¼ é€’å‚æ•°ï¼ˆä¸èƒ½ç»‘å®š `this`ï¼‰ï¼Œä»–ä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å¿½ç•¥ã€‚ï¼ˆè¿™ç§çŽ°è±¡å¯¹äºŽ `bind` æ–¹æ³•åŒæ ·æˆç«‹ï¼‰**
>
>   ```js
>   var adder = {
>     base : 1,
>         
>     add : function(a) {
>       var f = v => v + this.base
>       return f(a)
>     },
>         
>     addThruCall: function(a) {
>       var f = v => v + this.base
>       var b = {
>         base : 2
>       }
>         
>       return f.call(b, a)
>     }
>   };
>         
>   console.log(adder.add(1))         // è¾“å‡º 2
>   console.log(adder.addThruCall(1)) // ä»ç„¶è¾“å‡º 2
>   ```
>
>   



# ä¸‰. thisç»‘å®šä¼˜å…ˆçº§

---

å­¦ä¹ äº†å››æ¡è§„åˆ™ï¼ŒæŽ¥ä¸‹æ¥å¼€å‘ä¸­æˆ‘ä»¬åªéœ€è¦åŽ»æŸ¥æ‰¾å‡½æ•°çš„è°ƒç”¨åº”ç”¨äº†å“ªæ¡è§„åˆ™å³å¯ï¼Œä½†æ˜¯å¦‚æžœä¸€ä¸ªå‡½æ•°è°ƒç”¨ä½ç½®åº”ç”¨äº†å¤šæ¡è§„åˆ™ï¼Œä¼˜å…ˆçº§è°æ›´é«˜å‘¢ï¼Ÿ

1. **é»˜è®¤è§„åˆ™çš„ä¼˜å…ˆçº§æœ€ä½Ž**
     - æ¯«æ— ç–‘é—®ï¼Œé»˜è®¤è§„åˆ™çš„ä¼˜å…ˆçº§æ˜¯æœ€ä½Žçš„ï¼Œå› ä¸ºå­˜åœ¨å…¶ä»–è§„åˆ™æ—¶ï¼Œå°±ä¼šé€šè¿‡å…¶ä»–è§„åˆ™çš„æ–¹å¼æ¥ç»‘å®š`this`


2. **æ˜¾ç¤ºç»‘å®šä¼˜å…ˆçº§é«˜äºŽéšå¼ç»‘å®š**

   ```js
   var obj = {
     foo: function() {
       console.log(this)
     }
   }
   
   obj.foo.call('haha') // outputï¼šStringÂ {'haha'}
   ```

3. **`bind`ç»‘å®šä¼˜å…ˆçº§é«˜äºŽ`apply/call`**

   ```js
   function func() { console.log(this) }
   
   var func2 = func.bind('haha')
   
   func2.call('hehe') // outputï¼šStringÂ {'haha'}
   func2.apply('hehe') // outputï¼šStringÂ {'haha'}
   ```

4. **`new`ç»‘å®šä¼˜å…ˆçº§æœ€é«˜**

     - **`new`ç»‘å®šå’Œ`callã€apply`æ˜¯ä¸å…è®¸åŒæ—¶ä½¿ç”¨çš„**ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è°çš„ä¼˜å…ˆçº§æ›´é«˜	

     - `new`ç»‘å®šå¯ä»¥å’Œ`bind`ä¸€èµ·ä½¿ç”¨ï¼Œ`new`ç»‘å®šä¼˜å…ˆçº§æ›´é«˜

   ```js
   function func() { console.log(this) }
   
   var func2 = func.bind('haha')
   
   new func2() // outputï¼šfuncÂ {}
   ```





# å››. ç»‘å®šä¹‹å¤–çš„æƒ…å†µ

---

## 1. thisè§„åˆ™ä¹‹å¤– â€“ å¿½ç•¥æ˜¾ç¤ºç»‘å®š

- æˆ‘ä»¬è®²åˆ°çš„è§„åˆ™å·²ç»è¶³ä»¥åº”ä»˜å¹³æ—¶çš„å¼€å‘ï¼Œä½†æ˜¯æ€»æœ‰ä¸€äº›è¯­æ³•ï¼Œè¶…å‡ºäº†æˆ‘ä»¬çš„è§„åˆ™ä¹‹å¤–ï¼ˆç¥žè¯æ•…äº‹å’ŒåŠ¨æ¼«ä¸­æ€»æ˜¯æœ‰ç±»ä¼¼è¿™æ ·çš„äººç‰©ï¼‰

- æƒ…å†µä¸€ï¼šå¦‚æžœåœ¨**æ˜¾ç¤ºç»‘å®šä¸­**ï¼Œæˆ‘ä»¬**ä¼ å…¥ä¸€ä¸ª`null`æˆ–è€…`undefined`**ï¼Œé‚£ä¹ˆè¿™ä¸ª**æ˜¾ç¤ºç»‘å®šä¼šè¢«å¿½ç•¥**ï¼Œ**ä½¿ç”¨é»˜è®¤è§„åˆ™**ï¼š

  - ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºç»‘å®š`null`æˆ–`undefined`ï¼Œ`this`æŒ‡å‘çš„æ˜¯åŽŸç”ŸåŸºæœ¬æ•°æ®ç±»åž‹
  - éžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºç»‘å®š`null`æˆ–`undfined`ï¼Œ`this`æŒ‡å‘`window`
    - **å› ä¸º`null`å’Œ`undefined`æ²¡æœ‰å¯¹åº”çš„åŒ…è£…ç±»åž‹**

  ```js
  function foo() { console.log(this) }
  var obj  = {
    name: 'why'
  }
  
  foo.call(obj) // outputï¼šobjå¯¹è±¡ => objå¯¹è±¡(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  foo.call('abc') // outputï¼šString {'abc'} => 'abc'(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  foo.call(null) // outputï¼šwindow => null(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  foo.apply(undefined) // outputï¼šwindow =>  undefined(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  
  var bar = foo.bind(null)
  bar() // outputï¼šwindow => null(ä¸¥æ ¼æ¨¡å¼ä¸‹)
  ```

## 2. thisè§„åˆ™ä¹‹å¤– - é—´æŽ¥å‡½æ•°å¼•ç”¨

- æƒ…å†µäºŒï¼šåˆ›å»ºä¸€å‡½æ•°çš„é—´æŽ¥å¼•ç”¨ï¼Œè¿™ç§æƒ…å†µä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™

  - èµ‹å€¼`(obj2.foo = obj1.foo)`çš„ç»“æžœæ˜¯`foo`å‡½æ•°
  - `foo`å‡½æ•°è¢«ç›´æŽ¥è°ƒç”¨ï¼Œé‚£ä¹ˆæ˜¯é»˜è®¤ç»‘å®š

  ```js
  function foo() { console.log(this) }
  var obj1  = {
    name: 'obj1',
    foo: foo
  }
  
  var obj2 = {
    name: 'obj2'
  }
  
  obj1.foo(); // obj1å¯¹è±¡
  (obj2.foo = obj1.foo)() // window 
  // åœ†æ‹¬å·ä¼šå½“æˆä¸€ä¸ªè¡¨è¾¾å¼åŽ»è§£æžï¼Œè€Œè¯¥è¡¨è¾¾å¼å†…éƒ¨åœ¨èµ‹å€¼çš„åŒæ—¶ï¼Œä¹Ÿä¼šè¿”å›žè¡¨è¾¾å¼å³ä¾§çš„å€¼(å³obj1ä¸­çš„fooå±žæ€§æ‰€æŒ‡å‘çš„å‡½æ•°)ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¼šå½“æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨
  ```

## 3. thisè§„åˆ™ä¹‹å¤– â€“ ES6ç®­å¤´å‡½æ•°çš„thisä½¿ç”¨

- ç®­å¤´å‡½æ•°ä¸ä½¿ç”¨`this`çš„å››ç§æ ‡å‡†è§„åˆ™ï¼ˆä¹Ÿå°±æ˜¯**ä¸ç»‘å®š`this`**ï¼‰ï¼Œè€Œæ˜¯**æ ¹æ®å¤–å±‚ä½œç”¨åŸŸæ¥å†³å®š`this`**

- æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„æ¡ˆä¾‹ï¼š

  - è¿™é‡Œä½¿ç”¨`setTimeout`æ¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚åˆ°æ•°æ®åŽå¦‚ä½•å¯ä»¥å­˜æ”¾åˆ°`data`ä¸­å‘¢ï¼Ÿ
  - æˆ‘ä»¬éœ€è¦æ‹¿åˆ°`obj`å¯¹è±¡ï¼Œè®¾ç½®`data`
  - ä½†æ˜¯ç›´æŽ¥æ‹¿åˆ°çš„`this`æ˜¯`window`ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤–å±‚å®šä¹‰ï¼š`var _this = this`
  - åœ¨`setTimeout`çš„å›žè°ƒå‡½æ•°ä¸­ä½¿ç”¨`_this`å°±ä»£è¡¨äº†`obj`å¯¹è±¡

  ```js
  var obj = {
    data: [],
    getData: function() {
      var _this = this; // å½“é€šè¿‡obj.getDataè°ƒç”¨å‡½æ•°æ—¶ï¼Œå‡½æ•°å†…éƒ¨çš„thisç»‘å®šåˆ°äº†objå¯¹è±¡ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å˜é‡_thisæŒ‡å‘å‡½æ•°å†…éƒ¨çš„thisï¼Œå½“æ‰§è¡ŒsetTimeoutä¸­çš„å›žè°ƒå‡½æ•°æ—¶ï¼Œå…¶ä¸­çš„thisæ˜¯æ‰§è¡Œwindowçš„ï¼Œå› ä¸ºsetTimeoutä¸­çš„å‡½æ•°æ˜¯æ˜¾ç¤ºç»‘å®šåˆ°windowèº«ä¸Šçš„ï¼Œæ‰€ä»¥å…¶å†…éƒ¨çš„å›žè°ƒå‡½æ•°ä¸­thisæ‰§è¡Œçš„å°±æ˜¯windowäº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨_thiså˜é‡ï¼Œä¼šå¾€ä¸Šå±‚ä½œç”¨åŸŸä¸€å±‚ä¸€å±‚å¾€æŸ¥æ‰¾è¯¥å˜é‡ï¼Œæœ€åŽåœ¨ä¸Šå±‚å‡½æ•°ä½œç”¨åŸŸä¸­æ‰¾åˆ°_thiså˜é‡
      setTimeout(function() {
        // æ¨¡æ‹ŸèŽ·å–åˆ°çš„æ•°æ®
        var res = ['abc', 'cba']
        _this.data.push(...res)
      }, 1000)
    }
  }
  
  obj.getData()
  ```





# äº”. ç®­å¤´å‡½æ•°çš„ä½¿ç”¨

---

## 1. ç®­å¤´å‡½æ•° arrow function

- ç®­å¤´å‡½æ•°æ˜¯`ES6`ä¹‹åŽå¢žåŠ çš„ä¸€ç§ç¼–å†™å‡½æ•°çš„æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒæ¯”å‡½æ•°è¡¨è¾¾å¼è¦æ›´åŠ ç®€æ´ï¼š

  - **ç®­å¤´å‡½æ•°ä¸ä¼šç»‘å®š`this`ã€`arguments`å±žæ€§ï¼Œå³ä½¿ä½¿ç”¨ `call` ç­‰æ˜¾ç¤ºç»‘å®šä¹Ÿæ— ç”¨ï¼Œåªèƒ½ä»Žä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾**
  - ç®­å¤´å‡½æ•°**ä¸èƒ½ä½œä¸ºæž„é€ å‡½æ•°æ¥ä½¿ç”¨**ï¼ˆä¸èƒ½å’Œ`new`ä¸€èµ·æ¥ä½¿ç”¨ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼‰
    - æ‰€ä»¥**ç®­å¤´å‡½æ•°æ˜¯æ²¡æœ‰æ˜¾å¼åŽŸåž‹çš„ï¼Œä½†æ˜¯ä½œä¸ºå¯¹è±¡æ˜¯æœ‰éšå¼åŽŸåž‹**

- ç®­å¤´å‡½æ•°å¦‚ä½•ç¼–å†™å‘¢ï¼Ÿ

  - ()ï¼šå‡½æ•°çš„å‚æ•°
  - {}ï¼šå‡½æ•°çš„æ‰§è¡Œä½“

  ```js
  // 1.ä¹‹å‰çš„æ–¹å¼
  function foo1() {}
  var foo2 = function(name, age) {
    console.log("å‡½æ•°ä½“ä»£ç ", this, arguments)
    console.log(name, age)
  }
  
  // 2.ç®­å¤´å‡½æ•°å®Œæ•´å†™æ³•
  var foo3 = (name, age) => {
    console.log("ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“")
    console.log(name, age)
  }
  
  // 3.ç®­å¤´å‡½æ•°çš„ç»ƒä¹ 
  // 3.1. forEach
  var names = ["abc", "cba", "nba"]
  names.forEach((item, index, arr) => {
    console.log(item, index, arr)
  })
  // 3.2. setTimeout
  setTimeout(() => {
    console.log("----")
  }, 3000)
  ```

## 2. ç®­å¤´å‡½æ•°çš„ç¼–å†™ä¼˜åŒ–

- ä¼˜åŒ–ä¸€ï¼šå¦‚æžœ**åªæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥çœç•¥()**

  ```js
  nums.forEach(item => {})
  ```

- ä¼˜åŒ–äºŒï¼šå¦‚æžœ**å‡½æ•°æ‰§è¡Œä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç (é™¤`return`)ï¼Œå¯ä»¥çœç•¥å¤§æ‹¬å·**ï¼Œä¸”**ä¼šè‡ªåŠ¨è¿”å›žè¯¥è¡Œä»£ç çš„è¿”å›žå€¼**

  - å¦‚æžœå‡½æ•°ä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç ï¼Œæœ‰`return`çš„æ—¶å€™ï¼Œä¸èƒ½çœç•¥å¤§æ‹¬å·ï¼Œå¯ä»¥ç›´æŽ¥åŽ»æŽ‰`return`ï¼Œå› ä¸ºè¿™è¡Œä»£ç çš„è¿”å›žå€¼ä¼šä½œä¸ºæ•´ä¸ªå‡½æ•°çš„è¿”å›žå€¼

  ```js
  nums.forEach(item => console.log(item))
  nums.filter(item => item % 2 == 0)
  ```

- ä¼˜åŒ–ä¸‰ï¼šå¦‚æžœå‡½æ•°æ‰§è¡Œä½“**è¿”å›žå€¼æ˜¯ä¸€ä¸ªå¯¹è±¡**ï¼Œé‚£ä¹ˆ**éœ€è¦ç»™è¿™ä¸ªå¯¹è±¡åŠ ä¸Š`()`**

  - å› ä¸ºå¦‚æžœä¸åŠ çš„è¯ï¼Œ`js`å¼•æ“Žä¼šè§£æžæˆå‡½æ•°`{}`çš„æ‰§è¡Œä½“

  ```js
  var foo = () => {
    return {name: 'abc'}
  }
  var bar = () => ({name: 'abc'})
  ```





# å…­. ç®­å¤´å‡½æ•°thisçš„æŸ¥æ‰¾è§„åˆ™

---

- ä¹‹å‰çš„ä»£ç åœ¨`ES6`ä¹‹å‰æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œä»Ž`ES6`å¼€å§‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š

  - ä¸ºä»€ä¹ˆåœ¨`setTimeout`çš„å›žè°ƒå‡½æ•°ä¸­å¯ä»¥ç›´æŽ¥ä½¿ç”¨`this`å‘¢ï¼Ÿ
  - å› ä¸º**ç®­å¤´å‡½æ•°ä¸ç»‘å®š`this`å¯¹è±¡**ï¼Œé‚£ä¹ˆ`this`å¼•ç”¨å°±ä¼š**ä»Žä¸Šå±‚ä½œç”¨åŸŸä¸­æ‰¾åˆ°å¯¹åº”çš„`this`**
    - æ‰€ä»¥`this`ç»‘å®šå¯¹ç®­å¤´å‡½æ•°æ˜¯æ— æ•ˆçš„
  - **ç®­å¤´å‡½æ•°ä¸­æ˜¯æ²¡æœ‰`this`çš„ï¼Œå…¶ä¸­`this`æ˜¯å¾€ä¸Šå±‚ä½œç”¨åŸŸä¸€å±‚ä¸€å±‚æŸ¥æ‰¾ï¼Œå¦‚æžœéƒ½æ²¡æœ‰ï¼Œå°±æ˜¯`window`**
  
  ```js
  var obj = {
    data: [],
    getData: function() {
      setTimeout(() => {
        var res = ['abc', 'cba']
        console.log(this) 
        this.data.push(...res)
      }, 1000)
    }
  }
  obj.getData() // outputï¼šobjå¯¹è±¡
  
  var obj2 = {
    getData: () => {
      setTimeout(() => {
        console.log(this)
      }, 1000)
    }
  }
  obj2.getData() // outputï¼šwindow å› ä¸ºç®­å¤´å‡½æ•°ä¸­æ˜¯æ²¡æœ‰thisçš„ï¼Œæ˜¯å¾€ä¸Šå±‚ä½œç”¨åŸŸä¸€å±‚ä¸€å±‚æŸ¥æ‰¾çš„ï¼Œæœ€å¤–å±‚thisæŒ‡å‘windowå¯¹è±¡
  ```
  

> æ³¨æ„ï¼š
>
> - å‡½æ•°çš„ä½œç”¨åŸŸé“¾æ˜¯åœ¨å‡½æ•°å£°æ˜Žï¼ˆç¼–å†™/å®šä¹‰ï¼‰çš„æ—¶å€™å°±ç¡®å®šä¸‹æ¥äº†





# ä¸ƒ. thisé¢è¯•é¢˜åˆ†æž

---

```js
var name = '222'
var person = {
  name: 'person',
  sayName: function() {
    console.log(this.name)
  }
}

function sayName() {
  var sss = person.sayName;
  sss()
  person.sayName()
  (person.sayName)()
  (b = person.sayName)()
}

sayName()
// outputï¼š
// '222' é»˜è®¤ç»‘å®šï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
// 'person' éšå¼ç»‘å®š
// person' éšå¼ç»‘å®šï¼Œç­‰åŒäºŽperson.sayName(), åŠ å°æ‹¬å·ä¸åŠ æ•ˆæžœå®Œå…¨ä¸€æ ·ï¼ŒåŠ å°æ‹¬å·æŽ§åˆ¶ä»£ç ä¼˜å…ˆçº§ï¼Œä¸åŠ å°æ‹¬å·ï¼Œæœ¬èº«ç‚¹.è¯­æ³•ä¼˜å…ˆçº§å°±å¾ˆé«˜
// '222' é—´æŽ¥å‡½æ•°å¼•ç”¨ï¼Œèµ‹å€¼è¯­å¥è¿”å›žç»“æžœå³ç‹¬ç«‹å‡½æ•°è°ƒç”¨
```

```js
var name = '222'
var person1 = {
  name: 'person1',
  foo1: function() {
    console.log(this.name)
  },
  foo2: () => console.log(this.name),
  foo3: function() {
    return function() {
      console.log(this.name)
    }
  },
  foo4: function() {
    return () => {
      console.log(this.name)
    }
  }
}

var person2 = {name: 'person2'}

person1.foo1() // 'person1' éšå¼ç»‘å®š
person1.foo1.call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo2() // '222' ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo2.call(person2) // '222' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this

person1.foo3()() // '222' é»˜è®¤ç»‘å®š æ‹¿åˆ°è¿”å›žçš„æ™®é€šå‡½æ•°ç›´æŽ¥è¿›è¡Œé»˜è®¤è°ƒç”¨
person1.foo3.call(person2)() // '222' é»˜è®¤ç»‘å®š æ‹¿åˆ°è¿”å›žçš„æ™®é€šå‡½æ•°ç›´æŽ¥è¿›è¡Œé»˜è®¤è°ƒç”¨
person1.foo3().call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo4()() // 'person1' ç®­å¤´å‡½æ•°è°ƒç”¨ä¼šä»Žä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo4.call(person2)() // 'person2' ç®­å¤´å‡½æ•°è°ƒç”¨ä¼šä»Žä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo4().call(person2) // 'person1' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä»Žä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
```

```js
var name = '222'
function Person(name) {
  this.name = name
  this.foo1 = function() {
    console.log(this.name)
  }
  this.foo2 = () => console.log(this.name)
  this.foo3 = function() {
    return function() {
      console.log(this.name)
    }
  }
  this.foo4 = function() {
    return () => {
      console.log(this.name)
    }
  }
}

var person1 = new Person('person1')
var person2 = new Person('person2')

person1.foo1() // 'person1' éšå¼ç»‘å®š
person1.foo1.call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo2() // 'person1' ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾ï¼šä¸Šå±‚ä½œç”¨åŸŸä¸­çš„thisç»‘å®šåˆ°äº†person1
person1.foo2.call(person2) // 'person1' ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾

person1.foo3()() // '222' é»˜è®¤ç»‘å®š ç‹¬ç«‹å‡½æ•°è°ƒç”¨
person1.foo3.call(person2)() // '222' é»˜è®¤ç»‘å®š ç‹¬ç«‹å‡½æ•°è°ƒç”¨
person1.foo3().call(person2) // 'person2' æ˜¾å¼ç»‘å®š

person1.foo4()() // 'person1' ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾
person1.foo4.call(person2)() // 'person2' foo4å‡½æ•°ä¸­thisç»‘å®šperson2ï¼Œç®­å¤´å‡½æ•°æŸ¥æ‰¾ä¸Šå±‚ä½œç”¨åŸŸfoo4å‡½æ•°ä¸­çš„this
person1.foo4().call(person2) // 'person1' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾
```

```js
var name = '222'
function Person(name) {
  this.name = name
  this.obj = {
    name: 'obj',
    foo1: function() {
      return function() {
        console.log(this.name)
      }
    },
    foo2: function() {
      return () => {
        console.log(this.name)
      }
    }
  }
}

var person1 = new Person('person1')
var person2 = new Person('person2')

person1.obj.foo1()() // '222' æ™®é€šå‡½æ•°é»˜è®¤è°ƒç”¨ï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
person1.obj.foo1.call(person2)() // '222' æ™®é€šå‡½æ•°é»˜è®¤è°ƒç”¨ï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
person1.obj.foo1().call(person2) // 'person2' æ™®é€šå‡½æ•°æ˜¾å¼ç»‘å®šè°ƒç”¨

person1.obj.foo2()() // 'obj' ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thiséšå¼ç»‘å®šobj
person1.obj.foo2.call(person2)() // 'person2' ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thisæ˜¾å¼ç»‘å®šperson2
person1.obj.foo2().call(person2) // 'obj' ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thiséšå¼ç»‘å®šobj
```

> æ€»ç»“ï¼š
>
> - **æ™®é€šå‡½æ•°ä¸­çš„`this`ï¼Œæ˜¯æ ¹æ®è°ƒç”¨çš„æ—¶å€™ç»‘å®šçš„**
> - **ç®­å¤´å‡½æ•°ä¸­æ˜¯æ²¡æœ‰`this`çš„ï¼Œæ‰€ä»¥æ˜¯ä¸è¢«ç»‘å®šçš„ï¼Œä¼šåŽ»ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾`this`ï¼Œæ˜¯æ ¹æ®æ‰§è¡Œä¸Šä¸‹æ–‡å†³å®šçš„**





# å…«. æ‰‹å†™applyã€callã€bind

---

```js
Function.prototype.executionFn = function(thisArg, args) {
  thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg) // è¿™é‡Œæ˜¯é˜²æ­¢ä¼ å…¥ç»‘å®šçš„å‚æ•°ä¸ºç©ºæˆ–è€…æ˜¯åŽŸå§‹ç±»åž‹çš„å€¼ï¼Œå¦‚stringæˆ–number
  Object.defineProperty(thisArg, '_this', {
    configurable: true,
    enumerable: falseï¼Œ
    value: this
  })
  args ? thisArg._this(...args) : thisArg._this()
  delete this._this
}

/**
* ç§æœ‰çš„applyæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°æ•°ç»„
*/
Function.prototype._apply = function(thisArg, args) {
  // thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  // thisArg._this = this
  // Object.defineProperty(thisArg, '_this', {
  //   configurable: true,
  //   enumerable: false
  // })
  // args ? thisArg._this(...args) : thisArg._this()
  this.executionFn(thisArg, args)
}

function foo(name, age) {
  console.log(this, name, age)
}

foo._apply({name: 'later'}, ['later', 18])
foo._apply('abc', ['later', 18])
foo._apply()

/**
* ç§æœ‰çš„callæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°åˆ—è¡¨
*/
Function.prototype._call = function(thisArg, ...args) {
  // thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  // thisArg._this = this
  // Object.defineProperty(thisArg, '_this', {
  //   configurable: true,
  //   enumerable: false
  // })
  // args ? thisArg._this(...args) : thisArg._this()
  this.executionFn(thisArg, args)
}

foo._call()
foo._call({name: 'later'}, 'later', 18)
foo._call('abc', 'later', 18)
```

```js
function foo(name, age) {
  console.log(this, name, age)
}
/**
* ç§æœ‰çš„bindæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°åˆ—è¡¨
*/
Function.prototype._bind = function(thisArg, ...args) {
  thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  Object.defineProperty(thisArg, '_this', {
    configurable: true,
    enumerable: false,
    value: this
  })

  return (...rest) => {
    args ? thisArg._this(...args, ...rest) : thisArg._this(...rest)
  }
}

var foo2 = foo._bind({name: 'later'}, 'later')
foo2(23)
foo2(18)
foo2()
var foo3 = foo._bind()
foo3()
```







