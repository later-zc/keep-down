# ä¸€. this çš„ç»‘å®šè§„åˆ™
:::info
`this` è¡¨ç¤º**å‡½æ•°è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡**ï¼Œæ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œåœ¨å‡½æ•°è¿è¡Œæ—¶è‡ªåŠ¨å‡ºç°ã€‚ä½†å®ƒçš„å€¼å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯æ ¹æ®å‡½æ•°çš„**è°ƒç”¨æ–¹å¼**å†³å®šã€‚
:::



## this åˆ°åº•æŒ‡å‘ä»€ä¹ˆå‘¢ï¼Ÿ

**â“å…ˆæ¥çœ‹ä¸€ä¸ªè®©äººå›°æƒ‘çš„é—®é¢˜ï¼š**

> ä¸‹é¢æˆ‘ä»¬ç”¨ä¸‰ç§æ–¹å¼è°ƒç”¨åŒä¸€ä¸ªå‡½æ•° fooï¼Œè§‚å¯Ÿ this çš„æŒ‡å‘ã€‚

```js
function foo() { 
  console.log(this)
}

// æ–¹å¼ä¸€ï¼šç›´æ¥è°ƒç”¨ï¼ˆé»˜è®¤ç»‘å®šï¼‰
foo()

// æ–¹å¼äºŒï¼šé€šè¿‡å¯¹è±¡è°ƒç”¨ï¼ˆéšå¼ç»‘å®šï¼‰
var obj = {
  name: 'later',
  foo: foo
}
obj.foo()

// æ–¹å¼ä¸‰ï¼šä½¿ç”¨ call æ˜¾å¼ç»‘å®š
foo.call('abc')
```

**åˆ†æè¿è¡Œç»“æœï¼ˆæµè§ˆå™¨å’Œ Node.jsç¯å¢ƒï¼‰**
| è°ƒç”¨æ–¹å¼ | ä»£ç  | æµè§ˆå™¨ä¸­çš„ this | Node.js ä¸­çš„ this |
| - | - | - | - |
| ç›´æ¥è°ƒç”¨ | `foo()`	| window(éä¸¥ï¼‰undefined(ä¸¥ï¼‰| globalï¼ˆéä¸¥ï¼‰undefinedï¼ˆä¸¥ï¼‰|
| éšå¼ç»‘å®š |	`obj.foo()` | obj | obj |
| æ˜¾å¼ç»‘å®š |	`foo.call('abc')` |	`String {'abc'}`(éä¸¥ï¼‰`'abc'`(ä¸¥) |	`[String: 'abc']`(éä¸¥ï¼‰`'abc'`(ä¸¥) |

**è¿™è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ**
> 1. å‡½æ•°è°ƒç”¨æ—¶ï¼ŒJS **ä¸º this è‡ªåŠ¨ç»‘å®šä¸€ä¸ªå€¼**ï¼› 
> 2. this æŒ‡å‘**ä¸å‡½æ•°å®šä¹‰çš„ä½ç½®æ— å…³**ï¼› 
> 3. this æŒ‡å‘å®Œå…¨ä¾èµ–äºå‡½æ•°çš„**è°ƒç”¨æ–¹å¼**å’Œæ‰€å¤„çš„**è¿è¡Œç¯å¢ƒ**ï¼› 
> 4. this æ˜¯åœ¨**è¿è¡Œæ—¶ç»‘å®šçš„**ï¼Œè€Œéç¼–è¯‘æœŸå†³å®šã€‚

**é‚£ä¹ˆ this åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„ç»‘å®šè§„åˆ™å‘¢ï¼Ÿ**

> æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸º **4 æ¡åŸºç¡€ç»‘å®šè§„åˆ™ + å…¶ä»–ç‰¹æ®Šæƒ…å†µä¸‹çš„ç»‘å®š**ï¼ŒæŒ‰ç…§åŒ¹é…é¡ºåºå¦‚ä¸‹ï¼š

| ä¼˜å…ˆçº§ | ç»‘å®šæ–¹å¼ | ç¤ºä¾‹ | this æŒ‡å‘                                |
|----|------|----|----------------------------------------|
| 1ï¸âƒ£ | new ç»‘å®š | `new Foo()` | æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ˆæ„é€ å™¨çš„å®ä¾‹ï¼‰                         |
| 2ï¸âƒ£ | æ˜¾å¼ç»‘å®š | `foo.call(obj)` | `call / apply / bind` æ˜¾å¼ä¼ å…¥çš„å¯¹è±¡          |
| 3ï¸âƒ£ | éšå¼ç»‘å®š | `obj.foo()` | è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡ `obj`                         |
| 4ï¸âƒ£ | é»˜è®¤ç»‘å®š | `foo()` | éä¸¥ï¼šå…¨å±€å¯¹è±¡ï¼ˆwindow / global)ï¼Œä¸¥ï¼š`undefined` | 
| +  | ç‰¹æ®Šç»‘å®š | å†…ç½®å‡½æ•° / ç®­å¤´å‡½æ•° / `setTimeout(fn)` | å„æœ‰ä¾‹å¤–ï¼ˆè¯¦è§åæ–‡ï¼‰                             |

**å¦‚ä½•åˆ¤æ–­ this åˆ°åº•ç»‘å®šäº†ä»€ä¹ˆï¼Ÿ**
> æˆ‘ä»¬å¯ä»¥é€šè¿‡â€œ**è°ƒç”¨æ ˆåˆ†ææ³•**â€+â€œä¼˜å…ˆçº§åŒ¹é…â€æ¥åˆ¤æ–­ï¼š
> 1. å‡½æ•°æ˜¯å¦é€šè¿‡ `new` è°ƒç”¨ï¼Ÿ â†’ ä¼˜å…ˆçº§æœ€é«˜
> 2. æ˜¯å¦ä½¿ç”¨äº† `call / apply / bind`ï¼Ÿ â†’ æ˜¾å¼ç»‘å®š 
> 3. æ˜¯å¦ä½œä¸ºå¯¹è±¡å±æ€§è°ƒç”¨ï¼Ÿ â†’ éšå¼ç»‘å®š
> 4. å¦åˆ™ â†’ é»˜è®¤ç»‘å®š
> 5. ç‰¹æ®Šè¯­æ³•ï¼ˆç®­å¤´å‡½æ•°ã€å®šæ—¶å™¨ç­‰ï¼‰å¦è¡Œåˆ†æ

**å…³äº this çš„è¯¯è§£å¾ˆå¤šï¼Œå¸¸è§é™·é˜±åŒ…æ‹¬ï¼š**
> - å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡æˆ–å‚æ•°åè°ƒç”¨ï¼Œå¯¼è‡´ç»‘å®šä¸¢å¤±ï¼›
> - `setTimeout(fn, 0)` ä¸­ `this` è¢«é‡ç½®ï¼›
> - `this` å’Œä½œç”¨åŸŸã€é—­åŒ…æ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µï¼›
> - ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œå®ƒç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸã€‚



## è§„åˆ™ä¸€ï¼šé»˜è®¤ç»‘å®š

:::info **ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤ç»‘å®šï¼Ÿ**
> é»˜è®¤ç»‘å®šçš„è§„åˆ™é€‚ç”¨äº**ç‹¬ç«‹å‡½æ•°è°ƒç”¨**ï¼Œå³ï¼š**å‡½æ•°æ²¡æœ‰è¢«ç»‘å®šåœ¨æŸä¸ªå¯¹è±¡ä¸Šè°ƒç”¨æ—¶ï¼Œthis é»˜è®¤æŒ‡å‘å½“å‰è¿è¡Œæ—¶ç¯å¢ƒçš„å…¨å±€å¯¹è±¡**ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯ undefinedï¼‰ã€‚

> æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æ˜¯ä»¥æœ€æ™®é€šçš„æ–¹å¼ç›´æ¥è°ƒç”¨çš„ï¼Œä¾‹å¦‚ foo()ï¼Œè€Œä¸æ˜¯é€šè¿‡å¯¹è±¡å¼•ç”¨è°ƒç”¨ï¼ˆå¦‚ obj.foo()ï¼‰ï¼Œé‚£ä¹ˆé»˜è®¤ç»‘å®šå°±ç”Ÿæ•ˆã€‚
:::

**æ¡ˆä¾‹ä¸€ï¼šæœ€åŸºç¡€çš„ç‹¬ç«‹å‡½æ•°è°ƒç”¨**
```js
function foo() { console.log(this) }

foo()
```
| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**æ¡ˆä¾‹äºŒï¼šå‡½æ•°åµŒå¥—è°ƒç”¨ä¸­çš„é»˜è®¤ç»‘å®š**
```js
function fn1() {
  console.log(this)
}

function fn2() {
  fn1() // ç›´æ¥è°ƒç”¨
}

fn2()
```
> fn1() ä½œä¸ºæ™®é€šå‡½æ•°ç›´æ¥è°ƒç”¨ï¼Œå› æ­¤ this åº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚ä¸æ˜¯å¦ç”±å¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨å®ƒæ— å…³ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**æ¡ˆä¾‹ä¸‰ï¼šå‡½æ•°å®šä¹‰åœ¨å¯¹è±¡ä¸­ï¼Œé€šè¿‡å˜é‡å¼•ç”¨èµ‹å€¼è°ƒç”¨ï¼Œè§¦å‘é»˜è®¤ç»‘å®š**
```js
var obj = {
  bar: function () { // obj ä¸­çš„ bar ä¿å­˜çš„å®é™…æ˜¯è¯¥å‡½æ•°çš„å¼•ç”¨(å†…å­˜åœ°å€)
    console.log(this)
  }
}

// 1. å˜é‡èµ‹å€¼è°ƒç”¨
var baz = obj.bar // baz åœ¨å†…å­˜ä¸­æŒ‡å‘çš„æ˜¯ obj çš„ bar å±æ€§æ‰€æŒ‡å‘çš„å‡½æ•°çš„å†…å­˜åœ°å€
baz() // => windowå¯¹è±¡ï¼Œå±äºç›´æ¥è°ƒç”¨ï¼ˆè¿™é‡Œè°ƒç”¨å®é™…å°±æ˜¯é€šè¿‡å†…å­˜åœ°å€æ‰¾åˆ°å †å†…å­˜ä¸­çš„å‡½æ•°ï¼Œç‹¬ç«‹è°ƒç”¨è¯¥å‡½æ•°ï¼‰
```
> ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œå°½ç®¡å‡½æ•°æœ€åˆæ˜¯å®šä¹‰åœ¨ obj ä¸­çš„ï¼Œä½†é€šè¿‡å˜é‡ baz è°ƒç”¨æ—¶ï¼Œå®ƒå·²ç»â€œè„±ç¦»â€äº†å¯¹è±¡ä¸Šä¸‹æ–‡ã€‚  
> ç›¸å½“äº baz() æ˜¯ç›´æ¥å‡½æ•°è°ƒç”¨ â†’ ä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**æ¡ˆä¾‹å››ï¼šå‡½æ•°å®šä¹‰åœ¨å¯¹è±¡ä¸­ï¼Œé€šè¿‡å‚æ•°ä¼ é€’å‡½æ•°å¼•ç”¨ï¼Œè§¦å‘é»˜è®¤ç»‘å®š**
```js
var obj = {
  bar: function () {
    console.log(this)
  }
}

function fn1(fn) {
  fn() // ç›´æ¥è°ƒç”¨
}
fn1(obj.bar) // => windowå¯¹è±¡ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯ obj çš„ bar å±æ€§æ‰€æŒ‡å‘çš„å‡½æ•°çš„å†…å­˜åœ°å€(å¼•ç”¨)
```
> ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œobj.bar æ˜¯ä¸€ä¸ªå‡½æ•°å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œä¼ ç»™ fn1 åæ²¡æœ‰ç»‘å®šåˆ°ä»»ä½•å¯¹è±¡ä¸Šã€‚   
> fn() æ˜¯ç›´æ¥è°ƒç”¨ï¼Œä»ç„¶è§¦å‘é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**é»˜è®¤ç»‘å®šè§„åˆ™**
| åˆ¤æ–­è¦ç‚¹ | this çš„ç»‘å®šå€¼ |
|-|-|
| å‡½æ•°ç›´æ¥è°ƒç”¨ï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰ |	æµè§ˆå™¨ï¼š`window`ï¼›Node.jsï¼š`global` |
| å‡½æ•°ç›´æ¥è°ƒç”¨ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ | `undefined` |
| å‡½æ•°é€šè¿‡å˜é‡å¼•ç”¨èµ‹å€¼æˆ–å‚æ•°ä¼ é€’åç›´æ¥è°ƒç”¨ | å±äºç›´æ¥è°ƒç”¨ï¼Œç¬¦åˆé»˜è®¤ç»‘å®šè§„åˆ™ |

**å‡½æ•°â€œè„±ç¦»äº†å¯¹è±¡â€ï¼Œå°±ä¼šè½å…¥â€œé»˜è®¤ç»‘å®šâ€çš„æŒæ§ä¹‹ä¸­ã€‚**



## è§„åˆ™äºŒï¼šéšå¼ç»‘å®š
:::info
åœ¨ JavaScript ä¸­ï¼Œ`this` çš„æŒ‡å‘**å¹¶ä¸æ˜¯ç”±å‡½æ•°åœ¨å“ªé‡Œå®šä¹‰å†³å®šçš„ï¼Œè€Œæ˜¯ç”±å®ƒè¢«è°ƒç”¨çš„æ–¹å¼å†³å®šçš„ã€‚
å½“ä¸€ä¸ªå‡½æ•°é€šè¿‡å¯¹è±¡å±æ€§è°ƒç”¨æ—¶ï¼Œthis ä¼šè¢«â€œéšå¼â€ç»‘å®šåˆ°è¯¥å¯¹è±¡ä¸Šã€‚**
:::

**ä»€ä¹ˆæ˜¯éšå¼ç»‘å®šï¼Ÿ**  
```js
// è°ƒç”¨å½¢å¼
object.method()
```
åªè¦å‡½æ•°æ˜¯é€šè¿‡**å¯¹è±¡å±æ€§**çš„æ–¹å¼æ¥è®¿é—®å¹¶è°ƒç”¨çš„ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼ŒJS å¼•æ“å°±ä¼šå°†è¯¥å¯¹è±¡ç»‘å®šä¸ºå‡½æ•°å†…éƒ¨çš„ thisã€‚

**âœ… ç¤ºä¾‹ 1ï¼šåŸºç¡€éšå¼ç»‘å®š**
```js
function sayName() {
  console.log(this.name) // å‡½æ•°å†…éƒ¨çš„ this è¢«ç»‘å®šä¸º person å¯¹è±¡
}

const person = {
  name: 'Alice',
  sayName: sayName
}

person.sayName()
```
> å‡½æ•° sayName è¢«ä½œä¸º person å¯¹è±¡çš„å±æ€§æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ this è¢«ç»‘å®šä¸º person å¯¹è±¡ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | 'Alice' | 'Alice' |
| Node.js | 'Alice' | 'Alice' |

**âœ… ç¤ºä¾‹ 2ï¼šå¤šå±‚å¯¹è±¡è®¿é—®**
```js
function greet() {
  console.log(this.name)
}

const user1 = { name: 'Tom', greet: greet }
const user2 = { name: 'Jerry', user1: user1 }

user2.user1.greet()
```
> è°ƒç”¨è¯­å¥æ˜¯ user2.user1.greet()ï¼Œä½†çœŸæ­£è°ƒç”¨å‡½æ•°çš„æ˜¯ user1ï¼› æ‰€ä»¥ this ç»‘å®šä¸º user1ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-|-|
| æµè§ˆå™¨ | 'Tom' | 'Tom' |
| Node.js | 'Tom' | 'Tom' |

**âš ï¸ç¤ºä¾‹ 3ï¼šå‡½æ•°èµ‹å€¼å¯¼è‡´éšå¼ç»‘å®šä¸¢å¤±ï¸**
```js
function show() {
  console.log(this)
}

const obj = {
  show: show
}

const fn = obj.show
fn() // è¾“å‡ºï¼šï¼Ÿ
```
ä½ å¯èƒ½ä»¥ä¸º this è¿˜æ˜¯ objï¼Œä½†å…¶å®ä¸æ˜¯ï¼
> fn() æ˜¯ç›´æ¥è°ƒç”¨ï¼Œä¸å†é€šè¿‡ objï¼Œæ‰€ä»¥é»˜è®¤ç»‘å®šè§„åˆ™ä¼šç”Ÿæ•ˆã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|--------|--------|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**âš ï¸ç¤ºä¾‹ 4ï¼šå‚æ•°ä¼ é€’æ—¶ä¹Ÿä¼šå‘ç”Ÿéšå¼ä¸¢å¤±**
```js
function display() {
  console.log(this)
}

const context = {
  display: display
}

function callFn(fn) {
  fn() // ç‹¬ç«‹è°ƒç”¨
}

callFn(context.display) // è¾“å‡ºï¼šï¼Ÿ
```
> å°½ç®¡ä¼ å…¥çš„æ˜¯ context.displayï¼Œä½†ä¼ å…¥çš„ä»…ä»…æ˜¯å‡½æ•°å¼•ç”¨ï¼Œä¼ å…¥å‡½æ•°åæ˜¯â€œç›´æ¥è°ƒç”¨â€ï¼Œä¸å†æœ‰å¯¹è±¡ä¸Šä¸‹æ–‡äº†ï¼Œæ‰€ä»¥å‘ç”Ÿäº†éšå¼ç»‘å®šä¸¢å¤±ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|--------|--------|
| æµè§ˆå™¨ | window | undefined |
| Node.js | global | undefined |

**å°ç»“ï¼šéšå¼ç»‘å®šçš„è¦ç‚¹**
| è°ƒç”¨æ–¹å¼               | this ç»‘å®šå¯¹è±¡ |
| ------------------ | --------- |
| `obj.fn()`         | obj     |
| `obj1.obj2.fn()`   | obj2    |
| `var fn = obj.fn`  | é»˜è®¤ç»‘å®šï¼ˆéšå¼ç»‘å®šä¸¢å¤±ï¼‰  |
| `callback(obj.fn)` | é»˜è®¤ç»‘å®šï¼ˆéšå¼ç»‘å®šä¸¢å¤±ï¼‰  |



## è§„åˆ™ä¸‰ï¼šæ˜¾å¼ç»‘å®š

:::info
åœ¨éšå¼ç»‘å®šä¸­ï¼Œ`this` çš„ç»‘å®šä¾èµ–äºè°ƒç”¨å¯¹è±¡ã€‚è€Œ**æ˜¾å¼ç»‘å®š**å…è®¸æˆ‘ä»¬é€šè¿‡ callã€apply å’Œ bind **â€œæ‰‹åŠ¨æŒ‡å®šâ€ this çš„æŒ‡å‘**ï¼Œä¸å†ä¾èµ–äºè°ƒç”¨ä½ç½®ã€‚
:::

**ä»€ä¹ˆæ˜¯æ˜¾å¼ç»‘å®šï¼Ÿ**
> JS ä¸­æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ‹¥æœ‰ `.call()` å’Œ `.apply()` æ–¹æ³•ï¼Œå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç”¨äºç»‘å®š this çš„å€¼ã€‚
```js
func.call(thisArg, arg1, arg2, ...)    // å‚æ•°åˆ—è¡¨
func.apply(thisArg, [arg1, arg2, ...]) // å‚æ•°æ•°ç»„
```
> thisArgï¼šå‡½æ•°è¿è¡Œæ—¶è¦ç»‘å®šä¸º this çš„å¯¹è±¡ï¼Œåç»­å‚æ•°åˆ†åˆ«ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ã€‚

å¯¹äºè¿™ç±»ï¼Œæ˜ç¡®äº† this è¦ç»‘å®šçš„å¯¹è±¡çš„è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º**æ˜¾å¼ç»‘å®š**ã€‚

**âœ… ç¤ºä¾‹ 1ï¼šä½¿ç”¨ call æ˜¾å¼ç»‘å®š**
```js
const person = { name: 'Later' }

function sayHello() {
  console.log(this.name)
}

sayHello.call(person)
```
> sayHello åŸæœ¬æ˜¯ç‹¬ç«‹å‡½æ•°ï¼Œé€šè¿‡ .call(person) æ˜¾å¼ç»‘å®š thisï¼Œä½¿å…¶æŒ‡å‘ personã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|-------|------|
| æµè§ˆå™¨ | 'Later' | 'Later' |
| Node.js | 'Later' | 'Later' |

**âœ… ç¤ºä¾‹ 2ï¼šä½¿ç”¨ apply æ˜¾å¼ç»‘å®š + ä¼ å‚**
```js
const user = { name: 'Alice' }

function introduce(language, hobby) {
  console.log(`${this.name} speaks ${language} and likes ${hobby}`)
}

introduce.apply(user, ['JavaScript', 'reading']) 
```
> .apply() ä¸ .call() åŒºåˆ«ä»…åœ¨å‚æ•°å½¢å¼ï¼Œthis æ˜¾å¼ç»‘å®šä¸º userã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|---|--|
| æµè§ˆå™¨ | 'Alice speaks JavaScript and likes reading' | 'Alice speaks JavaScript and likes reading' |
| Node.js | 'Alice speaks JavaScript and likes reading' | 'Alice speaks JavaScript and likes reading' |


**âœ… ç¤ºä¾‹ 3ï¼šbind è¿”å›æ–°å‡½æ•°å¹¶ç»‘å®š this**
```js
const user = { name: 'Later' }

function greet() {
  console.log(this.name)
}

const boundGreet = greet.bind(user)
boundGreet() // è¾“å‡ºï¼š'Later'
```
> .bind() ä¸ä¼šç«‹å³è°ƒç”¨å‡½æ•°ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ°¸ä¹…ç»‘å®šäº† this çš„æ–°å‡½æ•°ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|----|----|
| æµè§ˆå™¨ | 'Later' | 'Later' |
| Node.js | 'Later' | 'Later' |

**âš ï¸ æ³¨æ„äº‹é¡¹**
1. **call å’Œ apply æ˜¯ç«‹å³è°ƒç”¨ï¼ˆå•æ¬¡ç»‘å®šï¼‰**ï¼› 
2. **bind æ˜¯è¿”å›å‡½æ•°ï¼ˆæ°¸ä¹…ç»‘å®šï¼‰**ï¼› 
3. **æ˜¾å¼ç»‘å®šä¼˜å…ˆçº§é«˜äºéšå¼ç»‘å®šï¼**
```js
function say() {
  console.log(this.name)
}

const obj = { name: 'Tom' }
const obj2 = { name: 'Jerry', say: say }

obj2.say.call(obj)
```
> è™½ç„¶åŸæœ¬ obj2.say() æ˜¯éšå¼ç»‘å®šï¼Œä½† call(obj) æ˜¾å¼ç»‘å®šåï¼Œä»¥ obj ä¸ºå‡†ã€‚

| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼è¾“å‡º | ä¸¥æ ¼æ¨¡å¼è¾“å‡º |
|-|----|----|
| æµè§ˆå™¨ | 'Tom' | 'Tom' |
| Node.js | 'Tom' | 'Tom' |

**å°ç»“**
| æ–¹æ³•      | æ˜¯å¦ç«‹å³è°ƒç”¨    | æ˜¯å¦æ”¹å˜ this | å‚æ•°å½¢å¼     |
| ------- | --------- | --------- | -------- |
| call  | âœ… æ˜¯       | âœ… æ˜¯       | é€—å·åˆ†éš”å‚æ•°åˆ—è¡¨ |
| apply | âœ… æ˜¯       | âœ… æ˜¯       | å‚æ•°æ•°ç»„     |
| bind  | âŒ å¦ï¼ˆè¿”å›å‡½æ•°ï¼‰ | âœ… æ˜¯ï¼ˆæ°¸ä¹…ç»‘å®šï¼‰ | å‚æ•°åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ |



## è§„åˆ™å››ï¼šnew ç»‘å®š
:::info
åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°ä¸ä»…ä»…æ˜¯å¯è°ƒç”¨çš„å•ä½ï¼Œä¹Ÿå¯ä»¥è¢«**å½“ä½œæ„é€ å‡½æ•°ä½¿ç”¨**ã€‚é€šè¿‡ `new` å…³é”®å­—è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šè§¦å‘ä¸€å¥—ç‹¬ç‰¹çš„ç»‘å®šè§„åˆ™ â€”â€” **this ä¼šç»‘å®šåˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ä¸Š**ã€‚
:::

**ğŸ“Œ ä»€ä¹ˆæ˜¯ new ç»‘å®šï¼Ÿ** 

å½“æˆ‘ä»¬ä½¿ç”¨ new è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šæ‰§è¡Œå¦‚ä¸‹ 4 ä¸ªæ­¥éª¤ï¼š
> 1. åœ¨å †å†…å­˜ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç©ºå¯¹è±¡ï¼›
> 2. è¿™ä¸ªæ–°å¯¹è±¡çš„éšå¼åŸå‹ `__proto__` è¢«è¿æ¥åˆ°å‡½æ•°çš„æ˜¾å¼åŸå‹ `prototype` å±æ€§ä¸Šï¼› 
> 3. å‡½æ•°å†…éƒ¨çš„ `this` è¢«ç»‘å®šåˆ°è¿™ä¸ªæ–°å¯¹è±¡ä¸Šï¼›
> 4. æ‰§è¡Œå‡½æ•°ä½“ä»£ç ï¼Œå¦‚æœè¯¥å‡½æ•°æ²¡æœ‰æ˜¾å¼è¿”å›ä¸€ä¸ª**å¯¹è±¡ç±»å‹**ï¼ˆ**å…¶ä»–ç±»å‹æ— æ•ˆï¼Œä¼šä¾ç„¶è¿”å›éšå¼åˆ›å»ºçš„æ–°å¯¹è±¡**ï¼‰ï¼Œåˆ™éšå¼è¿”å›è¿™ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ã€‚

ä½¿ç”¨ new å…³é”®å­—æ¥è°ƒç”¨å‡½æ•°æ˜¯ä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š
```js
function Person(name) {
  console.log(this) // this æŒ‡å‘å †å†…å­˜ä¸­æ–°åˆ›å»ºçš„ç©ºå¯¹è±¡
  console.log(this == p1) // false å› ä¸ºè¿™æ—¶p1è¿˜åªæ˜¯ä¸ªundefinedï¼Œåœ¨å †å†…å­˜ä¸­æ–°åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡è¿™æ—¶è¿˜å¹¶æ²¡æœ‰èµ‹å€¼ç»™p1
  this.name = name
}

var p1  = new Person('later')
console.log(p1) // Person {name: 'later'} è¿™ä¸ªæ—¶å€™p1å·²ç»æ‹¿åˆ°åˆ›å»ºå‡ºæ¥çš„æ–°å¯¹è±¡çš„å¼•ç”¨äº†
```

**âœ… ç¤ºä¾‹ 1ï¼šåŸºç¡€æ„é€ å‡½æ•°ä½¿ç”¨**  
```js
function Person(name) {
  console.log(this) // è¾“å‡ºï¼šæ–°åˆ›å»ºçš„å¯¹è±¡
  this.name = name
}

const p1 = new Person('Later')
console.log(p1) // è¾“å‡ºï¼šPerson { name: 'Later' }
```
> - new Person() è‡ªåŠ¨å°† this æŒ‡å‘ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›
> - this.name = name ç»™æ–°å¯¹è±¡èµ‹å€¼ï¼›
> - è¿”å›æ–°å¯¹è±¡èµ‹å€¼ç»™ p1ã€‚

**â“ ä¸ºä½• this == p1 æ˜¯ falseï¼Ÿ**
```js
function Person(name) {
  console.log(this == p1) // falseï¼Œå› ä¸ºæ­¤æ—¶è¿˜æœªèµ‹å€¼ç»™ p1ï¼Œç­‰å‡½æ•°ä½“ä¸­ä»£ç æ‰§è¡Œå®Œæˆæ‰ä¼šèµ‹å€¼ç»™ p1ã€‚
  this.name = name
}
const p1 = new Person('Later')
```
> - this æŒ‡å‘æ–°åˆ›å»ºå¯¹è±¡ï¼› 
> - ä½† p1 å˜é‡ç›´åˆ°æ„é€ å‡½æ•°è¿”å›åï¼Œæ‰ä¼šæ‹¿åˆ°è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚

**âœ… ç¤ºä¾‹ 2ï¼šæ„é€ å‡½æ•°æ˜¾å¼è¿”å›å¯¹è±¡æ—¶**
```js
function Foo() {
  this.name = 'Later'
  return { name: 'Override' }
}

const obj = new Foo()
console.log(obj) // è¾“å‡ºï¼š{ name: 'Override' }
```
> - å¦‚æœæ„é€ å‡½æ•°æ˜¾å¼è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¦†ç›–é»˜è®¤è¿”å›çš„ thisï¼›
> - ä½†å¦‚æœ**è¿”å›çš„æ˜¯éå¯¹è±¡ç±»å‹**ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰ï¼Œåˆ™**å¿½ç•¥è¿”å›å€¼**ï¼š
```js
function Foo() {
  this.name = 'Later'
  return 'hello'
}

console.log(new Foo()) // è¾“å‡ºï¼šFoo { name: 'Later' }
```

**ğŸ“Š new vs æ™®é€šè°ƒç”¨å¯¹æ¯”**
| åœºæ™¯        | æ™®é€šè°ƒç”¨          | new è°ƒç”¨             |
| --------- | ------------- | -------------------- |
| this æŒ‡å‘ | å—é»˜è®¤/éšå¼/æ˜¾å¼ç»‘å®šæ§åˆ¶ | å§‹ç»ˆæŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡           |
| æ˜¯å¦åˆ›å»ºå¯¹è±¡    | âŒ å¦           | âœ… æ˜¯ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°å¯¹è±¡å¹¶ç»‘å®šåŸå‹     |
| è¿”å›å€¼å¤„ç†     | æ­£å¸¸è¿”å›          | æ˜¾å¼è¿”å›å¯¹è±¡ç±»å‹ä¼šæ›¿æ¢é»˜è®¤è¿”å›ï¼›å…¶ä»–ç±»å‹æ— æ•ˆ |



## ç‰¹æ®Šè§„åˆ™ï¼šå†…ç½®å›è°ƒä¸­çš„ this æ˜¯æ€ä¹ˆç»‘å®šçš„ï¼Ÿ
:::info
åœ¨å®é™…å¼€å‘ä¸­ï¼Œé™¤äº†æˆ‘ä»¬èƒ½ç›´æ¥æ§åˆ¶è°ƒç”¨æ–¹å¼çš„å‡½æ•°å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šâ€œä½ ä¸ä¼šç›´æ¥è°ƒç”¨ï¼Œä½†ä¼šä¼ ç»™ç³»ç»Ÿæˆ–æ¡†æ¶è°ƒç”¨â€çš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼š 
> setTimeout çš„å›è°ƒå‡½æ•°ã€DOM å…ƒç´ ä¸Šçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€forEach ç­‰æ•°ç»„æ–¹æ³•çš„å›è°ƒå‡½æ•°ã€‚

è¿™äº›å‡½æ•°çš„ this æ˜¯ç”± **JavaScript å¼•æ“æˆ–å®¿ä¸»ç¯å¢ƒå†³å®šçš„**ï¼Œä¸éµå¾ªæˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„å››å¤§è§„åˆ™ï¼Œå±äºç‰¹æ®Šç»‘å®šåœºæ™¯ã€‚
:::

**1ï¸âƒ£ é—®é¢˜ä¸€ï¼šsetTimeout å›è°ƒå‡½æ•°ä¸­çš„ this åˆ°åº•æ˜¯è°ï¼Ÿ**

â“å®é™…å¼€å‘ä¸­æˆ‘ä»¬å¸¸ä¼šå†™å‡ºè¿™æ ·çš„ä»£ç ï¼š
```js
setTimeout(function () {
  console.log(this)
}, 1000)
```
> - è¿™ä¸ªå‡½æ•°ä¸æ˜¯æˆ‘ä»¬è°ƒç”¨çš„ï¼Œè€Œæ˜¯ JS å¼•æ“åœ¨ 1000ms åè‡ªåŠ¨è°ƒç”¨çš„ï¼›   
> - æˆ‘ä»¬æ²¡æœ‰ä»»ä½•â€œè°ƒç”¨æ–¹â€ï¼Œä¹Ÿæ— æ³•æŒ‡å®šï¼›
>- é‚£ä¹ˆ this åˆ°åº•æŒ‡å‘è°ï¼Ÿ

ğŸ“‹ è¾“å‡ºç»“æœå¯¹æ¯”ï¼š
| è¿è¡Œç¯å¢ƒ    | ä¸¥æ ¼æ¨¡å¼ this    | éä¸¥æ ¼æ¨¡å¼ this   |
| ------- | ------------ | ------------ |
| æµè§ˆå™¨ | window | window |
| Node.js | Timeout å¯¹è±¡ | Timeout å¯¹è±¡ |

âœ… åŸå› è§£æï¼š
> - åœ¨æµè§ˆå™¨ä¸­ï¼Œæ— è®ºæ˜¯å¦ä¸¥æ ¼æ¨¡å¼ï¼ŒsetTimeout å›è°ƒå‡½æ•°ä¸­çš„ this ä¼šè¢«éšå¼ç»‘å®šåˆ° windowï¼›
> - åœ¨ Node.js ä¸­ï¼Œæ— è®ºæ˜¯å¦ä¸¥æ ¼æ¨¡å¼ï¼ŒsetTimeout å›è°ƒå‡½æ•°ç”± lib/timers.js ä¸­è°ƒåº¦ï¼Œthis æ˜¯ä¸€ä¸ª Timeout åŒ…è£…å¯¹è±¡ï¼›

**âœ… å®æˆ˜å»ºè®®ï¼šä½¿ç”¨ç®­å¤´å‡½æ•°è§£å†³ this ä¸¢å¤±**
```js
const obj = {
  name: 'Later',
  run() {
    setTimeout(() => {
      console.log(this.name) // 'Later'
    }, 1000)
  }
}

obj.run()
```
> - ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ thisï¼Œä¼šä»å®šä¹‰ä½ç½®å‘ä¸Šå¯»æ‰¾ï¼›
> - æ‰€ä»¥æ­¤å¤„çš„ this æ­£ç¡®ç»‘å®šåˆ° objã€‚

ğŸ“‹ è¾“å‡ºç»“æœå¯¹æ¯”ï¼š
| è¿è¡Œç¯å¢ƒ | ä¸¥æ ¼æ¨¡å¼ | éä¸¥æ ¼æ¨¡å¼ |
| ------- | ------------ | ------------ |
| æµè§ˆå™¨ | Later | Later |
| Node.js | Later | Later |

**2ï¸âƒ£ é—®é¢˜äºŒï¼šDOM äº‹ä»¶å›è°ƒä¸­çš„ this æ˜¯è°ï¼Ÿ**

â“åœ¨æµè§ˆå™¨ç½‘é¡µå¼€å‘ä¸­ï¼Œä½ æ˜¯å¦å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Ÿ
```js
btn.onclick = function () {
  console.log(this === btn) // ğŸ‘‰ true
}
```

âœ… åŸå› ï¼š
> - åœ¨æµè§ˆå™¨ä¸­ï¼Œäº‹ä»¶ç›‘å¬å™¨é‡Œçš„ this ä¼šè¢«éšå¼ç»‘å®šä¸ºè§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼›
> - å®¿ä¸»ç¯å¢ƒå¸®ä½ åšäº† this çš„ç»‘å®šã€‚

âŒ å¦‚æœä½ ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š
```js
btn.onclick = () => {
  console.log(this) // ğŸ‘‰ windowï¼ˆæˆ– undefinedï¼‰ï¼Œä¸æ˜¯ btnï¼
}
```
**ğŸ“‹ äº‹ä»¶å›è°ƒä¸­çš„ this å¯¹æ¯”ï¼š**
| å†™æ³•       | this æŒ‡å‘      | å¯æ§åˆ¶æ€§   |
| -------- | ------------ | ------ |
| function | äº‹ä»¶è§¦å‘çš„ DOM å…ƒç´  | âŒ è‡ªåŠ¨ç»‘å®š |
| ç®­å¤´å‡½æ•°     | å¤–å±‚ä½œç”¨åŸŸçš„ this  | âŒ æ— æ³•ç»‘å®š |

âœ… å®æˆ˜å»ºè®®ï¼š
> - éœ€è¦è®¿é—®å½“å‰å…ƒç´ æ—¶ï¼Œä¸€å®šä½¿ç”¨æ™®é€šå‡½æ•°ï¼› 
> - å¦‚æœä½ ä¸å…³å¿ƒ this æˆ–æƒ³ç”¨ç®­å¤´å‡½æ•°ä¿æŒä¸Šä¸‹æ–‡ï¼Œç¡®ä¿ä¸ä¼šç”¨åˆ°äº‹ä»¶æºã€‚

**3ï¸âƒ£ é—®é¢˜ä¸‰ï¼šæ•°ç»„ forEach/map ç­‰æ–¹æ³•ä¸­çš„å›è°ƒ this æ˜¯è°ï¼Ÿ**

â“ä½ å†™è¿‡ç±»ä¼¼ä»£ç å—ï¼Ÿ
```js
const list = ['a', 'b', 'c']
list.forEach(function (item) {
  console.log(this) // æ˜¯ä»€ä¹ˆï¼Ÿ
})
```
ğŸ“‹ è¾“å‡ºç»“æœå¯¹æ¯”ï¼š
| è¿è¡Œç¯å¢ƒ | éä¸¥æ ¼æ¨¡å¼ | ä¸¥æ ¼æ¨¡å¼ |
| ------- | ------------ | ------------ |
| æµè§ˆå™¨ | window | undefined |
| Node.js | globalThis | undefined |

ä½†ä½ å¯ä»¥è¿™æ ·æ˜ç¡®æŒ‡å®šï¼š
```js
const context = { name: 'Later' }

list.forEach(function (item) {
  console.log(this.name) // ğŸ‘‰ 'Later'
}, context)
```

âš ï¸ æ³¨æ„ç®­å¤´å‡½æ•°ä¸ä¼šç»‘å®š thisï¼š
```js
list.forEach(item => {
  console.log(this) // å¤–å±‚ä½œç”¨åŸŸçš„ thisï¼Œä¸ä¼šæ˜¯ context
}, { name: 'no effect' })
```

**ğŸ“‹ forEach å›è°ƒä¸­çš„ this å¯¹æ¯”ï¼š**
| å½¢å¼                  | ä¸¥æ ¼æ¨¡å¼ this   | éä¸¥æ ¼æ¨¡å¼ this                    |
| ------------------- | ----------- | ----------------------------- |
| functionï¼Œæ—  thisArg  | `undefined` | `window`ï¼ˆæµè§ˆå™¨ï¼‰æˆ– `global`ï¼ˆNodeï¼‰ |
| functionï¼Œæœ‰ thisArg  | thisArg     | thisArg                       |
| ç®­å¤´å‡½æ•°ï¼ˆä¸ç®¡æ˜¯å¦ä¼  thisArgï¼‰ | å¤–å±‚ä½œç”¨åŸŸ this  | å¤–å±‚ä½œç”¨åŸŸ this                    |

**ğŸ§  æ€»ç»“å»ºè®®ï¼š**
| åœºæ™¯                 | this ç»‘å®šè¡Œä¸º                    | æ¨èä½¿ç”¨æ–¹å¼                   |
| ------------------ | ---------------------------- | ------------------------ |
| setTimeout(fn)   | æµè§ˆå™¨ï¼šwindow<br>Nodeï¼šTimeoutå¯¹è±¡ | ä½¿ç”¨ç®­å¤´å‡½æ•°ç»§æ‰¿å¤–éƒ¨ this          |
| DOM äº‹ä»¶ï¼ˆfunctionï¼‰   | this === äº‹ä»¶æºå…ƒç´                | ä¿ç•™æ™®é€šå‡½æ•°è¯­æ³•                 |
| DOM äº‹ä»¶ï¼ˆç®­å¤´ï¼‰         | this === å¤–å±‚ä½œç”¨åŸŸ               | ä¸å»ºè®®ç”¨äºæ“ä½œå½“å‰å…ƒç´               |
| forEach(fn, ctx) | ctx æˆ–é»˜è®¤è§„åˆ™                    | ç”¨ function + thisArg æœ€ç¨³å¦¥ |
| forEach(arrow)   | this ä¸ºå¤–å±‚ä½œç”¨åŸŸ                  | æ¨èç”¨äºæ—  this æ“ä½œçš„ç®€æ´åœºæ™¯       |



# äºŒ. apply / call / bind

::: info ğŸš©å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜
åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›æŸä¸ªå‡½æ•°â€œå±äºå¯¹è±¡â€ï¼Œä½†åˆæƒ³ä¸´æ—¶æŠŠå®ƒçš„ this æŒ‡å‘æŸä¸ªå¯¹è±¡ã€‚  
ç­”æ¡ˆæ˜¯ï¼šä½¿ç”¨ JavaScript ä¸ºå‡½æ•°æä¾›çš„ 3 ä¸ªå·¥å…·æ–¹æ³•ï¼š call()ã€apply()ã€bind()ã€‚
:::
ä¾‹å¦‚ï¼š
```js
function printInfo() {
  console.log(this.name)
}

const user = { name: 'Later' }

printInfo()         // âŒ this æ˜¯ window æˆ– undefined
user.printInfo = printInfo
user.printInfo()    // âœ… this æ˜¯ user
```
> ä½†æˆ‘å…¶å®å¹¶ä¸æƒ³å†™ user.printInfo = printInfo è¿™æ ·å¤šä½™çš„èµ‹å€¼ï¼Œæˆ‘åªæƒ³ä¸´æ—¶æŒ‡å®š thisï¼Œå°±åƒä¸‹é¢è¿™æ ·ç›´æ¥è°ƒç”¨ï¼š
```js
printInfo.call(user)
```
> äºæ˜¯æˆ‘ä»¬å°±éœ€è¦ JavaScript æä¾›çš„ä¸‰ä¸ªå·¥å…·å‡½æ•°ï¼šcall / apply / bind â€”â€” å®ƒä»¬éƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š 
> ğŸ§­ â€œå¦‚ä½•åœ¨ä¸æ”¹å˜å‡½æ•°å®šä¹‰ä½ç½®çš„å‰æä¸‹ï¼Œæ§åˆ¶ this çš„ç»‘å®šï¼Ÿâ€

**1ï¸âƒ£ æ˜¾å¼ç»‘å®šï¼šä½¿ç”¨ call() / apply()**

è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½èƒ½åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ˜¾å¼æŒ‡å®š thisã€‚

è¯­æ³•åŒºåˆ«ï¼š
```js
func.call(thisArg, arg1, arg2, ...)
func.apply(thisArg, [arg1, arg2, ...])
```
> - ç¬¬ä¸€ä¸ªå‚æ•° thisArgï¼šè¦ç»‘å®šçš„ this å¯¹è±¡ï¼›
> - å…¶ä»–å‚æ•°ï¼šå‡½æ•°çš„å®å‚ï¼ˆcall ç”¨å‚æ•°åˆ—è¡¨ä¼ å…¥ã€apply ç”¨æ•°ç»„ä¼ å…¥ï¼‰ï¼›
> - éƒ½æ˜¯ç«‹å³æ‰§è¡Œã€‚

**ğŸ§ª æ¡ˆä¾‹ä¸€ï¼šcall/apply ç»‘å®š this**
```js
function bar() {
  console.log(this)
}

bar.call({ name: 'later' }) // output: { name: 'later' }
bar.call(123)               // output: Numberå¯¹è±¡ï¼ŒåŒ…è£…123
```
> - bar() æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œé»˜è®¤ç»‘å®šè§„åˆ™ä¸‹ä¼šæŒ‡å‘ windowï¼ˆéä¸¥æ ¼ï¼‰ï¼›
> - ä½†é€šè¿‡ call()ï¼Œæˆ‘ä»¬å¼ºåˆ¶å°† this æŒ‡å‘ä¼ å…¥çš„å¯¹è±¡ï¼›
> - å³ä½¿ä¼ å…¥çš„æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œä¹Ÿä¼šè‡ªåŠ¨è¢«åŒ…è£…æˆå¯¹è±¡ï¼ˆå¦‚ 123 â†’ new Number(123)ï¼‰ã€‚

**ğŸ§ª æ¡ˆä¾‹äºŒï¼šä¼ é€’å‚æ•°**
```js
function foo(name, age, height) {
  console.log("fooå‡½æ•°è¢«è°ƒç”¨:", this)
  console.log("æ‰“å°å‚æ•°:", name, age, height)
}

// apply: å‚æ•°ä½œä¸ºæ•°ç»„ä¼ å…¥
foo.apply("apply", ["kobe", 30, 1.98])

// call: å‚æ•°ä»¥é€—å·åˆ†éš”
foo.call("call", "james", 25, 2.05)
```

**ğŸ§ª ç¤ºä¾‹ä¸‰ï¼šç»‘å®šåŸå§‹ç±»å‹æˆ– null/undefined**
```js
function show() {
  console.log(this)
}

show.call(123)        // Number åŒ…è£…å¯¹è±¡
show.call('abc')      // String åŒ…è£…å¯¹è±¡
show.call(null)       // é»˜è®¤ç»‘å®šè§„åˆ™ç”Ÿæ•ˆ
show.call(undefined)  // åŒä¸Š
```

ğŸ“‹ è¿è¡Œç¯å¢ƒå·®å¼‚è¡¨ï¼š
| thisArg | æµè§ˆå™¨ éä¸¥æ ¼ | æµè§ˆå™¨ ä¸¥æ ¼ | Node éä¸¥æ ¼   | Node ä¸¥æ ¼ |
| ------- | ---------- | ----------- | ---------- | ---------- |
| 123       | `Number {123}` | 123  | `[String: 'abc']` | 123  |
| 'abc'     | `String {'abc'}` | 'abc'  | `[Number: 123]` | 'abc' |
| null      | window   | null      | global   | null      |
| undefined | window   | undefined | global   | undefined |

::: info å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªå‡½æ•°æ€»æ˜¯æ˜¾å¼çš„ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œå¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ
ä½¿ç”¨ bind
:::
**2ï¸âƒ£ bindï¼šä¸æ‰§è¡Œå‡½æ•°ï¼Œåªè¿”å›ä¸€ä¸ªâ€œæ°¸ä¹…ç»‘å®šäº† this çš„æ–°å‡½æ•°â€**

ğŸ“˜ åŸºæœ¬è¯­æ³•ï¼š
```js
const newFn = fn.bind(thisArg, preset1, preset2, ...)
```
> - ä¸ä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œæ˜¯**è¿”å›ä¸€ä¸ªæ–°çš„ç»‘å®šäº† this çš„å‡½æ•°ï¼ˆBound Functionï¼ŒBFï¼‰**;
> - ç»‘å®šå‡½æ•°æ˜¯ä¸€ä¸ª` exotic function object`ï¼ˆ**æ€ªå¼‚å‡½æ•°å¯¹è±¡**ï¼Œ`es6 `ä¸­çš„æœ¯è¯­ï¼‰
> - å¯â€œé¢„è®¾â€éƒ¨åˆ†å‚æ•°ï¼ˆç±»ä¼¼æŸ¯é‡ŒåŒ–ï¼‰ï¼Œè°ƒç”¨æ—¶è‡ªåŠ¨å¡«å……ã€‚bind çš„å¦ä¸€ä¸ªæœ€ç®€å•çš„ç”¨æ³•æ˜¯ä½¿ä¸€ä¸ªå‡½æ•°æ‹¥æœ‰é¢„è®¾çš„åˆå§‹å‚æ•°ï¼š**bind æ–¹æ³•ä¸­ä¼ å…¥çš„é™¤ thisArg ä¹‹å¤–çš„å…¶ä½™å‚æ•°ï¼Œä¼šä½œä¸ºè¿”å›çš„æ–°å‡½æ•°çš„åˆå§‹å‚æ•°ï¼Œè€Œæ–°å‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ä¼šæ’åœ¨è¿™äº›åˆå§‹ï¼ˆé¢„è®¾ï¼‰å‚æ•°ä¹‹å**ã€‚

**ğŸ§ª ç¤ºä¾‹ï¼šå»¶è¿Ÿè°ƒç”¨ + é¢„è®¾å‚æ•°**
```js
function add(a, b, c) {
  console.log(this.name, a, b, c)
}

const obj = { name: 'Later' }

const boundFn = add.bind(obj, 1) // é¢„è®¾å‚æ•°
boundFn(2, 3)  // Later 1 2 3
```
> bind(obj, 1)ï¼šè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè°ƒç”¨å®ƒæ—¶ this æ°¸è¿œæ˜¯ objï¼Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°å§‹ç»ˆæ˜¯ 1ã€‚

**âš ï¸ bind å‡½æ•°çš„ this æ˜¯ä¸å¯å†æ›´æ”¹çš„**
```js
const boundFn = foo.bind({ name: 'A' })
boundFn.call({ name: 'B' }) // ä»ç„¶è¾“å‡º Aï¼Œä¸æ˜¯ B
```
> ä¸€æ—¦ bind ç»‘å®šäº† thisï¼Œå°±æ— æ³•é€šè¿‡ call/apply å†æ¬¡ä¿®æ”¹ã€‚

**3ï¸âƒ£ âš ï¸ ç®­å¤´å‡½æ•°ä¸æ”¯æŒ call / apply / bind ç»‘å®š this**
> ç”±äºç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ this æŒ‡é’ˆï¼Œé€šè¿‡ call() æˆ– apply() æ–¹æ³•è°ƒç”¨ä¸€ä¸ªç®­å¤´å‡½æ•°æ—¶ï¼Œåªèƒ½ä¼ é€’å‚æ•°ï¼ˆä¸èƒ½ç»‘å®š thisï¼‰ï¼Œä»–ä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å¿½ç•¥ã€‚ï¼ˆè¿™ç§ç°è±¡å¯¹äº bind æ–¹æ³•åŒæ ·æˆç«‹ï¼‰

ä¾‹å¦‚ï¼š
```js
var adder = {
  base: 1,
  add: function(a) {
    var f = v => v + this.base
    return f(a)
  },
  addThruCall: function(a) {
    var f = v => v + this.base
    var b = { base: 2 }
    return f.call(b, a) // call æ— æ•ˆ
  }
}

console.log(adder.add(1))         // è¾“å‡º 2
console.log(adder.addThruCall(1)) // ä»ç„¶è¾“å‡º 2
```
> f æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œthis åªèƒ½ä»å®šä¹‰æ—¶å¤–å±‚ä½œç”¨åŸŸæ•è·ï¼Œcall(b) æ— æ•ˆï¼

**âœ… æ€»ç»“ & å¯¹æ¯”è¡¨**
| æ–¹æ³• | æ˜¯å¦ç«‹å³è°ƒç”¨ | è¿”å›æ–°å‡½æ•°ï¼Ÿ | å‚æ•°å½¢å¼      | æ˜¯å¦èƒ½ç»‘å®š this | ç®­å¤´å‡½æ•°ç”Ÿæ•ˆï¼Ÿ |
| ----- | ------ | ------ | --------- | ---------- | ------- |
| call  | âœ…      | âŒ      | å‚æ•°åˆ—è¡¨      | âœ…          | âŒï¼ˆæ— æ•ˆï¼‰   |
| apply | âœ…      | âŒ      | å‚æ•°æ•°ç»„      | âœ…          | âŒï¼ˆæ— æ•ˆï¼‰   |
| bind  | âŒ      | âœ…      | å‚æ•°é¢„è®¾+è°ƒç”¨è¿½åŠ  | âœ…ï¼ˆä¸”ä¸å¯è¢«æ”¹ï¼‰   | âŒï¼ˆæ— æ•ˆï¼‰   |

**ğŸ¯ å®æˆ˜ä½¿ç”¨å»ºè®®**
| éœ€æ±‚åœºæ™¯ | æ¨èæ–¹æ³• |
| ---------------- | ------------ |
| ç«‹å³æ‰§è¡Œ + æŒ‡å®š this          | call æˆ– apply |
| å»¶è¿Ÿæ‰§è¡Œ + this æ°¸ä¹…ç»‘å®š       | bind  |
| æƒ³ä¿®æ”¹ç®­å¤´å‡½æ•°çš„ thisï¼ˆåˆ«æƒ³äº†ï¼‰  | ä¸å¯èƒ½ |
| è¦å…¼å®¹æ•°ç»„å‚æ•°ï¼ˆå¦‚ from applyï¼‰ | apply |



# ä¸‰. this çš„ç»‘å®šä¼˜å…ˆçº§
:::info
å­¦ä¹ äº†å››æ¡è§„åˆ™ï¼Œæ¥ä¸‹æ¥å¼€å‘ä¸­æˆ‘ä»¬åªéœ€è¦å»æŸ¥æ‰¾å‡½æ•°çš„è°ƒç”¨åº”ç”¨äº†å“ªæ¡è§„åˆ™å³å¯ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå‡½æ•°è°ƒç”¨ä½ç½®åº”ç”¨äº†å¤šæ¡è§„åˆ™ï¼Œä¼˜å…ˆçº§è°æ›´é«˜å‘¢ï¼Ÿ
:::

**1ï¸âƒ£ é»˜è®¤ç»‘å®šä¼˜å…ˆçº§æœ€ä½**
> æ¯«æ— ç–‘é—®ï¼Œé»˜è®¤è§„åˆ™çš„ä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œä¸€æ—¦å­˜åœ¨å…¶ä»–è§„åˆ™ï¼Œé»˜è®¤ç»‘å®šä¼šè¢«å®Œå…¨è¦†ç›–ã€‚
```js
function foo() {
  console.log(this)
}

foo() // é»˜è®¤ç»‘å®šï¼šæµè§ˆå™¨ä¸­ this -> window
foo.call({ name: 'later' }) // æ˜¾å¼ç»‘å®šï¼Œthis -> { name: 'later' }
```

**2ï¸âƒ£ æ˜¾å¼ç»‘å®š > éšå¼ç»‘å®š**
> å½“éšå¼ç»‘å®šä¸ call/apply æ˜¾å¼ç»‘å®šå†²çªæ—¶ï¼Œæ˜¾å¼ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ã€‚
```js
var obj = {
  foo: function() {
    console.log(this)
  }
}

obj.foo.call('haha') // outputï¼šString {'haha'}
```
:::details åˆ†æ
> - æœ¬æ¥è°ƒç”¨çš„æ˜¯ obj.fooï¼ŒæŒ‰éšå¼ç»‘å®šåº”ä¸º objï¼›
> - ä½† call('haha') æ˜ç¡®æŒ‡å®šäº† thisï¼›
> - æ‰€ä»¥ this æŒ‡å‘ 'haha' è¢«åŒ…è£…çš„å¯¹è±¡ã€‚
:::

**3ï¸âƒ£ bind > call/apply**
> bind æ˜¯â€œæ°¸ä¹…ç»‘å®šâ€ï¼Œä¼˜å…ˆçº§æ¯” call/apply æ›´é«˜ã€‚
```js
function func() { console.log(this) }

var func2 = func.bind('haha')

func2.call('hehe')   // outputï¼šString {'haha'}
func2.apply('hehe')  // outputï¼šString {'haha'}
```
:::details
> - bind('haha') è¿”å›äº†ä¸€ä¸ªæ–°å‡½æ•°ï¼›
> - åç»­è°ƒç”¨ call('hehe') æ˜¯ä½œç”¨åœ¨è¿™ä¸ªç»‘å®šè¿‡çš„å‡½æ•°ä¸Šï¼Œæ— æ³•ä¿®æ”¹ thisï¼›
> - æ‰€ä»¥æœ€ç»ˆè¾“å‡ºä»ç„¶æ˜¯ 'haha'ã€‚
:::

**4ï¸âƒ£ new ç»‘å®šä¼˜å…ˆçº§æœ€é«˜**
> - new æ˜¯å”¯ä¸€å¯ä»¥â€œå®Œå…¨å¿½ç•¥ bind çš„ç»‘å®šâ€çš„è§„åˆ™ï¼›
> - ä¸€æ—¦ç”¨äº† newï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°æ˜¯ bind è¿‡çš„ï¼Œä¹Ÿä¼šä»¥æ„é€ æ–¹å¼ä¼˜å…ˆæ‰§è¡Œã€‚
```js
function func() {
  console.log(this)
}

var func2 = func.bind('haha')

new func2() // this -> æ–°åˆ›å»ºçš„å¯¹è±¡
```
::: details
> - func2 æ˜¯ç»‘å®šäº† 'haha' çš„å‡½æ•°ï¼›
> - ä½† new çš„ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶å°† this ç»‘å®šåˆ°æ–°å¯¹è±¡ï¼›
> - æ‰€ä»¥ this æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ã€‚
:::

:::warning âš ï¸ æ³¨æ„
new å’Œ call / apply æ˜¯ä¸èƒ½ä¸€èµ·ä½¿ç”¨çš„ï¼Œä½ ä¸èƒ½è¿™æ ·å†™ï¼š`new func.call(obj)`ï¼Œè¿™æ˜¯æ— æ„ä¹‰çš„è¡¨è¾¾å¼ï¼Œ ä½†å¯ä»¥ `new (func.bind(obj))()`ï¼Œè¿™æ—¶ new ä¼˜å…ˆçº§ä»ç„¶æœ€é«˜ã€‚
:::

**âœ… æ€»ç»“ï¼šç»‘å®šä¼˜å…ˆçº§ä»ä½åˆ°é«˜å¦‚ä¸‹**
| ä¼˜å…ˆçº§(ä¾æ¬¡é€’å¢) | ç»‘å®šæ–¹å¼     | è¯´æ˜                         |
| --- | -------- | -------------------------- |
| 1   | é»˜è®¤ç»‘å®š     | æ— è°ƒç”¨å¯¹è±¡ã€æ—  call/apply/new æ—¶ç”Ÿæ•ˆ |
| 2   | éšå¼ç»‘å®š     | é€šè¿‡å¯¹è±¡è°ƒç”¨å‡½æ•°ï¼šobj.fn()          |
| 3   | æ˜¾å¼ç»‘å®š     | call/apply å¼ºåˆ¶æŒ‡å®š this       |
| 4   | bind ç»‘å®š  | bind è¿”å›æ°¸ä¹…ç»‘å®š this çš„æ–°å‡½æ•°      |
| 5   | new æ„é€ ç»‘å®š | åˆ›å»ºæ–°å¯¹è±¡å¹¶ç»‘å®š thisï¼Œ**ä¼˜å…ˆçº§æœ€é«˜**    |



# å››. è§„åˆ™ä¹‹å¤–çš„ç‰¹æ®Šæƒ…å†µ

:::info
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº† this çš„å››å¤§ç»‘å®šè§„åˆ™ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¼˜å…ˆçº§ã€‚

ä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿˜æœ‰ä¸€äº›â€œè¾¹ç¼˜åœºæ™¯â€ï¼Œå®ƒä»¬çš„è¡Œä¸ºçœ‹ä¼¼è¿åè§„åˆ™ï¼Œä½†å…¶å®æœ‰åˆç†è§£é‡Š â€”â€” æœ¬èŠ‚æˆ‘ä»¬å°±æ¥æ­ç¤ºè¿™äº›â€œè§„åˆ™ä¹‹å¤–â€çš„ this ç»‘å®šé™·é˜±ã€‚
:::



## æƒ…å†µä¸€ï¼šå¿½ç•¥æ˜¾å¼ç»‘å®šï¼ˆä¼ å…¥ null / undefinedï¼‰

```js
function foo() { console.log(this) }

foo.call({}) 
foo.call('abc')               
foo.call(123)               
foo.call(null)           
foo.call(undefined) 
```

ğŸ“‹ è¿è¡Œç¯å¢ƒå·®å¼‚è¡¨ï¼š
| ç»‘å®šå€¼       | éä¸¥æ ¼æ¨¡å¼ thisï¼ˆwindow/node.jsï¼‰| ä¸¥æ ¼æ¨¡å¼ thisï¼ˆwindow/node.jsï¼‰|
| ----------- | ----------- | ----------- |
| `{}`        | {} | {} |
| `'abc'`     | String {'abc'} / [String: 'abc'] | 'abc' |
| `123`       | Number {123} / [Number: 123] | 123 |
| `null`      | window / global | null |
| `undefined` | window / global | undefined |

â“å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
ä½ å¯èƒ½ä»¥ä¸ºï¼š
> â€œcall æ˜¯æ˜¾å¼ç»‘å®šå•Šï¼Œæˆ‘ä¼ äº† nullï¼Œthis ä¸å°±è¯¥æ˜¯ null å—ï¼Ÿâ€

å…¶å®ï¼š  
> éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼š
>   - å¦‚æœä¼ å…¥çš„æ˜¯**å€¼ç±»å‹**ï¼ˆnull å’Œ undefinedé™¤å¤–ï¼‰ï¼ŒJS ä¼šè‡ªåŠ¨å°†å…¶**è£…ç®±**æˆå¯¹åº”çš„å¯¹è±¡ï¼›
>   - å¦‚æœä¼ å…¥çš„æ˜¯ **null æˆ– undefined**ï¼Œå› ä¸ºæ²¡æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼Œåˆ™è§†ä¸ºæ²¡æœ‰ç»‘å®š thisï¼Œä¼š**å›é€€ä¸ºé»˜è®¤ç»‘å®šè§„åˆ™**ï¼›
>   - å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œthisç»‘å®šçš„å°±æ˜¯è¯¥å¯¹è±¡ã€‚
> 
> ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼š
>   - ä¼ ä»€ä¹ˆï¼Œç»‘å®šçš„thiså°±æ˜¯ä»€ä¹ˆã€‚

ğŸ”„ bind(null) çš„æƒ…å†µä¹Ÿä¸€æ ·ï¼š
```js
function foo() { console.log(this) }

foo.bind(null)() // éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œfallbackåˆ°é»˜è®¤ç»‘å®š
foo.bind(undefined)()
```
ğŸ“‹ è¿è¡Œç¯å¢ƒå·®å¼‚è¡¨ï¼š
|   ç¯å¢ƒ  | éä¸¥æ ¼æ¨¡å¼ this | ä¸¥æ ¼æ¨¡å¼this |
| ------- | ------ | ---- |
| Window  | window å¯¹è±¡ | null / undefined |
| Node.js | global å¯¹è±¡ | null / undefined |
> è™½ç„¶ bind çœ‹ä¼¼æ˜¾å¼ç»‘å®šäº† nullï¼Œä½†å†…éƒ¨ä»ç„¶è§¦å‘ fallbackï¼›  
> bar æ‰§è¡Œæ—¶å®é™…ç­‰ä»·äºä¸€ä¸ªç‹¬ç«‹å‡½æ•°è°ƒç”¨ã€‚



## æƒ…å†µäºŒï¼šé—´æ¥å‡½æ•°å¼•ç”¨ï¼ˆèµ‹å€¼è§¦å‘é»˜è®¤ç»‘å®šï¼‰
```js
function foo() { console.log(this) }

var obj1 = {
  name: 'obj1',
  foo: foo
}

var obj2 = {
  name: 'obj2'
}

obj1.foo()                   // è¾“å‡ºï¼šobj1ï¼ˆéšå¼ç»‘å®šï¼‰
;(obj2.foo = obj1.foo)()     // è¾“å‡ºï¼šwindow æˆ– undefined
```
â“å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬å…ˆæ¥çœ‹å³ä¾§è¿™ä¸ªè°ƒç”¨è¡¨è¾¾å¼ï¼š
```js
(obj2.foo = obj1.foo)()
// åœ†æ‹¬å·ä¼šå½“æˆä¸€ä¸ªè¡¨è¾¾å¼å»è§£æï¼Œ
// è€Œè¯¥è¡¨è¾¾å¼å†…éƒ¨åœ¨èµ‹å€¼çš„åŒæ—¶ï¼Œä¹Ÿä¼šè¿”å›è¡¨è¾¾å¼å³ä¾§çš„å€¼(å³obj1ä¸­çš„fooå±æ€§æ‰€æŒ‡å‘çš„å‡½æ•°)ï¼Œ
// æ‰€ä»¥è¿™é‡Œæ˜¯ä¼šå½“æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨
```
æ‹†è§£è¿‡ç¨‹å¦‚ä¸‹ï¼š
> 1. obj2.foo = obj1.foo æ˜¯ä¸€ä¸ªèµ‹å€¼è¡¨è¾¾å¼ï¼›
> 2. è¡¨è¾¾å¼è¿”å›çš„æ˜¯å€¼ï¼ˆå³å‡½æ•°ï¼‰ï¼Œæ˜¯å³è¾¹çš„å‡½æ•° foo æœ¬èº«ï¼Œå¹¶éç»‘å®šè¡Œä¸ºï¼›
> 3. æ•´ä¸ªè¯­å¥å…¶å®æ˜¯ (å‡½æ•°å¯¹è±¡)()ï¼Œè€Œä¸æ˜¯é€šè¿‡ obj2.foo() å½¢å¼è°ƒç”¨ï¼Œå®é™…è°ƒç”¨çš„æ˜¯â€œç»“æœâ€ï¼Œè€Œä¸æ˜¯è·¯å¾„ï¼›
> 4. æ‰€ä»¥è°ƒç”¨ä½ç½®æ²¡æœ‰ç»‘å®šå¯¹è±¡ â€”â€” å±äºç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼›
> 5. æœ€ç»ˆè§¦å‘çš„æ˜¯é»˜è®¤ç»‘å®šã€‚



## æƒ…å†µä¸‰ï¼šç®­å¤´å‡½æ•°ä¸ç»‘å®š thisï¼ˆåªæ•è·å¤–å±‚ä½œç”¨åŸŸï¼‰
**ğŸ§ª æ¡ˆä¾‹ï¼šæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚**
>  è¿™é‡Œä½¿ç”¨ setTimeout æ¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚åˆ°æ•°æ®åæ€ä¹ˆå­˜æ”¾åˆ° data ä¸­å‘¢ï¼Ÿ  
> æˆ‘ä»¬éœ€è¦æ‹¿åˆ° obj å¯¹è±¡ï¼Œè®¾ç½® data;  
> ä½†æ˜¯ç›´æ¥æ‹¿åˆ°çš„ this æ˜¯ windowï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤–å±‚å®šä¹‰ï¼š`var _this = this`;  
> åœ¨ setTimeout çš„å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨ _this å°±ä»£è¡¨äº† obj å¯¹è±¡;
```js
var obj = {
  data: [],
  fetchData() {
    var _this = this
    setTimeout(function() {
      var res = ['abc', 'cba'] // æ¨¡æ‹Ÿè·å–åˆ°çš„æ•°æ®
      _this.data.push(...res)
    }, 1000)
  }
}

obj.fetchData()
```
åˆ†æï¼š
> å½“é€šè¿‡ obj.fetchData è°ƒç”¨å‡½æ•°æ—¶ï¼ŒfetchData å‡½æ•°å†…éƒ¨çš„ this ç»‘å®šåˆ°äº† obj å¯¹è±¡ï¼Œ  
> å½“æ‰§è¡Œ setTimeout ä¸­çš„å›è°ƒå‡½æ•°æ—¶ï¼Œå…¶ä¸­çš„ this æ˜¯æŒ‡å‘ window çš„ï¼Œ  
> å› ä¸º setTimeout ä¸­çš„å‡½æ•°æ˜¯æ˜¾å¼ç»‘å®šåˆ° window èº«ä¸Šçš„ï¼Œæ‰€ä»¥å…¶å†…éƒ¨çš„å›è°ƒå‡½æ•°ä¸­ this æŒ‡å‘çš„å°±æ˜¯ window äº†ï¼Œ  
> æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª fetchData å‡½æ•°å†…éƒ¨çš„å˜é‡ _this æŒ‡å‘å‡½æ•°å†…éƒ¨çš„ thisï¼Œ  
> å½“æˆ‘ä»¬ä½¿ç”¨ _this å˜é‡ï¼Œä¼šå¾€ä¸Šå±‚ä½œç”¨åŸŸä¸€å±‚ä¸€å±‚å¾€æŸ¥æ‰¾è¯¥å˜é‡ï¼Œ  
> æœ€ååœ¨ä¸Šå±‚å‡½æ•°ä½œç”¨åŸŸä¸­æ‰¾åˆ° _this å˜é‡

âœ… ä½¿ç”¨ç®­å¤´å‡½æ•°ç»§æ‰¿ thisï¼š
```js
var obj = {
  data: [],
  fetchData() {
    setTimeout(() => {
      var res = ['abc', 'cba']
      this.data.push(...res) // this æ­£ç¡®æŒ‡å‘ obj
    }, 1000)
  }
}

obj.fetchData()
```
> ç®­å¤´å‡½æ•°åœ¨å®šä¹‰æ—¶å°±ä¼šæ•è·å¤–å±‚ thisï¼›  
> æ— æ³•è¢« call/apply/bind ä¿®æ”¹ï¼›  
> éå¸¸é€‚åˆå†™åœ¨å›è°ƒã€äº‹ä»¶å¤„ç†ç­‰ this å®¹æ˜“ä¸¢å¤±çš„åœ°æ–¹ã€‚

âœ… å°ç»“ï¼šè§„åˆ™ä¹‹å¤–çš„ this è¡Œä¸º
| æƒ…å†µ | åŸå› è¯´æ˜ | this ç»“æœ(Window / Node.js) |
| - | - | - |
| call/apply ç»‘å®š null | JS å†…éƒ¨ fallback ä¸ºé»˜è®¤ç»‘å®š | window / Global |
| èµ‹å€¼è¿”å›å‡½æ•°æ‰§è¡Œ | è¡¨è¾¾å¼ç»“æœæ˜¯å‡½æ•° â†’ ç‹¬ç«‹è°ƒç”¨ â†’ é»˜è®¤ç»‘å®š | window / undefined |
| ç®­å¤´å‡½æ•° | å®šä¹‰æ—¶æ•è·å¤–å±‚ä½œç”¨åŸŸï¼Œæ— æ³•å†ä¿®æ”¹ | å¤–å±‚ thisï¼ˆä¸å¯è¢«æ”¹ï¼‰|



# äº”. ç®­å¤´å‡½æ•°çš„ä½¿ç”¨


## ä¸ºä»€ä¹ˆå¼•å…¥ç®­å¤´å‡½æ•°ï¼Ÿ
åœ¨ ES5 æ—¶ä»£ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨å‡½æ•°å£°æ˜æˆ–å‡½æ•°è¡¨è¾¾å¼æ¥å®šä¹‰å‡½æ•°ï¼š
```js
// å‡½æ•°å£°æ˜
function add(x, y) {
  return x + y
}

// å‡½æ•°è¡¨è¾¾å¼
var square = function(n) {
  return n * n
}
```
è¿™äº›å†™æ³•è™½ç„¶è¯­ä¹‰æ¸…æ™°ï¼Œä½†åœ¨å›è°ƒå‡½æ•°ã€é“¾å¼å¤„ç†ç­‰åœºæ™¯ä¸­å†™èµ·æ¥è¾ƒå†—é•¿ã€‚

äºæ˜¯ï¼ŒES6 å¼•å…¥äº†ç®­å¤´å‡½æ•°ï¼ˆArrow Functionï¼‰ä½œä¸ºä¸€ç§æ›´ç®€æ´çš„å‡½æ•°è¡¨è¾¾å½¢å¼ã€‚

## åŸºæœ¬è¯­æ³•
ç®­å¤´å‡½æ•°å¦‚ä½•ç¼–å†™å‘¢ï¼Ÿ
> ()ï¼šå‡½æ•°çš„å‚æ•°ã€{}ï¼šå‡½æ•°çš„æ‰§è¡Œä½“
```js
// æ™®é€šå‡½æ•°è¡¨è¾¾å¼
var greet = function(name) {
  return 'Hello, ' + name
}

// ç®­å¤´å‡½æ•°å†™æ³•
var greet = (name) => {
  return 'Hello, ' + name
}
```

## è¯­æ³•ä¼˜åŒ–
ä¼˜åŒ–1ï¸âƒ£ï¼šå¦‚æœ**åªæœ‰ä¸€ä¸ªå½¢å‚å¯ä»¥çœç•¥ ()**ã€‚
```js
// ä¼˜åŒ–å‰
const greet = (name) => {
  return `hello ${name}`
}

// ä¼˜åŒ–å
const greet = name => {
  return `hello ${name}`
}
```

ä¼˜åŒ–2ï¸âƒ£ï¼šå¦‚æœå‡½æ•°æ‰§è¡Œä½“ä¸­ï¼Œ**åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥çœç•¥å‡½æ•°ä½“çš„å¤§æ‹¬å·ï¼Œä¼šè‡ªåŠ¨è¿”å›è¯¥è¡Œä»£ç çš„è¿”å›å€¼**ï¼ˆreturn è¯­å¥é™¤å¤–ï¼‰ã€‚
> å¦‚æœå‡½æ•°ä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç ï¼Œä½†è¯¥ä»£ç æ˜¯ return è¯­å¥æ—¶ï¼Œæƒ³çœç•¥å¤§æ‹¬å·çš„è¯ï¼Œéœ€è¦å»æ‰ return å…³é”®è¯ï¼Œè¿™æ ·è¯¥è¡Œä»£ç çš„è¿”å›å€¼ä¼šä½œä¸ºæ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼ã€‚ 
```js
// ä¼˜åŒ–å‰
nums.map((n) => {
  return n * 2
})

// ä¼˜åŒ–å
nums.map((n) => n * 2)
```

ä¼˜åŒ–3ï¸âƒ£ï¼šå¦‚æœå‡½æ•°æ‰§è¡Œä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç ï¼Œä¸”è¯¥è¡Œä»£ç **è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡ï¼Œæƒ³çœç•¥å¤§æ‹¬å·çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€ç”¨å°æ‹¬å·åŒ…è£¹è¿™ä¸ªå¯¹è±¡å­—é¢é‡**ã€‚
> å¦‚æœä¸ç”¨å°æ‹¬å·åŒ…è£¹çš„è¯ï¼Œ JavaScript å¼•æ“ä¼šæŠŠå¯¹è±¡å­—é¢é‡çš„å¤§æ‹¬å· `{}` è§£ææˆå‡½æ•°çš„æ‰§è¡Œä½“çš„ä»£ç å— `{}`ã€‚
```js
// ä¼˜åŒ–å‰
const foo = () => {
  return { name: 'foo' }
}

// é”™è¯¯ ğŸ™…
var foo = () => { name: 'foo' }

// æ­£ç¡® âœ…
var foo = () => ({ name: 'foo' })
```
**ç¤ºä¾‹å¯¹æ¯”ï¼šæ•°ç»„å¤„ç†ä¸­çš„ç®€åŒ–**
```js
var nums = [1, 2, 3, 4]

// æ™®é€šå‡½æ•°
var double1 = nums.map(function(n) {
  return n * 2
})

// ç®­å¤´å‡½æ•°
var double2 = nums.map(n => n * 2)
```
ç®­å¤´å‡½æ•°åœ¨è¿™äº›åœºæ™¯ä¸­æå¤§æå‡äº†ä»£ç çš„å¯è¯»æ€§ä¸ç®€æ´åº¦ã€‚



## ä¸ºä»€ä¹ˆç®­å¤´å‡½æ•°çš„ this è¦å•ç‹¬è®²ï¼Ÿ

åœ¨ä¼ ç»Ÿå‡½æ•°ä¸­ï¼Œthis çš„æŒ‡å‘æ˜¯åŠ¨æ€çš„ â€”â€” å®ƒå–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€ä¸Šä¸‹æ–‡ã€æ˜¾å¼ç»‘å®šç­‰ï¼š
```js
function foo() {
  console.log(this)
}
const obj = { foo }

foo()         // é»˜è®¤ç»‘å®š
obj.foo()     // éšå¼ç»‘å®š
foo.call(123) // æ˜¾å¼ç»‘å®š
new foo()     // new ç»‘å®š
```
ğŸ“‹ ä¸åŒç¯å¢ƒè¾“å‡ºå·®å¼‚ï¼š
| è°ƒç”¨æ–¹å¼ | æµè§ˆå™¨ éä¸¥æ ¼ | æµè§ˆå™¨ ä¸¥æ ¼ | Node éä¸¥æ ¼   | Node ä¸¥æ ¼ |
| --- | ---------- | ----------- | ---------- | ---------- |
| foo() | window | undefined | Global å¯¹è±¡ | undefined  |
| obj.foo() | obj å¯¹è±¡ | obj å¯¹è±¡ | obj å¯¹è±¡ | obj å¯¹è±¡ |
| foo.call(123) | `Number {123}` | 123 | [Number: 123] | 123 |
| new foo() | æ–°å®ä¾‹ | æ–°å®ä¾‹ | æ–°å®ä¾‹ | æ–°å®ä¾‹ |

è€Œç®­å¤´å‡½æ•°å½»åº•æ”¹å˜äº†è¿™ä¸€è¡Œä¸º â€”â€” å®ƒçš„ this ä¸è¿™äº›è§„åˆ™ç»Ÿç»Ÿæ— å…³ã€‚

## ç®­å¤´å‡½æ•°ä¸ç»‘å®š this
ç®­å¤´å‡½æ•°**ä¸ç»‘å®š thisï¼Œåªä¼šä»ã€Œå®šä¹‰æ—¶ã€çš„ä½œç”¨åŸŸé“¾ä¸­ä¸€å±‚ä¸€å±‚å¾€ä¸ŠæŸ¥æ‰¾ this**ã€‚

::: tip
> å‡½æ•°çš„ä½œç”¨åŸŸé“¾ï¼šæ˜¯åœ¨å‡½æ•°å£°æ˜ï¼ˆç¼–å†™/å®šä¹‰ï¼‰æ—¶ï¼Œå°±ç¡®å®šä¸‹æ¥äº†ã€‚
:::

**ä½œä¸ºå¯¹è±¡æ–¹æ³•æ—¶ä¹Ÿä¸ä¼šç»‘å®š obj**
```js
var name = 'global'

var obj = {
  name: 'obj',
  foo: () => {
    console.log(this.name)
  }
}

obj.foo() // 'global'
```
> è™½ç„¶è¯­æ³•ä¸Šå†™åœ¨å¯¹è±¡ä¸­ï¼Œä½†ç®­å¤´å‡½æ•°ä¸æ¥å—ä»»ä½•æ–¹å¼çš„ this ç»‘å®šï¼Œè‡ªç„¶è¿™é‡Œé€šè¿‡ obj.foo() è¿™ç§éšå¼ç»‘å®š this çš„æ–¹å¼ä¹Ÿå°±æ— æ•ˆã€‚

**call/apply/bind å¯¹ç®­å¤´å‡½æ•°æ— æ•ˆ**
```js
var name = 'global'
var foo = () => {
  console.log(this.name)
}

foo.call({ name: 'aaa' })     // 'global'
foo.apply({ name: 'aaa' })    // 'global'
foo.bind({ name: 'aaa' })()   // 'global'
```
> 

## ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ä½¿ç”¨
```js
const ArrowFn = () => {}
console.log("prototype" in ArrowFn) // false
console.log("__proto__" in ArrowFn) // true
new ArrowFn() // âŒ TypeError: ArrowFn is not a constructor
```
> ç®­å¤´å‡½æ•°**ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ä½¿ç”¨**ï¼Œå› ä¸ºå®ƒä»¬æ˜¯**æ²¡æœ‰æ˜¾å¼åŸå‹ prototype å±æ€§**çš„ï¼Œä½†æ˜¯ä½œä¸ºå¯¹è±¡æ˜¯**æœ‰éšå¼åŸå‹**çš„ï¼ˆä¸èƒ½å’Œ new ä¸€èµ·ä½¿ç”¨ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼‰ã€‚

## æ²¡æœ‰ arguments å¯¹è±¡
```js
function normalFn() {
  console.log('normalFn arguments:', arguments)
}

const arrowFn = () => {
  console.log('arrowFn arguments:', arguments)
}

normalFn(1, 2, 3) 
arrowFn(1, 2, 3)

// outputï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰:
// normalFn arguments: Arguments(3) [1, 2, 3, callee: Æ’, Symbol(Symbol.iterator): Æ’]
// âŒ Uncaught ReferenceError: arguments is not defined
```
>  åŸå› è¯´æ˜ï¼š 
> - æ™®é€šå‡½æ•°æ‹¥æœ‰è‡ªå·±çš„ arguments å¯¹è±¡ï¼›
> - ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ argumentsï¼Œå¼•ç”¨æ—¶ä¼šå¾€ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾ï¼›
> - å¦‚æœä¸Šå±‚ä½œç”¨åŸŸä¹Ÿæ²¡æœ‰ argumentsï¼ˆæ¯”å¦‚é¡¶å±‚ä½œç”¨åŸŸï¼‰ï¼Œåˆ™æŠ¥é”™ã€‚

## æ²¡æœ‰ new.target å…ƒå±æ€§
::: tip
new.target å…ƒå±æ€§å…è®¸ä½ æ£€æµ‹å‡½æ•°æˆ–æ„é€ å‡½æ•°æ˜¯å¦æ˜¯é€šè¿‡ new è¿ç®—ç¬¦è¢«è°ƒç”¨çš„ã€‚åœ¨é€šè¿‡ new è¿ç®—ç¬¦æ‰§è¡Œçš„å‡½æ•°æˆ–æ„é€ å‡½æ•°ä¸­ï¼Œnew.target è¿”å›ä¸€ä¸ªæŒ‡å‘ new è°ƒç”¨çš„æ„é€ å‡½æ•°æˆ–å‡½æ•°çš„å¼•ç”¨ã€‚åœ¨æ™®é€šçš„å‡½æ•°è°ƒç”¨ä¸­ï¼Œnew.target çš„å€¼æ˜¯ undefinedã€‚

åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œå¦‚æœå‡½æ•°æ˜¯ç›´æ¥é€šè¿‡ new æ„é€ çš„ï¼Œåˆ™ new.target æŒ‡å‘å‡½æ•°æœ¬èº«ã€‚å¦‚æœå‡½æ•°ä¸æ˜¯é€šè¿‡ new è°ƒç”¨çš„ï¼Œåˆ™ new.target æ˜¯ undefinedã€‚å‡½æ•°å¯ä»¥è¢«ç”¨ä½œ extends çš„åŸºç±»ï¼Œè¿™ç§æƒ…å†µä¸‹ new.target å¯èƒ½æŒ‡å‘å­ç±»ã€‚

åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œnew.target æ˜¯ä»å‘¨å›´çš„ä½œç”¨åŸŸç»§æ‰¿çš„ã€‚å¦‚æœç®­å¤´å‡½æ•°ä¸æ˜¯åœ¨å¦ä¸€ä¸ªå…·æœ‰ new.target ç»‘å®šçš„ç±»æˆ–å‡½æ•°ä¸­å®šä¹‰çš„ï¼Œåˆ™ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ã€‚
:::

::: code-group
```js [æ™®é€šå‡½æ•°]
function NormalClass() {
  console.log(new.target)
  console.log(new.target === NormalClass)
}

NormalClass()
// undefined
// false
new NormalClass()
// Æ’ NormalClass() {}
// true
```
```js [ç®­å¤´å‡½æ•°]
const ArrowClass = () => {
  console.log(new.target) // âŒ Uncaught SyntaxError: new.target expression is not allowed here
}
```
:::
> åŸå› è¯´æ˜ï¼šç®­å¤´å‡½æ•°æ— æ³•ç”¨ new æ„é€ ï¼Œä¹Ÿæ²¡æœ‰æ„é€ ä¸Šä¸‹æ–‡ï¼Œå› æ­¤è®¿é—® new.target ä¼šä¿é”™ã€‚

## ä½œä¸ºç±»å­—æ®µæ—¶çš„ç»‘å®šæœºåˆ¶è¯´æ˜
::: info [MDNåŸå¥](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions#%E4%B8%8D%E8%83%BD%E7%94%A8%E4%BD%9C%E6%96%B9%E6%B3%95)
ç”±äºç±»ä½“å…·æœ‰ this ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ä½œä¸ºç±»å­—æ®µçš„ç®­å¤´å‡½æ•°ä¼šå…³é—­ç±»çš„ this ä¸Šä¸‹æ–‡ï¼Œç®­å¤´å‡½æ•°ä½“ä¸­çš„ this å°†æ­£ç¡®æŒ‡å‘å®ä¾‹ï¼ˆå¯¹äºé™æ€å­—æ®µæ¥è¯´æ˜¯ç±»æœ¬èº«ï¼‰ã€‚ä½†æ˜¯ï¼Œç”±äºå®ƒæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè€Œä¸æ˜¯å‡½æ•°æœ¬èº«çš„ç»‘å®šï¼Œå› æ­¤ this çš„å€¼ä¸ä¼šæ ¹æ®æ‰§è¡Œä¸Šä¸‹æ–‡è€Œæ”¹å˜ã€‚
```js
class C {
  a = 1;
  autoBoundMethod = () => {
    console.log(this.a);
  };
}

const c = new C();
c.autoBoundMethod(); // 1
const { autoBoundMethod } = c;
autoBoundMethod(); // 1
// å¦‚æœè¿™æ˜¯æ™®é€šæ–¹æ³•ï¼Œæ­¤æ—¶åº”è¯¥æ˜¯ undefined
```
ç®­å¤´å‡½æ•°å±æ€§é€šå¸¸è¢«ç§°ä½œâ€œè‡ªåŠ¨ç»‘å®šæ–¹æ³•â€ï¼Œå› ä¸ºå®ƒä¸æ™®é€šæ–¹æ³•çš„ç­‰ä»·æ€§ç›¸åŒï¼š
```js
class C {
  a = 1;
  constructor() {
    this.method = this.method.bind(this);
  }
  method() {
    console.log(this.a);
  }
}
```
å¤‡æ³¨ï¼š ç±»å­—æ®µæ˜¯åœ¨å®ä¾‹ï¼ˆinstanceï¼‰ä¸Šå®šä¹‰çš„ï¼Œè€Œä¸æ˜¯åœ¨åŸå‹ï¼ˆprototypeï¼‰ä¸Šå®šä¹‰çš„ï¼Œå› æ­¤æ¯æ¬¡åˆ›å»ºå®ä¾‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å¼•ç”¨å¹¶åˆ†é…ä¸€ä¸ªæ–°çš„é—­åŒ…ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ¯”æ™®é€šéç»‘å®šæ–¹æ³•æ›´å¤šçš„å†…å­˜ä½¿ç”¨ã€‚
:::
**åŸæ–‡ä¸€**
> ç±»ä½“å…·æœ‰ this ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ä½œä¸ºç±»å­—æ®µçš„ç®­å¤´å‡½æ•°ä¼šå…³é—­ç±»çš„ this ä¸Šä¸‹æ–‡ï¼Œç®­å¤´å‡½æ•°ä½“ä¸­çš„ this å°†æ­£ç¡®æŒ‡å‘å®ä¾‹ï¼ˆå¯¹äºé™æ€å­—æ®µæ¥è¯´æ˜¯ç±»æœ¬èº«ï¼‰ã€‚

ç†è§£ï¼š
> å½“ä½ åœ¨ç±»ä¸­ä»¥â€œç±»å­—æ®µâ€çš„æ–¹å¼å®šä¹‰ç®­å¤´å‡½æ•°æ—¶ï¼Œè¿™ä¸ªç®­å¤´å‡½æ•°ä¼šåœ¨å®šä¹‰æ—¶æ•è·ç±»çš„å®ä¾‹ä½œç”¨åŸŸä¸­çš„ thisï¼Œå¹¶å°†å®ƒæ°¸ä¹…ä¿å­˜åœ¨å‡½æ•°å†…éƒ¨ï¼ˆå½¢æˆé—­åŒ…ï¼‰ã€‚å› æ­¤ï¼š
> - æ— è®ºä½ ä»¥åæ€ä¹ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œthis å§‹ç»ˆæŒ‡å‘å®ƒåˆ›å»ºæ—¶çš„é‚£ä¸ªå®ä¾‹ï¼›
> - å¦‚æœè¿™æ˜¯ä¸€ä¸ª**é™æ€å­—æ®µ**ï¼Œåˆ™ç®­å¤´å‡½æ•°æ•è·çš„æ˜¯ç±»æœ¬èº«è€Œä¸æ˜¯å®ä¾‹ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ç®­å¤´å‡½æ•°â€œå°é—­ï¼ˆå›ºå®šï¼‰äº†ç±»çš„ this ä¸Šä¸‹æ–‡â€ã€‚
::: tip ğŸ“Œ è§£é‡Šå…³é”®è¯ï¼š
| æœ¯è¯­ | è¯´æ˜ |
| ------ | -- |
| ç±»å­—æ®µ | æŒ‡å†™åœ¨ç±»ä½“ä¸­ã€ä¸æ˜¯æ–¹æ³•çš„å±æ€§ï¼Œå¦‚ `a = 1`ã€`fn = () => {}` |
| å°é—­/å…³é—­ä½œç”¨åŸŸ | æŒ‡å‡½æ•°åˆ›å»ºæ—¶æ•è·å…¶å¤–å±‚ä½œç”¨åŸŸä¸­çš„å˜é‡ï¼Œå¹¶å½¢æˆé—­åŒ… |
| å®ä¾‹ä¸Šä¸‹æ–‡ | æŒ‡ new å‡ºæ¥çš„å¯¹è±¡ï¼Œåœ¨ç±»å­—æ®µä¸­ this é»˜è®¤æŒ‡å‘è¿™ä¸ªå¯¹è±¡å®ä¾‹ |
| é™æ€å­—æ®µä¸Šä¸‹æ–‡ | `static foo = () => {}` ä¸­çš„ this æ•è·çš„æ˜¯ç±»æ„é€ å‡½æ•°æœ¬èº«ï¼ˆç±»åï¼‰|
:::
**åŸæ–‡äºŒ**
> ç”±äºå®ƒæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè€Œä¸æ˜¯å‡½æ•°æœ¬èº«çš„ç»‘å®šï¼Œå› æ­¤ this çš„å€¼ä¸ä¼šæ ¹æ®æ‰§è¡Œä¸Šä¸‹æ–‡è€Œæ”¹å˜ã€‚

ç†è§£ï¼š
> â€œå®ƒæ˜¯ä¸€ä¸ªé—­åŒ…â€  
> æŒ‡çš„æ˜¯ç®­å¤´å‡½æ•°**åˆ›å»ºæ—¶å°±æ•è·äº†å…¶æ‰€åœ¨ä½œç”¨åŸŸçš„å˜é‡**ï¼ŒåŒ…æ‹¬ this åœ¨å†…ã€‚

> â€œä¸æ˜¯å‡½æ•°æœ¬èº«çš„ç»‘å®šâ€  
> æŒ‡ç®­å¤´å‡½æ•°**æ²¡æœ‰è‡ªå·±çš„ this ç»‘å®šæœºåˆ¶**ï¼Œä¸åƒæ™®é€šå‡½æ•°é‚£æ ·å¯ä»¥é€šè¿‡ callã€applyã€bind æˆ– new åŠ¨æ€è®¾ç½® thisã€‚

> â€œthis çš„å€¼ä¸ä¼šæ ¹æ®æ‰§è¡Œä¸Šä¸‹æ–‡è€Œæ”¹å˜â€  
> å³ä½¿ä½ æ”¹å˜è°ƒç”¨æ–¹å¼ã€æˆ–æŠŠç®­å¤´å‡½æ•°å½“ä½œå›è°ƒã€ç”šè‡³ç”¨ call/apply æ˜¾å¼ç»‘å®šï¼Œå®ƒçš„ this éƒ½**ä¸ä¼šè¢«ä¿®æ”¹**ï¼Œæ°¸è¿œ**ä¿æŒæœ€åˆçš„ä½œç”¨åŸŸé‡Œçš„ this**ã€‚

**åŸæ–‡ä¸‰**
> ç±»å­—æ®µæ˜¯åœ¨å®ä¾‹ï¼ˆinstanceï¼‰ä¸Šå®šä¹‰çš„ï¼Œè€Œä¸æ˜¯åœ¨åŸå‹ï¼ˆprototypeï¼‰ä¸Šå®šä¹‰çš„ï¼Œå› æ­¤æ¯æ¬¡åˆ›å»ºå®ä¾‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å¼•ç”¨å¹¶åˆ†é…ä¸€ä¸ªæ–°çš„é—­åŒ…ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ¯”æ™®é€šéç»‘å®šæ–¹æ³•æ›´å¤šçš„å†…å­˜ä½¿ç”¨ã€‚

ç†è§£ï¼š
> - ç±»å­—æ®µçš„ç®­å¤´å‡½æ•°æ˜¯å®šä¹‰åœ¨å®ä¾‹ä¸Šçš„ï¼Œä¼šä¸ºæ¯ä¸ªå®ä¾‹åˆ›å»ºä¸€ä»½æ–°çš„å‡½æ•°å‰¯æœ¬ï¼›  
> - è€Œæ™®é€šæ–¹æ³•æ˜¯å®šä¹‰åœ¨ prototype ä¸Šçš„ï¼ˆæ‰€æœ‰å®ä¾‹å…±äº«ï¼‰ï¼›  
> - ä¸åŸå‹ä¸Šçš„æ–¹æ³•ï¼ˆå…±äº«ï¼‰ä¸åŒï¼Œè¿™ä¼šç¨å¾®å¢åŠ å†…å­˜ä½¿ç”¨ã€‚


# ä¸ƒ. thisé¢è¯•é¢˜åˆ†æ

::: code-group
```js [ç»ƒä¹ é¢˜ä¸€]
var name = '222'
var person = {
  name: 'person',
  sayName: function() {
    console.log(this.name)
  }
}

function sayName() {
  var s = person.sayName
  s()
  person.sayName()
  (person.sayName)()
  (b = person.sayName)()
}

sayName()
// outputï¼š
// '222'    é»˜è®¤ç»‘å®šï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
// 'person' éšå¼ç»‘å®š
// 'person' éšå¼ç»‘å®šï¼Œç­‰åŒäºperson.sayName(), åŠ å°æ‹¬å·ä¸åŠ æ•ˆæœå®Œå…¨ä¸€æ ·ï¼ŒåŠ å°æ‹¬å·æ§åˆ¶ä»£ç ä¼˜å…ˆçº§ï¼Œä¸åŠ å°æ‹¬å·ï¼Œæœ¬èº«ç‚¹.è¯­æ³•ä¼˜å…ˆçº§å°±å¾ˆé«˜
// '222'    é—´æ¥å‡½æ•°å¼•ç”¨ï¼Œèµ‹å€¼è¯­å¥è¿”å›ç»“æœå³ç‹¬ç«‹å‡½æ•°è°ƒç”¨
```
```js [ç»ƒä¹ é¢˜äºŒ]
var name = '222'
var person1 = {
  name: 'person1',
  foo1: function() {
    console.log(this.name)
  },
  foo2: () => console.log(this.name),
  foo3: function() {
    return function() {
      console.log(this.name)
    }
  },
  foo4: function() {
    return () => {
      console.log(this.name)
    }
  }
}

var person2 = {name: 'person2'}

person1.foo1()                // 'person1'  éšå¼ç»‘å®š
person1.foo1.call(person2)    // 'person2'  æ˜¾å¼ç»‘å®š

person1.foo2()                // '222'      ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo2.call(person2)    // '222'      ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this

person1.foo3()()              // '222'      é»˜è®¤ç»‘å®š æ‹¿åˆ°è¿”å›çš„æ™®é€šå‡½æ•°ç›´æ¥è¿›è¡Œé»˜è®¤è°ƒç”¨
person1.foo3.call(person2)()  // '222'      é»˜è®¤ç»‘å®š æ‹¿åˆ°è¿”å›çš„æ™®é€šå‡½æ•°ç›´æ¥è¿›è¡Œé»˜è®¤è°ƒç”¨
person1.foo3().call(person2)  // 'person2'  æ˜¾å¼ç»‘å®š

person1.foo4()()              // 'person1'  ç®­å¤´å‡½æ•°è°ƒç”¨ä¼šä»ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo4.call(person2)()  // 'person2'  ç®­å¤´å‡½æ•°è°ƒç”¨ä¼šä»ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
person1.foo4().call(person2)  // 'person1'  ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä»ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾this
```
```js [ç»ƒä¹ é¢˜ä¸‰]
var name = '222'
function Person(name) {
  this.name = name
  this.foo1 = function() {
    console.log(this.name)
  }
  this.foo2 = () => console.log(this.name)
  this.foo3 = function() {
    return function() {
      console.log(this.name)
    }
  }
  this.foo4 = function() {
    return () => {
      console.log(this.name)
    }
  }
}

var person1 = new Person('person1')
var person2 = new Person('person2')

person1.foo1()                // 'person1'  éšå¼ç»‘å®š
person1.foo1.call(person2)    // 'person2'  æ˜¾å¼ç»‘å®š

person1.foo2()                // 'person1'  ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾ï¼šä¸Šå±‚ä½œç”¨åŸŸä¸­çš„thisç»‘å®šåˆ°äº†person1
person1.foo2.call(person2)    // 'person1'  ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾

person1.foo3()()              // '222'      é»˜è®¤ç»‘å®š ç‹¬ç«‹å‡½æ•°è°ƒç”¨
person1.foo3.call(person2)()  // '222'      é»˜è®¤ç»‘å®š ç‹¬ç«‹å‡½æ•°è°ƒç”¨
person1.foo3().call(person2)  // 'person2'  æ˜¾å¼ç»‘å®š

person1.foo4()()              // 'person1'  ä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾
person1.foo4.call(person2)()  // 'person2'  foo4å‡½æ•°ä¸­thisç»‘å®šperson2ï¼Œç®­å¤´å‡½æ•°æŸ¥æ‰¾ä¸Šå±‚ä½œç”¨åŸŸfoo4å‡½æ•°ä¸­çš„this
person1.foo4().call(person2)  // 'person1'  ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸæŸ¥æ‰¾
```
```js [ç»ƒä¹ é¢˜å››]
var name = '222'
function Person(name) {
  this.name = name
  this.obj = {
    name: 'obj',
    foo1: function() {
      return function() {
        console.log(this.name)
      }
    },
    foo2: function() {
      return () => {
        console.log(this.name)
      }
    }
  }
}

var person1 = new Person('person1')
var person2 = new Person('person2')

person1.obj.foo1()()              // '222'      æ™®é€šå‡½æ•°é»˜è®¤è°ƒç”¨ï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
person1.obj.foo1.call(person2)()  // '222'      æ™®é€šå‡½æ•°é»˜è®¤è°ƒç”¨ï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰
person1.obj.foo1().call(person2)  // 'person2'  æ™®é€šå‡½æ•°æ˜¾å¼ç»‘å®šè°ƒç”¨

person1.obj.foo2()()              // 'obj'      ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thiséšå¼ç»‘å®šobj
person1.obj.foo2.call(person2)()  // 'person2'  ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thisæ˜¾å¼ç»‘å®šperson2
person1.obj.foo2().call(person2)  // 'obj'      ç®­å¤´å‡½æ•°ä¸ç»‘å®šthisï¼Œä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åˆ°foo2å‡½æ•°ä½œç”¨åŸŸä¸­çš„thiséšå¼ç»‘å®šobj
```
:::
::: tip æ€»ç»“ï¼š
> æ™®é€šå‡½æ•°ä¸­çš„ thisï¼Œæ˜¯æ ¹æ®è°ƒç”¨çš„æ—¶å€™ç»‘å®šçš„ã€‚
> 
> ç®­å¤´å‡½æ•°ä¸­æ˜¯æ²¡æœ‰ this çš„ï¼Œæ‰€ä»¥æ˜¯ä¸è¢«ç»‘å®šçš„ï¼Œä¼šå»ä¸Šå±‚ä½œç”¨åŸŸä¸­æŸ¥æ‰¾ this ï¼Œæ˜¯æ ¹æ®æ‰§è¡Œä¸Šä¸‹æ–‡å†³å®šçš„ã€‚
:::






# å…«. æ‰‹å†™applyã€callã€bind

---

```js
Function.prototype.executionFn = function(thisArg, args) {
  thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg) // è¿™é‡Œæ˜¯é˜²æ­¢ä¼ å…¥ç»‘å®šçš„å‚æ•°ä¸ºç©ºæˆ–è€…æ˜¯åŸå§‹ç±»å‹çš„å€¼ï¼Œå¦‚stringæˆ–number
  Object.defineProperty(thisArg, '_this', {
    configurable: true,
    enumerable: falseï¼Œ
    value: this
  })
  args ? thisArg._this(...args) : thisArg._this()
  delete this._this
}

/**
* ç§æœ‰çš„applyæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°æ•°ç»„
*/
Function.prototype._apply = function(thisArg, args) {
  // thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  // thisArg._this = this
  // Object.defineProperty(thisArg, '_this', {
  //   configurable: true,
  //   enumerable: false
  // })
  // args ? thisArg._this(...args) : thisArg._this()
  this.executionFn(thisArg, args)
}

function foo(name, age) {
  console.log(this, name, age)
}

foo._apply({name: 'later'}, ['later', 18])
foo._apply('abc', ['later', 18])
foo._apply()

/**
* ç§æœ‰çš„callæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°åˆ—è¡¨
*/
Function.prototype._call = function(thisArg, ...args) {
  // thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  // thisArg._this = this
  // Object.defineProperty(thisArg, '_this', {
  //   configurable: true,
  //   enumerable: false
  // })
  // args ? thisArg._this(...args) : thisArg._this()
  this.executionFn(thisArg, args)
}

foo._call()
foo._call({name: 'later'}, 'later', 18)
foo._call('abc', 'later', 18)
```

```js
function foo(name, age) {
  console.log(this, name, age)
}
/**
* ç§æœ‰çš„bindæ–¹æ³•
* @param {any} thisArg ä¼ å…¥çš„ç»‘å®šå¯¹è±¡
* @param {Array} args ä¼ å…¥çš„å‚æ•°åˆ—è¡¨
*/
Function.prototype._bind = function(thisArg, ...args) {
  thisArg = ( thisArg == null || thisArg == undefined ) ? window : Object(thisArg)
  Object.defineProperty(thisArg, '_this', {
    configurable: true,
    enumerable: false,
    value: this
  })

  return (...rest) => {
    args ? thisArg._this(...args, ...rest) : thisArg._this(...rest)
  }
}

var foo2 = foo._bind({name: 'later'}, 'later')
foo2(23)
foo2(18)
foo2()
var foo3 = foo._bind()
foo3()
```







